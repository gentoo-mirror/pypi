<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># MapChefMaster branch [![Build Status](https://travis-ci.com/mapaction/mapactionpy_arcmap.svg?branch=master)](https://travis-ci.com/mapaction/mapactionpy_arcmap) [![Coverage Status](https://coveralls.io/repos/github/mapaction/mapactionpy_arcmap/badge.svg)](https://coveralls.io/github/mapaction/mapactionpy_arcmap) [![Maintainability](https://api.codeclimate.com/v1/badges/4e1df691fb6c698fe723/maintainability)](https://codeclimate.com/github/mapaction/mapactionpy_arcmap/maintainability)Adds geospatial data to an ArcMap MXD file based on a recipe from a cookbook configuration file and a product name.### Prerequisites* Python v2.7 and ArcPy v10.6.1    ```    C:\Python27\ArcGIS10.6\python.exe    ```* ArcMap MapAction templates and Crash Move Folder as setout here https://github.com/mapaction/default-crash-move-folder* For the Crash Move Folder to have been populated by the Data Scramble process.Installing---------To install the lastest stable release via PyPi:```pip install mapactionpy-controllerpip install mapactionpy-arcmap```To install a specific version for testing see the relevant commandline from here:https://pypi.org/project/mapactionpy-arcmap/#historyOptional Installation of ArcMap ESRI Addin------------------------------------------In additiona to the commandline the MapChef tool can also optionally be driven from an ArcMap Addin. To install this:1) If required, uninstall any previous version of the ArcMap Esri Add-In.2) Reinstall ArcMap Esri Add-In using file here:    [https://drive.google.com/drive/u/0/folders/1qzR6UvqA_RjxK9D2U9_AXi3EW4cXnuP7](https://drive.google.com/drive/u/0/folders/1qzR6UvqA_RjxK9D2U9_AXi3EW4cXnuP7)3) Restart ArcMap and ensure the 'Map Generation Tool' is available within the MapAction toolbar.4) To run the 'Map Generation Tool' the standardised Crash Move Folder must be in place, see:  [https://github.com/mapaction/default-crash-move-folder/blob/master/20YYiso3nn](https://github.com/mapaction/default-crash-move-folder/blob/master/20YYiso3nn)## Integration with MapAction ToolbarIn order to integrate this `MapActionPy_ArcMap` module with the MapAction Toolbar, the following steps need to be carried out:## Configuration Files### Cookbook FileThe [mapCookbook.json](https://github.com/mapaction/default-crash-move-folder/blob/master/20YYiso3nn/GIS/3_Mapping/31_Resources/316_Automation/mapCookbook.json) file is a static configuration file which contains &quot;recipes&quot; for each map product, e.g.:```{    &quot;recipes&quot;:[       {          &quot;mapnumber&quot;:&quot;MA001&quot;,         &quot;category&quot;:&quot;Reference&quot;,         &quot;product&quot;:&quot;Country Overview with Admin 1 Boundaries &amp; P-Codes&quot;,         &quot;export&quot;: true,         &quot;layers&quot;:[             &quot;mainmap-s0-pt-settlements&quot;,            &quot;mainmap-s0-py-surroundingcountries&quot;,            &quot;mainmap-s0-ln-admin1&quot;,            &quot;mainmap-s0-ln-coastline&quot;,            &quot;mainmap-s0-py-feather&quot;,            &quot;mainmap-s0-py-surroundingcountries&quot;,            &quot;mainmap-s0-py-admin1&quot;,            &quot;mainmap-s0-py-sea&quot;,            &quot;locationmap-s0-ln-admin1&quot;,            &quot;locationmap-s0-ln-affectedcountry&quot;,            &quot;locationmap-s0-ln-coastline&quot;,            &quot;locationmap-s0-py-surroundingcountries&quot;         ]      },...    }  ]}```The layer names in the &quot;```layers```&quot; array MUST correlate to layer files (```.lyr```) in the specified layer directory:[GIS/3_Mapping/31_Resources/312_Layer_files] (https://github.com/mapaction/default-crash-move-folder/tree/master/20YYiso3nn/GIS/3_Mapping/31_Resources/312_Layer_files)### layerConfig FileThe Layer Config file ([layerProperties.json](https://github.com/mapaction/default-crash-move-folder/blob/master/20YYiso3nn/GIS/3_Mapping/31_Resources/316_Automation/layerProperties.json)) is a static file which defines how to add a particular layer.```{      &quot;MapFrame&quot;: &quot;Main Map&quot;,      &quot;LayerName&quot;: &quot;mainmap-s0-pt-settlements&quot;,      &quot;RegExp&quot;: &quot;^[a-z]{3}_stle_stl_pt_(.*?)_(.*?)_([phm][phm])(.*?).shp$&quot;,      &quot;DefinitionQuery&quot;: &quot;place IN ('national_capital', 'city', 'capital')&quot;,      &quot;Display&quot;: true,      &quot;AddToLegend&quot;: true,      &quot;LabelClasses&quot;: [        {          &quot;className&quot;: &quot;National Capital&quot;,          &quot;expression&quot;: &quot;[name]&quot;,          &quot;SQLQuery&quot;: &quot;(\&quot;place\&quot; = 'national_capital')&quot;        },        {          &quot;className&quot;: &quot;Admin 1 Capital&quot;,          &quot;expression&quot;: &quot;[name]&quot;,          &quot;SQLQuery&quot;: &quot;(\&quot;place\&quot; = 'city')&quot;        }      ]    },```#### Fields| # | Field           |Description     ||---|-----------------|----------------------------|| 1 | MapFrame        | Name of the Map Frame that the layer is to be added to || 2 | LayerName       | Name of the Layer.  This must correlate with the names of the layers in the ```layers``` field in the ```mapCookbook.json``` file. || 3 | RegExp          | Regular Expression.  Used when selecting files to display || 4 | DefinitionQuery | Definition Query || 5 | AddToLegend     | Includes this layer in the legend if set to true || 6 | Display         | Shows if set to true || 7 | LabelClasses    | Details for displaying labels |## Execution### Key| # | Icon         |Meaning                                                           ||---|---------------|-----------------------------------------------------------------------|| 1 | :heavy_check_mark:| Must always be supplied| 2 | :zap:| If not supplied, this parameter can be inferred if the `cmf_description.json` and the `event_description.json` files are in he root of the Crash Move Folder.### Parameters| # | Field         |Mandatory|Description                                                           ||---|---------------|-|-----------------------------------------------------------------------|| 1 | --cookbook    |:zap:| Path to the cookbook ```mapCookbook.json``` file.                     || 2 | --layerConfig |:zap:| Path to the ```layerProperties.json``` file.                          || 3 | --cmf         |:heavy_check_mark:| Path to the Crash Move Folder root.                                   || 4 | --template    |:zap:| Path to the ```MXD``` file.                                           || 5 | --product     |:heavy_check_mark:| Name of product (must correlate with a product in the cookbook file). || 6 | --country     |:zap:| Name of country.                                                      |### Example 1For a specified MXD using the ```--template``` parameter:```C:\Python27\ArcGIS10.6\python.exe -m mapactionpy_arcmap.arcmap_runner \   --cookbook &quot;D:\MapAction\2019-06-25 - Automation - El Salvador\GIS\3_Mapping\31_Resources\316_Automation\mapCookbook.json&quot; \   --layerConfig &quot;D:\MapAction\2019-06-25 - Automation - El Salvador\GIS\3_Mapping\31_Resources\316_Automation\layerProperties.json&quot; \   --cmf &quot;D:\MapAction\2019-06-25 - Automation - El Salvador&quot; \   --template &quot;D:\MapAction\2019-06-25 - Automation - El Salvador\GIS\3_Mapping\32_MXD_Templates\arcgis_10_2\MapAction\01 Reference mapping\arcgis_10_2_ma000_reference_landscape_bottom_DEV.mxd&quot; \   --layerDirectory &quot;D:\MapAction\2019-06-25 - Automation - El Salvador\GIS\3_Mapping\31_Resources\312_Layer_files&quot; \   --product &quot;Country Overview with Admin 1 Boundaries &amp; P-Codes&quot; \   --country &quot;El Salvador&quot;```### ResultThis ```Country Overview``` map was generated:![alt text](Images/Result.png)### Example 2```C:\Python27\ArcGIS10.6\python.exe -m mapactionpy_arcmap.arcmap_runner \   --cookbook &quot;D:\MapAction\2019-06-25 - Automation - El Salvador\GIS\3_Mapping\31_Resources\316_Automation\mapCookbook.json&quot; \   --layerConfig &quot;D:\MapAction\2019-06-25 - Automation - El Salvador\GIS\3_Mapping\31_Resources\316_Automation\layerProperties.json&quot; \   --cmf &quot;D:\MapAction\2019-06-25 - Automation - El Salvador&quot; \   --layerDirectory &quot;D:\MapAction\2019-06-25 - Automation - El Salvador\GIS\3_Mapping\31_Resources\312_Layer_files&quot; \   --product &quot;Country Overview with Admin 1 Boundaries &amp; P-Codes&quot; \   --country &quot;El Salvador&quot;```If an MXD is not supplied with the ```--template``` parameter as above, then the tool will decide the orientation of the map (landscape or portrait) and it will take a copy of the appropriate MXD from:\&lt;crash move folder&gt;```\GIS\3_Mapping\32_MXD_Templates\arcgis_10_6\```Using the ```mapnumber``` from the [mapCookbook.json](https://github.com/mapaction/default-crash-move-folder/blob/master/20YYiso3nn/GIS/3_Mapping/31_Resources/316_Automation/mapCookbook.json) file, the Automation Tool will create a copy of the MXD under the following directory:\&lt;crash move folder&gt;```\GIS\3_Mapping\33_MXD_Maps\```\&lt;map number&gt;For example:```D:\MapAction\2019-06-25 - Automation - El Salvador\GIS\3_Mapping\33_MXD_Maps\MA001```The MXD name will be \&lt;map number&gt;```_```\&lt;product name&gt;```.mxd```... (but with any characters removed that upset Windows Explorer)For example:```MA001_country-overview-with-admin-1-boundaries-p-codes.mxd```### Example 3```C:\Python27\ArcGIS10.6\python.exe -m mapactionpy_arcmap.arcmap_runner \   --cmf &quot;D:\MapAction\2019-06-25 - Automation - El Salvador&quot; \   --product &quot;Country Overview with Admin 1 Boundaries &amp; P-Codes&quot;```In this example, the following parameters were not provided:    --cookbook    --layerConfig    --layerDirectory    --countryThe values for these parameters were inferred from the ```event_description.json``` and the ```cmf_description.json``` files.  These files were provided at the root of the Crash Move Folder, i.e. the directory supplied by the ```--cmf``` parameter.## Author* **Steve Hurst** - [https://github.com/mapaction/mapactionpy_arcmap](https://github.com/mapaction/mapactionpy_arcmap)</longdescription>
</pkgmetadata>