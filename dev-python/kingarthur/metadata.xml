<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># Arthur [![Build Status](https://github.com/chaoss/grimoirelab-kingarthur/workflows/tests/badge.svg)](https://github.com/chaoss/grimoirelab-kingarthur/actions?query=workflow:tests+branch:master+event:push) [![Coverage Status](https://coveralls.io/repos/github/chaoss/grimoirelab-kingarthur/badge.svg?branch=master)](https://coveralls.io/github/chaoss/grimoirelab-kingarthur?branch=master)  [![PyPI version](https://badge.fury.io/py/kingarthur.svg)](https://badge.fury.io/py/kingarthur)King Arthur commands his loyal knight Perceval on the quest to fetchdata from software repositories.Arthur is a distributed job queue platform that schedules and executesPerceval. The platform is composed by two components: `arthurd`, the serverthat schedules the jobs and one or more instances of `arthurw`, the work horsesthat will run each Perceval job.The repositories whose data will be fetched are added to theplatform using a REST API. Then, the server transforms these repositories intoPerceval jobs and schedules them between its job queues.Workers are waiting for new jobs checking these queues. Workers only executea job at a time. When a new job arrives, an idle worker will take and runit. Once a job is finished, if the result is successful, the server willre-schedule it to retrieve new data.By default, items fetched by each job will be published using a Redis queue.Additionally, they can be written to an Elastic Search index.## Requirements * Python &gt;= 3.7 * Redis (&gt;= 2.3 and &lt; 3.0) database will also be needed to schedule and execute Perceval jobs. You will also need some other libraries for running the tool, you can find thewhole list of dependencies in [pyproject.toml](pyproject.toml) file.## InstallationThere are several ways to install Arthur on your system: packages or source code using Poetry or pip.### PyPIArthur can be installed using pip, a tool for installing Python packages. To do it, run the next command:```$ pip install kingarthur```### Source codeTo install from the source code you will need to clone the repository first:```$ git clone https://github.com/chaoss/grimoirelab-kingarthur$ cd grimoirelab-kingarthur```Then use pip or Poetry to install the package along with its dependencies.#### PipTo install the package from local directory run the following command:```$ pip install .```In case you are a developer, you should install kingarthur in editable mode:```$ pip install -e .```#### PoetryWe use [poetry](https://python-poetry.org/) for dependency management and packaging. You can install it following its [documentation](https://python-poetry.org/docs/#installation).Once you have installed it, you can install kingarthur and the dependencies in a project isolated environment using:```$ poetry install```To spaw a new shell within the virtual environment use:```$ poetry shell```## Usage### arthurd```usage: arthurd [-c &lt;file&gt;] [-g] [-h &lt;host&gt;] [-p &lt;port&gt;] [-d &lt;database&gt;]               [--es-index &lt;index&gt;] [--log-path &lt;path&gt;] [--archive-path &lt;cpath&gt;]               [--no-archive] [--no-daemon] | --helpKing Arthur commands his loyal knight Perceval on the questto retrieve data from software repositories.This command runs an Arthur daemon that waits for HTTP requestson port 8080. Repositories to analyze are added using an REST API.Repositories are transformed into Perceval jobs that will bescheduled and run using a distributed job queue platform.optional arguments:  -?, --help            show this help message and exit  -c FILE, --config FILE                        set configuration file  -g, --debug           set debug mode on  -h, --host            set the host name or IP address on which to listen for connections  -p, --port            set listening TCP port (default: 8080)  -d, --database        URL database connection (default: 'redis://localhost/8')  -s, --sync            work in synchronous mode (without workers)  --es-index            output ElasticSearch server index  --log-path            path where logs are stored  --archive-path        path to archive manager directory  --no-archive          do not archive fetched raw data  --no-daemon           do not run arthur in daemon mode```#### arthurd configuration fileTo run `arthurd` using a configuration file:```$ arthurd [-c &lt;file&gt;]```Where `&lt;file&gt;` is the path to an `ini` file which uses the same parameters as in command line, but replacing underscores by hyphens. This configuration file has the following structure:```[arthur]archive_path=/tmp/.arthur/archivedebug=Truelog_path=/tmp/logs/arthurdno_archive=Truesync_mode=True[connection]host=127.0.0.1port=8080[elasticsearch]es_index=http://localhost:9200/items[redis]database=redis://localhost/8```### arthurw```usage: arthurw [-g] [-d &lt;database&gt;] [--burst] [&lt;queue1&gt;...&lt;queueN&gt;] | --helpKing Arthur's worker. It will run Perceval jobs on the questto retrieve data from software repositories.positional arguments:   queues               list of queues this worker will listen for                        ('create' and 'update', by default)optional arguments:  -?, --help            show this help message and exit  -g, --debug           set debug mode on  -d, --database        URL database connection (default: 'redis://localhost/8')  -b, --burst           Run in burst mode (quit after all work is done)```## How to run itThe first step is to run a Redis server that will be used for communicatingArthur's components. Moreover, an Elastic Search server can be used to storethe items generated by jobs. Please refer to their documentation to know how toinstall and run them both.To run Arthur server:```$ arthurd -g -d redis://localhost/8 --es-index http://localhost:9200/items --log-path /tmp/logs/arthud --no-archive```To run a worker:```$ arthurw -d redis://localhost/8```## Adding tasksTo add tasks to Arthur, create a JSON object containing the tasks neededto fetch data from a set of repositories. Each task will run a Percevalbackend, thus, backend parameters will also needed for each task.```$ cat tasks.json{    &quot;tasks&quot;: [        {            &quot;task_id&quot;: &quot;arthur.git&quot;,            &quot;backend&quot;: &quot;git&quot;,            &quot;backend_args&quot;: {                &quot;gitpath&quot;: &quot;/tmp/git/arthur.git/&quot;,                &quot;uri&quot;: &quot;https://github.com/chaoss/grimoirelab-kingarthur.git&quot;,                &quot;from_date&quot;: &quot;2015-03-01&quot;            },            &quot;category&quot;: &quot;commit&quot;,            &quot;scheduler&quot;: {                &quot;delay&quot;: 10            }        },        {            &quot;task_id&quot;: &quot;bugzilla_mozilla&quot;,            &quot;backend&quot;: &quot;bugzillarest&quot;,            &quot;backend_args&quot;: {                &quot;url&quot;: &quot;https://bugzilla.mozilla.org/&quot;,                &quot;from_date&quot;: &quot;2016-09-19&quot;            },            &quot;category&quot;: &quot;bug&quot;,            &quot;archive&quot;: {                &quot;fetch_from_archive&quot;: true,                &quot;archived_after&quot;: &quot;2018-02-26 09:00&quot;            },            &quot;scheduler&quot;: {                &quot;delay&quot;: 60,                &quot;max_retries&quot;: 5            }        }    ]}```Then, send this JSON stream to the server calling `add` method.```$ curl -H &quot;Content-Type: application/json&quot; --data @tasks.json http://127.0.0.1:8080/add```For this example, items will be stored in the `items` index on theElastic Search server (http://localhost:9200/items).## Listing tasksThe list of tasks currently scheduled can be obtained using the method `tasks`.```$ curl http://127.0.0.1:8080/tasks{    &quot;tasks&quot;: [        {            &quot;backend_args&quot;: {                &quot;from_date&quot;: &quot;2015-03-01T00:00:00+00:00&quot;,                &quot;uri&quot;: &quot;https://github.com/chaoss/grimoirelab-kingarthur.git&quot;,                &quot;gitpath&quot;: &quot;/tmp/santi/&quot;            },            &quot;backend&quot;: &quot;git&quot;,            &quot;category&quot;: &quot;commit&quot;,            &quot;created_on&quot;: 1480531707.810326,            &quot;task_id&quot;: &quot;arthur.git&quot;,            &quot;scheduler&quot;: {                &quot;max_retries&quot;: 3,                &quot;delay&quot;: 10            }        }    ]}```## Removing tasksScheduled tasks can also be removed calling to the server using the `remove`method. A JSON stream must be provided setting the identifiers of thetasks to be removed.```$ cat tasks_to_remove.json{    &quot;tasks&quot;: [        {            &quot;task_id&quot;: &quot;bugzilla_mozilla&quot;        },        {            &quot;task_id&quot;: &quot;arthur.git&quot;        }    ]}$ curl -H &quot;Content-Type: application/json&quot; --data @tasks_to_remove.json http://127.0.0.1:8080/remove```## LicenseLicensed under GNU General Public License (GPL), version 3 or later.</longdescription>
</pkgmetadata>