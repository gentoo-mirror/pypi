<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># CloudliftCloudlift is built by Simpl developers to make it easier to launch dockerizedservices in AWS ECS.Cloudlift is a command-line tool for dockerized services to be deployed in AWSECS. It's very simple to use. That's possible because this is heavilyopinionated. Under the hood, it is a wrapper to AWS cloudformation templates. Oncreating/updating a service or a cluster this creates/updates a cloudformationin AWS.## Demo videos- [Create Environment](https://asciinema.org/a/evsaZvW86qff0InxNlzLPMtb6)- [Create Service](https://asciinema.org/a/RaZb81VDmrnWg8qckWKAm98Bn)- [Deploy Service with image build](https://asciinema.org/a/j4A2DBjLPadbwJPvwiT6W1c2N)- [Deploy Service](https://asciinema.org/a/FUUJ3U2gm7U1yCcTCGjTiGBbp)## Installing cloudlift### 1. Pre-requisites- pip```shcurl https://bootstrap.pypa.io/get-pip.py -o get-pip.py | python get-pip.py```### 2. Install cloudlift```shpip install cloudlift```### 3. Configure AWS```perlaws configure```Enter the AWS Access Key ID, AWS Secret Access Key. You can find instructionshere on how to get Access Key ID and Secret Access Key here athttp://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html#### Using AWS ProfilesIf you are using [AWS profiles](https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html), set the desired profile name in the environment before invoking Cloudlift.```shAWS_DEFAULT_PROFILE=&lt;profile name&gt; cloudlift &lt;command&gt;```OR```shexport AWS_DEFAULT_PROFILE=&lt;profile name&gt;cloudlift &lt;command&gt;cloudlift &lt;command&gt;```## Usage### Create a new environmentCreate a new environment for services to be deployed. Cloudlift creates a newVPC for the given CIDR and sets up the required networking infrastructure forservices to run in ECS.```shcloudlift create_environment -e &lt;environment-name&gt;```This starts a prompt for required details to create an environment, whichincludes -- AWS region for the environment- VPC CIDR- NAT Elastic IP allocation ID- 2 Public Subnet CIDRs- 2 Private Subnet CIDRs- Minimum instances for cluster- Maximum instances for cluster- SSM parameter path of Custom AMI ID- SSH key name- SNS ARN for notifications- AWS ACM ARN for SSL certificateOnce the configuration is saved, this is opened in the default `VISUAL` editor.Here configurations can be changed if required.### Update an environment```shcloudlift update_environment -e &lt;environment-name&gt;```This opens the environment configuration in the `VISUAL` editor. Update this tomake changes to the environment.### Create a new service### Object StructureThe configuration object is structured as follows:```json{    &quot;notifications_arn&quot;: &quot;string&quot;,    &quot;services&quot;: {        &quot;Test123&quot;: {            &quot;command&quot;: &quot;string/null&quot;,            &quot;custom_metrics&quot;: {                &quot;metrics_port&quot;: &quot;string&quot;,                &quot;metrics_path&quot;: &quot;string&quot;            },            &quot;http_interface&quot;: {                &quot;container_port&quot;: &quot;number&quot;,                &quot;internal&quot;: &quot;boolean&quot;,                &quot;restrict_access_to&quot;: [&quot;string&quot;, &quot;string&quot;]            },            &quot;volume&quot;: {                &quot;efs_id&quot; : &quot;string&quot;,                &quot;efs_directory_path&quot; : &quot;string&quot;,                &quot;container_path&quot; : &quot;string&quot;            },            &quot;memory_reservation&quot;: &quot;number&quot;,            &quot;logging&quot;: &quot;string/null&quot;        }    }}```### Required FieldsThe following fields are required in the configuration object:- `notifications_arn`: A string representing the Amazon Resource Name (ARN) of the SNS topic to which notifications will be sent.- `services`: An object representing the services to be configured. The keys of this object are the names of the services, and the values are objects containing configuration information for each service.### Service ConfigurationEach service object must contain the following fields:- `command`: A string or null value representing the command to be run in the Docker container. If this field is null, the command specified in the Dockerfile will be used.- `memory_reservation`: A number representing the soft memory limit for the container. The hard limit will automatically be set to 1.5 times the soft limit.In addition, a service object may contain any of the following optional fields:- `custom_metrics`: An object containing configuration information for exporting custom metrics to a Prometheus server. This field is only used if custom metrics are required.    &gt; **NOTE:** If you use custom metrics, Your ECS container Network mode will be `awsvpc`.     &gt; **âš  WARNING:** If you are adding custom metrics to your existing service, there will be a downtime.  - `metrics_port`: A string representing the port number on which custom metrics are exported.    - `metrics_path`: A string representing the path on which custom metrics are exported.- `http_interface`: An object containing configuration information for setting up an Application Load Balancer (ALB) for the service. This field is only used if an ALB is required.  - `container_port`: A number representing the port number on which the service is running inside the container.    - `internal`: A boolean value indicating whether the ALB should be internal. If set to false, the ALB will be public.    - `restrict_access_to`: An array of strings representing the IP addresses that should be allowed to access the ALB.- `volume`: An object containing configuration information for mounting an Amazon Elastic File System (EFS) volume to the service. This field is only used if an EFS volume is required.  - `efs_id`: A string representing the ID of the EFS volume to be mounted.    - `efs_directory_path`: A string representing the directory path on the EFS volume to be mounted.    - `container_path`: A string representing the mount path inside the container.- `logging`: A string or null value representing the log driver to be used. Valid options are &quot;fluentd&quot;, &quot;awslogs&quot;, or null. If this field is null, the default log driver (CloudWatch Logs) will be used.### 1. Upload configuration to Parameter StoreDuring create_service and deployment `cloudlift` pulls the config from AWSParameter Store to apply it on the task definition. Configurations are stored inpath with the convention `/&lt;environment&gt;/&lt;service&gt;/&lt;key&gt;````shcloudlift edit_config -e &lt;environment-name&gt;```  _NOTE_: This is *not* required for every deployment. It's required only when  config needs to be changed.### 2. Create serviceIn the repository for the application, run -```sh  cloudlift create_service -e &lt;environment-name&gt;```This opens the `VISUAL` editor with default config similar to -```json  {      &quot;notifications_arn&quot;: &quot;&lt;SNS Topic ARN&gt;&quot;,      &quot;services&quot;: {          &quot;Test123&quot;: {              &quot;command&quot;: null,              &quot;http_interface&quot;: {                  &quot;container_port&quot;: 80,                  &quot;internal&quot;: false,                  &quot;restrict_access_to&quot;: [                      &quot;0.0.0.0/0&quot;                  ]              },              &quot;memory_reservation&quot;: 100          }      }  }```### 3. Deploy serviceThis command build the image (only if the version is unavailable in ECR), pushes to ECR and updates the ECS service task definition. It supports `--build-arg` argument of `docker build` command as well to passcustom build time arguments```sh  cloudlift deploy_service -e &lt;environment-name&gt;```For example, you can pass your SSH key as a build argument to docker build```sh  cloudlift deploy_service --build-arg SSH_KEY &quot;\&quot;`cat ~/.ssh/id_rsa`\&quot;&quot; -e &lt;environment-name&gt;```This example is bit comprehensive to show- it can execute shell commands with &quot;`&quot;.- It's wrapped with double quotes to avoid line-breaks in SSH keys breaking the command.### 4. Starting shell on container instance for serviceYou can start a shell on a container instance which is running a task for givenapplication using the `start_session` command. One pre-requisite for this isinstalling the session manager plugin for `awscli`. To install session managerplugin follow the [guide](https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html#install-plugin-macos)```sh  cloudlift start_session -e &lt;environment-name&gt;```MFA code can be passed as parameter `--mfa` or you will be prompted to enterthe MFA code.## Example### 1. Service configuration:```json{  &quot;notifications_arn&quot;: &quot;arn:aws:sns:us-east-1:123456789012:MyTopic&quot;,  &quot;services&quot;: {    &quot;Test123&quot;: {      &quot;command&quot;: null,      &quot;custom_metrics&quot;: {        &quot;metrics_port&quot;: &quot;8080&quot;,        &quot;metrics_path&quot;: &quot;/metrics&quot;      },      &quot;http_interface&quot;: {        &quot;container_port&quot;: 3000,        &quot;internal&quot;: false,        &quot;restrict_access_to&quot;: [&quot;192.0.2.0/24&quot;, &quot;198.51.100.0/24&quot;]      },      &quot;volume&quot;: {        &quot;efs_id&quot;: &quot;fs-0123456789abcdef&quot;,        &quot;efs_directory_path&quot;: &quot;/mydata&quot;,        &quot;container_path&quot;: &quot;/data&quot;      },      &quot;memory_reservation&quot;: 256,      &quot;logging&quot;: &quot;fluentd&quot;    }  }}```In this example, we are configuring a service named Test123. The service has the following configuration:- `command`: The command to be run in the Docker container is not specified, so the command specified in the Dockerfile will be used.- `custom_metrics`: Custom metrics will be exported to a Prometheus server running on port 8080, with the metrics available at the path &quot;/metrics&quot;.- `http_interface`: An Application Load Balancer (ALB) will be set up for the service on port 3000. The ALB will be public and will allow access only from the IP addresses in the restrict_access_to array.- `volume`: An Amazon Elastic File System (EFS) volume with ID fs-0123456789abcdef will be mounted to the service. The volume will be mounted at the directory path &quot;/mydata&quot; on the EFS volume, and at the path &quot;/data&quot; inside the container.- `memory_reservation`: The soft memory limit for the container is set to 256 MB, so the hard limit will be automatically set to 384 MB.- `logging`: Logs will be sent to a Fluentd log driver.### 2. Service configuration with custom metrics:```json  {      &quot;notifications_arn&quot;: &quot;&lt;SNS Topic ARN&gt;&quot;,      &quot;services&quot;: {          &quot;Test123&quot;: {              &quot;command&quot;: null,              &quot;custom_metrics&quot;: {                  &quot;metrics_port&quot;: &quot;8005&quot;,                  &quot;metrics_path&quot;: &quot;/metrics&quot;              },              &quot;http_interface&quot;: {                  &quot;container_port&quot;: 80,                  &quot;internal&quot;: false,                  &quot;restrict_access_to&quot;: [                      &quot;0.0.0.0/0&quot;                  ]              },              &quot;memory_reservation&quot;: 100          }      }  }```### 3. Service configuration with volume mount:```json  {      &quot;notifications_arn&quot;: &quot;&lt;SNS Topic ARN&gt;&quot;,      &quot;services&quot;: {          &quot;Test123&quot;: {              &quot;command&quot;: null,              &quot;volume&quot;: {                  &quot;efs_id&quot; : &quot;fs-XXXXXXX&quot;,                  &quot;efs_directory_path&quot; : &quot;/&quot;,                  &quot;container_path&quot; : &quot;/&quot;              },              &quot;http_interface&quot;: {                  &quot;container_port&quot;: 80,                  &quot;internal&quot;: false,                  &quot;restrict_access_to&quot;: [                      &quot;0.0.0.0/0&quot;                  ]              },              &quot;memory_reservation&quot;: 100          }      }  }```### 4. Service configuration with http interface only:```json  {      &quot;notifications_arn&quot;: &quot;&lt;SNS Topic ARN&gt;&quot;,      &quot;services&quot;: {          &quot;Test123&quot;: {              &quot;command&quot;: null,              &quot;http_interface&quot;: {                  &quot;container_port&quot;: 80,                  &quot;internal&quot;: false,                  &quot;restrict_access_to&quot;: [                      &quot;0.0.0.0/0&quot;                  ]              },              &quot;memory_reservation&quot;: 100          }      }  }```### 5. Service configuration with http interface without AWS CW logging.&gt; **_NOTE:_** Do not use `logging: null` in production. Once container  gets deleted all logs will be lost. Logging configuration should be one of the following: `awslog`, `fluentd`,`null````json  {      &quot;notifications_arn&quot;: &quot;&lt;SNS Topic ARN&gt;&quot;,      &quot;services&quot;: {          &quot;Test123&quot;: {              &quot;command&quot;: null,              &quot;http_interface&quot;: {                  &quot;container_port&quot;: 80,                  &quot;internal&quot;: false,                  &quot;restrict_access_to&quot;: [                      &quot;0.0.0.0/0&quot;                  ]              },              &quot;memory_reservation&quot;: 100,              &quot;logging&quot;: null          }      }  }```## Contributing to cloudlift### Setup#### Use the latest git master ```shgit clone git@github.com:GetSimpl/cloudlift.gitcd cloudlift./install-cloudlift.sh```To ensure the tests use the development version and not the installed version run (refer [here](https://stackoverflow.com/a/20972950/227705))```pip install -e .```### TestsFirst level of tests have been added to assert cloudformation template generatedvs expected one.```shpy.test test/deployment/```To run high level integration tests```shpytest -s test/test_cloudlift.py```This tests expects to have an access to AWS console.Since there's no extensive test coverage, it's better to manually test theimpacted areas whenever there's a code change.</longdescription>
</pkgmetadata>