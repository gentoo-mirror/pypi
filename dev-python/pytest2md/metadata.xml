<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>---author: gkversion: 20200602---# Generating Markdown - While Testing Contained Claims[![Build Status](https://travis-ci.org/axiros/pytest2md.svg?branch=master)](https://travis-ci.org/axiros/pytest2md) [![codecov](https://codecov.io/gh/axiros/pytest2md/branch/master/graph/badge.svg)](https://codecov.io/gh/axiros/pytest2md)[![PyPI    version][pypisvg]][pypi] [![][blacksvg]][black][blacksvg]: https://img.shields.io/badge/code%20style-black-000000.svg[black]: https://github.com/ambv/black[pypisvg]: https://img.shields.io/pypi/v/pytest2md.svg[pypi]: https://badge.fury.io/py/pytest2md&lt;!-- badges: http://thomas-cokelaer.info/blog/2014/08/1013/ --&gt;&lt;!-- only hoster for this repo is github, so we fix the links: --&gt;&lt;!-- md_links_for: github --&gt;&lt;!-- TOC --&gt;# Table Of Contents- &lt;a name=&quot;toc1&quot;&gt;&lt;/a&gt;[Inline Python Function Execution](#inline-python-function-execution)- &lt;a name=&quot;toc2&quot;&gt;&lt;/a&gt;[Features](#features)    - &lt;a name=&quot;toc3&quot;&gt;&lt;/a&gt;[html_table](#html-table)    - &lt;a name=&quot;toc4&quot;&gt;&lt;/a&gt;[sh_file](#sh-file)    - &lt;a name=&quot;toc5&quot;&gt;&lt;/a&gt;[bash_run](#bash-run)    - &lt;a name=&quot;toc6&quot;&gt;&lt;/a&gt;[md_from_source_code](#md-from-source-code)    - &lt;a name=&quot;toc7&quot;&gt;&lt;/a&gt;[Table of Contents](#table-of-contents)- &lt;a name=&quot;toc8&quot;&gt;&lt;/a&gt;[Link Replacements](#link-replacements)    - &lt;a name=&quot;toc9&quot;&gt;&lt;/a&gt;[Spec](#spec)    - &lt;a name=&quot;toc10&quot;&gt;&lt;/a&gt;[Code Repo Hoster Specific Source Links](#code-repo-hoster-specific-source-links)        - &lt;a name=&quot;toc11&quot;&gt;&lt;/a&gt;[Setting a link template](#setting-a-link-template)        - &lt;a name=&quot;toc12&quot;&gt;&lt;/a&gt;[Link Refs](#link-refs)    - &lt;a name=&quot;toc13&quot;&gt;&lt;/a&gt;[Summary](#summary)- &lt;a name=&quot;toc14&quot;&gt;&lt;/a&gt;[Tips](#tips)- &lt;a name=&quot;toc15&quot;&gt;&lt;/a&gt;[Isolation](#isolation)&lt;!-- TOC --&gt;Few things are more annoying than stuff which does not work as announced,especially when you find out only after an invest of time and energy.Documentation is often prone to produce such situations, since hard to keep100% in sync with the code evolution.&lt;!-- autogen tutorial --&gt;This is a set of tools, *generating* documentation, while verifying the documentedclaims about code behaviour - without the need to adapt the source code, e.g. by modifyingdoc strings:![](./assets/shot1.png)&gt; When the documentation is using a lot of code examples then a very welcomeadditional benefit of writing it like shown is the availability of [sourcecode autoformatters](https://github.com/ambv/black).Other Example:This &quot;README.md&quot; was built into [this](./.README.tmpl.md) template,where [html comment style placeholders][.README.tmpl.md]had been replaced while running pytest on [test_tutorial](./tests/test_tutorial.py).Lets run a bash command and assert on its results.Note that the command is shown in the readme, incl. result and the resultcan be asserted upon.```bash$ cat &quot;/etc/hosts&quot; | grep localhost127.0.0.1   axc3.axiros.com localhost localhost.localdomain localhost4 localhost4.localdomain4::1         localhost localhost.localdomain localhost6 localhost6.localdomain6``````bash$ ls &quot;/home/gk/repos/pytest2md/tests&quot;assets__pycache__test_basics.pytest_changelog.pytest_tutorial.py$ ls -lta /etc/hosts-rw-r--r--. 1 root root 308 May  8 23:47 /etc/hosts```----Generated by:# &lt;a href=&quot;#toc1&quot;&gt;Inline Python Function Execution&lt;/a&gt;via the `md_from_source_code` function you can write fluent markdown(tested) python combos:  ```pythonhi = 'hello world'assert 'world' in hiprint(hi.replace('world', 'joe'))```The functions are evaluated and documented in the order they show upwithin the textblocks.&gt; Please keep tripple apostrophes - we split the text blocks,searching for those.State is kept within the outer pytest function, like normally in python.I.e. if you require new state, then start a new pytest function.Stdout is redirected to an output collector function, i.e. if you printthis does result in an &quot;Output&quot; block. If the printout starts with&quot;MARKDOWN:&quot; then we won't wrap that output into fenced code blocks butdisplay as is.&gt; If the string 'breakpoint' occurs in a function body, we won't redirectstandardout for displaying output.# &lt;a href=&quot;#toc2&quot;&gt;Features&lt;/a&gt;## &lt;a href=&quot;#toc3&quot;&gt;html_table&lt;/a&gt;```pythonht = p2m.html_tableprint(ht([['foo', 'bar'], ['bar', 'baz']], ['h1', 'h2']))print('As details when summary arg is given:')t = ht(    [['joe', 'doe'], ['suzie', 'wong']],    ['first', 'last'],    summary='names. click to open...',)assert 'details' in tassert 'joe&lt;/td' in tprint(t)```## &lt;a href=&quot;#toc4&quot;&gt;sh_file&lt;/a&gt;```javascript$ cat &quot;test_file.json&quot;{    &quot;a&quot;: [        {            &quot;testfile&quot;: &quot;created&quot;        },        &quot;at&quot;,        &quot;Thu Jun  4 00:15:07 2020&quot;    ]}```&lt;details&gt;&lt;summary&gt;as details&lt;/summary&gt;```javascript$ cat &quot;test_file.json&quot;{    &quot;a&quot;: [        {            &quot;testfile&quot;: &quot;created&quot;        },        &quot;at&quot;,        &quot;Thu Jun  4 00:15:07 2020&quot;    ]}```&lt;/details&gt;[test_file.json](./tests/assets/sh_files/test_file.json)[as link](./tests/assets/sh_files/test_file.json)----Generated by:```python# if content is given it will create it:p2m.sh_file(fn, lang='javascript', content=c)# summary arg creates a details structure:p2m.sh_file(fn, lang='javascript', content=c, summary='as details')# creates a link (say True to have the filename as link text)p2m.sh_file(fn, lang='javascript', content=c, as_link=True)p2m.sh_file(fn, lang='javascript', content=c, as_link='as link')```## &lt;a href=&quot;#toc5&quot;&gt;bash_run&lt;/a&gt;```bash$ ./some_non_existing_command_in_assets arg1/bin/sh: /home/gk/repos/pytest2md/tests/assets/some_non_existing_command_in_assets: No such file or directory``````bash$ ls -lta | grep total | head -n 1total 84``````bash$ ls -ltatotal 84-rw-r--r--.  1 gk gk 14890 Jun  4 00:15 README.mddrwxr-xr-x.  4 gk gk  4096 Jun  4 00:14 testsdrwxr-xr-x.  8 gk gk  4096 Jun  4 00:09 .gitdrwxr-xr-x.  9 gk gk  4096 Jun  4 00:09 ....(output truncated - see link below)```- [Output](./tests/assets/bash_run_outputs/bash_run.txt) of `ls -lta`  ```bash$ ls -lta```[ls -lta](./tests/assets/bash_run_outputs/bash_run.html)----Generated by:```pythonrun = partial(p2m.bash_run, cmd_path_from_env=True)# by default we search in normal environ for the command to run# but we provide a switch to search in test assets.# errors are redirected to stdoutres = p2m.bash_run(    'some_non_existing_command_in_assets arg1',    cmd_path_from_env=False,    ign_err=True,)assert res[0]['exitcode'] != 0res = run('ls -lta | grep total | head -n 1')assert 'total' in res[0]['res']res = run('ls -lta', into_file='bash_run.txt')assert 'total' in res[0]['res']# Ending with .html it converts ansi escape colors to html:# simple link is created.# (requires pip install ansi2html)run('ls -lta', into_file='bash_run.html')```## &lt;a href=&quot;#toc6&quot;&gt;md_from_source_code&lt;/a&gt;Inserted markdown from running python.Strings in double apos. are rendered, no need to call a render function.  ```pythonmd('Inserted markdown from running python.')print('From output of running python ')```Output:```From output of running python```&gt; More  markdown  ```pythonprint('From another function')```Output:```From another function```Strings can also contain instructions, like this (looked up in p2m.MdInline namespace class)```bash$ cd /etc; ls -lta | head -n 5total 2716drwxr-xr-x. 165 root root     12288 Jun  3 09:04 .-rw-r--r--.   1 root root    139649 Jun  3 09:04 ld.so.cache-rw-r--r--.   1 root root        67 Jun  3 07:44 resolv.confdrwxr-xr-x.   2 root root      4096 Jun  1 19:02 alternatives```Default inline functions (add your own in module headers):  ```pythonprint(    [        k        for k in dir(pytest2md.MdInline)        if not k.startswith('_')    ])```Output:```['bash', 'sh_file']```----Generated by```python        def some_test_function():            &quot;&quot;&quot;            Strings in double apos. are rendered, no need to call a render function.            &quot;&quot;&quot;            def func1():                md('Inserted markdown from running python.')                print('From output of running python ')            &quot;&quot;&quot;            &gt; More  markdown            &quot;&quot;&quot;            def func2():                print('From another function')            &quot;&quot;&quot;            Strings can also contain instructions, like this (looked up in p2m.MdInline namespace class)            &lt;bash: cd MY_REPL_DIR; ls -lta | head -n 5&gt;            Default inline functions (add your own in module headers):            &quot;&quot;&quot;            def known():                print(                    [                        k                        for k in dir(pytest2md.MdInline)                        if not k.startswith('_')                    ]                )            # repl dict simply replaces keys with values before any processing:            p2m.md_from_source_code(repl={'MY_REPL_DIR': '/etc'})```## &lt;a href=&quot;#toc7&quot;&gt;Table of Contents&lt;/a&gt;    p2m.write_markdown(with_source_ref=True, make_toc=True)See this tutorial.# &lt;a href=&quot;#toc8&quot;&gt;Link Replacements&lt;/a&gt;Technical markdown content wants to link to source code often.How to get those links working and that convenient?The module does offer also some source finding / link replacement feature,via the [mdtool][mdtool.py] module. The latter link was built simply by this:```[mdtool]&lt;SRC&gt;```Other example: This [test_tutorial.py][test_tutorial.py] link was created by replacing &quot;SRC&quot; with the pathto a file matching, under a given directory, prefixed by an arbitrary base URL.## &lt;a href=&quot;#toc9&quot;&gt;Spec&lt;/a&gt;These will be replaced:`[title:this,fmatch:test_tutorial,lmatch:line_match] &lt;SRC&gt;` (remove space between] and &lt;)- title: The link title - text the user reads- fmatch: substring match for the link destination file- lmatch: Find matching line within that file- show_raw: Link to raw version of file, not the one rendered by the  repo server- path: Fix file path (usually derived by fmach)- line: Fix the line number of the link (usually done via lmatch)## &lt;a href=&quot;#toc10&quot;&gt;Code Repo Hoster Specific Source Links&lt;/a&gt;Github, Gitlab, Bitbucked or Plain directory based static content serversall have their conventional URLs regarding those links.Since all of these are just serving static content w/o js possibilities,you have to parametrize the intended hoster in your environment, beforerunning a pytest / push cycle. That way the links will be working on the hoster.Currently we understand the following namespaces for links:```javascript{    &quot;github&quot;: &quot;https://github.com/%(gh_repo_name)s/blob/%(git_rev)s/%(path)s%(line:#L%s)s&quot;,    &quot;github_raw&quot;: &quot;https://raw.githubusercontent.com/%(gh_repo_name)s/%(git_rev)s/%(path)s%(line:#L%s)s&quot;,    &quot;static&quot;: &quot;file://%(d_repo_base)s/%(path)s&quot;,    &quot;static_raw&quot;: &quot;file://%(d_repo_base)s/%(path)s&quot;}```### &lt;a href=&quot;#toc11&quot;&gt;Setting a link template&lt;/a&gt;- `export MD_LINKS_FOR=github   ` # before running pytest / push- `&lt;!-- md_links_for: github --&gt;` # in the markdown template, staticThe latter can be overwritten by environ, should you want to push from time to timeto a different code hoster.### &lt;a href=&quot;#toc12&quot;&gt;Link Refs&lt;/a&gt;We minimize the problem of varying generated target markdown, dependent on the hoster.How? Like [any problem in IT is solved](https://en.wikipedia.org/wiki/Fundamental_theorem_of_software_engineering).By building [reference links](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet#links)the differences of e.g. a README.md for github vs. gitlab isrestricted to the links section on the end of the generated markdown.In the markdown bodies you'll just see link names, which remain the same.&gt; Check the end of the [rendering result][README.md] at the end of this README.md,in order to see the results for the hoster you are reading this markdown file currently.## &lt;a href=&quot;#toc13&quot;&gt;Summary&lt;/a&gt;- At normal runs of pytest, the link base URL is just a local `file://` link,- Before pushes one can set via environ (e.g. `export  MD_LINKS_FOR=github`)  these e.g. to the github base URL or the repo.- `[key-values]` constructs are supported as well, extending to beyond  just the base url. Example following:Source code showing is done like this:```python    def test_sh_code(self):        md('Source code showing is done like this:')        p2m.sh_code(self.test_sh_code)        md(            '&gt; Is [title:this,fmatch:test_tutorial,lmatch:exotic]&lt;SRC&gt; an exotic form of a recursion? ;-)  '        )```&gt; Is [this][test_tutorial.py#325] an exotic form of a recursion? ;-)  &lt;details&gt;&lt;summary&gt;Command Summary&lt;/summary&gt;```bashcat &quot;/etc/hosts&quot; | grep localhostls &quot;/home/gk/repos/pytest2md/tests&quot;ls -lta /etc/hosts/home/gk/repos/pytest2md/tests/assets/some_non_existing_command_in_assets arg1ls -lta | grep total | head -n 1ls -ltals -lta```&lt;/details&gt;*Auto generated by [pytest2md](https://github.com/axiros/pytest2md), running [./tests/test_tutorial.py](./tests/test_tutorial.py)&lt;!-- autogen tutorial --&gt;# &lt;a href=&quot;#toc14&quot;&gt;Tips&lt;/a&gt;- Skip &quot;inner&quot; functions, except matching ones: `export P2RUN=my_func_name_match`- Turn off stdout redirection: `export P2MFG=true` (for breakpoints in tested modules)- Local Renderer:    pip install gripto get a local github compliant markdown renderer, reloading after changes of the generated markdown.- Using fixtures with unittest style test classesCreate a `conftest.py` like:```pythonroot@localhost tests]# cat conftest.pyimport pytestimport pytest2md as p2m@pytest.fixture(scope='class')def write_md(request):    def fin():        request.cls.p2m.write_markdown(with_source_ref=True, make_toc=False)    request.addfinalizer(fin)```then use like:```@pytest.mark.usefixtures('write_md')class TestDevUsage(unittest.TestCase):    p2m = p2m # on module level: p2m.P2M(__file__, fn_target_md='README.md')    (...)```# &lt;a href=&quot;#toc15&quot;&gt;Isolation&lt;/a&gt;None. If you would screw up your host running pytest normally, then you willget the same result, when running markdown generating tests.----[Here](https://github.com/axiros/pycond) is a bigger tutorial, from `pytest2md`.&lt;!-- autogenlinks --&gt;[.README.tmpl.md]: https://raw.githubusercontent.com/axiros/pytest2md/d7c23813ea77f821e8c83571849dce02ac197290/.README.tmpl.md[README.md]: https://raw.githubusercontent.com/axiros/pytest2md/d7c23813ea77f821e8c83571849dce02ac197290/README.md[mdtool.py]: https://github.com/axiros/pytest2md/blob/d7c23813ea77f821e8c83571849dce02ac197290/pytest2md/mdtool.py[test_tutorial.py]: https://github.com/axiros/pytest2md/blob/d7c23813ea77f821e8c83571849dce02ac197290/tests/test_tutorial.py[test_tutorial.py#325]: https://github.com/axiros/pytest2md/blob/d7c23813ea77f821e8c83571849dce02ac197290/tests/test_tutorial.py#L325</longdescription>
</pkgmetadata>