<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># django-pint-fieldUse [pint](https://pint.readthedocs.io/en/stable/) with Django's ORM.If you want to store quantities (1 gram, 3 miles, 8.120391 angstroms, etc) in a model, edit them in forms, and have the ability to convert to other quantities in your django projects, this is the package for you!This package is modified from the fantastic [django-pint](https://github.com/CarliJoy/django-pint) with different goals. Unlike django-pint, in this project we use a composite Postgres field to store both the magnitude and the user's desired units, along with the equivalent value in base units. This third piece of date - the base units - makes it possible to conduct lookups comparing one instance that might be specified in &quot;grams&quot; with another that may be specified in &quot;pounds&quot;, but display each instance in the units that the user desires. The units your users want to use are the units they see, while still allowing accurate comparisons of one quantity to another.For this reason, the project only works with Postgresql databases.## Install`pip install django_pint_field`Add `&quot;django_pint_field&quot;,` to your list of installed apps.Run `python manage.py migrate django_pint_field`## UsageAssuming we are starting with the following model:```pythonfrom decimal import Decimalfrom django.db import modelsfrom django.db.models import DecimalFieldfrom django_pint_field.models import IntegerPintFieldclass IntegerPintFieldSaveModel(models.Model):    name = models.CharField(max_length=20)    weight = IntegerPintField(&quot;gram&quot;)    def __str__(self):        return str(self.name)```We can do the following:```pythonfrom decimal import Decimalfrom django_pint_field.units import uregfrom .models import IntegerPintFieldSaveModelQuantity = ureg.Quantity# Start by creating a few Pint Quantity objectsextra_small = Quantity(1 * ureg.gram)small = Quantity(10 * ureg.gram)medium = Quantity(100 * ureg.gram)large = Quantity(1000 * ureg.gram)extra_large = Quantity(10000 * ureg.gram)# Create a couple objectsIntegerPintFieldSaveModel.objects.create(name=&quot;small&quot;, weight=small)IntegerPintFieldSaveModel.objects.create(name=&quot;large&quot;, weight=large)In [1]: IntegerPintFieldSaveModel.objects.first()Out[1]: &lt;IntegerPintFieldSaveModel: small&gt;In [2]: IntegerPintFieldSaveModel.objects.first().weightOut[2]: 10 &lt;Unit('gram')&gt;In [3]: IntegerPintFieldSaveModel.objects.first().weight.magnitudeOut[3]: 10In [4]: IntegerPintFieldSaveModel.objects.first().weight.unitsOut[4]: &lt;Unit('gram')&gt;```## Valid LookupsOther lookups will be added in the future. Currently available are:- exact- gt- gte- lt- lte- range- isnull```python# Perform some queriesIntegerPintFieldSaveModel.objects.filter(weight__gt=medium)&lt;QuerySet [&lt;IntegerPintFieldSaveModel: large&gt;]&gt;IntegerPintFieldSaveModel.objects.filter(weight__gt=extra_small)&lt;QuerySet [&lt;IntegerPintFieldSaveModel: small&gt;, &lt;IntegerPintFieldSaveModel: large&gt;]&gt;IntegerPintFieldSaveModel.objects.filter(weight__gte=small)&lt;QuerySet [&lt;IntegerPintFieldSaveModel: small&gt;, &lt;IntegerPintFieldSaveModel: large&gt;]&gt;IntegerPintFieldSaveModel.objects.filter(weight__range=(small, medium))&lt;QuerySet [&lt;IntegerPintFieldSaveModel: small&gt;]&gt;```## AggregatesA number of aggregates have been implemented for the Django Pint Fields. Functionally they perform for Pint Fields the same way django's default aggregates work for other field types, and each is prepended with &quot;Pint&quot;. The aggregates include:- PintAvg- PintCount- PintMax- PintMin- PintStdDev- PintSum- PintVariance```pythonfrom django_pint_field.aggregates import PintAvg, PintCount, PintMax, PintMin, PintStdDev, PintSum, PintVariance# Perform some queriesIntegerPintFieldSaveModel.objects.aggregate(PintAvg('weight')){'weight__pintavg': Decimal('0.50500000000000000000') &lt;Unit('kilogram')&gt;}IntegerPintFieldSaveModel.objects.aggregate(PintCount('weight')){'weight__pintcount': 2}IntegerPintFieldSaveModel.objects.aggregate(PintMax('weight')){'weight__pintmax': Decimal('1.0') &lt;Unit('kilogram')&gt;}IntegerPintFieldSaveModel.objects.aggregate(PintMin('weight')){'weight__pintmin': Decimal('0.01') &lt;Unit('kilogram')&gt;}IntegerPintFieldSaveModel.objects.aggregate(PintStdDev('weight')){'weight__pintstddev': Decimal('0.49500000000000000000') &lt;Unit('kilogram')&gt;}IntegerPintFieldSaveModel.objects.aggregate(PintSum('weight')){'weight__pintsum': Decimal('1.01') &lt;Unit('kilogram')&gt;}IntegerPintFieldSaveModel.objects.aggregate(PintVariance('weight')){'weight__pintvariance': Decimal('0.24502500000000000000') &lt;Unit('kilogram')&gt;}```## Use with Django Rest Framework```pythonfrom django_pint_field.rest import IntegerPintRestFieldclass DjangoPintFieldSerializer(serializers.ModelSerializer):    # Let DRF know which type of serializer field to use    weight = IntegerPintRestField()    class Meta:        model = IntegerPintFieldSaveModel        fields = [&quot;name&quot;, &quot;weight&quot;]```## Creating your own unitsYou can [create your own pint units](https://pint.readthedocs.io/en/stable/advanced/defining.html) if the [default units](https://github.com/hgrecco/pint/blob/master/pint/default_en.txt) in pint are not sufficient.Anywhere within your project (ideally in settings or a file adjacent to settings), define the custom unit registry by importing Pint's default UnitRegistry and extending it:```pythonfrom pint import UnitRegistrycustom_ureg = UnitRegistry()custom_ureg.define(&quot;custom = [custom]&quot;)custom_ureg.define(&quot;kilocustom = 1000 * custom&quot;)```Then add the custom registry to your app's settings.py:`DJANGO_PINT_FIELD_UNIT_REGISTER = custom_ureg`## Model Fields- **IntegerPintField**: Stores a pint measurement as an integer (-2147483648 to 2147483647).- **BigIntegerPintField**: Stores a pint measurement as a big integer (-9223372036854775808 to 9223372036854775807).- **DecimalPintField**: Stores a pint measurement as a decimal. Like Django's DecimalField, DecimalPintField takes required `max_digits` and `decimal_places` parameters.## Form Fields- **IntegerPintFormField**: Used in forms with IntegerPintField and BigIntegerPintField.- **DecimalPintFormField**: Used in forms with DecimalPintField.## Widgets- **PintFieldWidget**: Default widget for all django pint field types.- **TabledPintFieldWidget**: Provides a table showing conversion to each of the `unit_choices`.![TabledPintFieldWidget](https://raw.githubusercontent.com/jacklinke/django-pint-field/main/media/TabledPintFieldWidget.png)Example usage:```pythonclass WeightModel(models.Model):    decimal_weight = DecimalPintField(        &quot;gram&quot;,        blank=True,        null=True,        max_digits=10,        decimal_places=2,        unit_choices=[            &quot;kilogram&quot;,            &quot;milligram&quot;,            &quot;pounds&quot;        ],    )class TabledWeightForm(forms.ModelForm):    class Meta:        model = WeightModel        fields = &quot;__all__&quot;    def __init__(self, *args, **kwargs):        super().__init__(*args, **kwargs)        # If we want to use the tabled widget, we need to pass the         #   default_unit and unit_choices to the new widget        default_unit = self.fields[&quot;decimal_weight&quot;].default_unit        unit_choices = self.fields[&quot;decimal_weight&quot;].unit_choices        self.fields[&quot;decimal_weight&quot;].widget = TabledPintFieldWidget(            default_unit=default_unit, unit_choices=unit_choices        )```The template for this widget is located at https://github.com/jacklinke/django-pint-field/blob/main/django_pint_field/templates/tabled_django_pint_field_widget.htmlIf you want to override the template, add your own template in your project at: &quot;templates/django_pint_field/tabled_django_pint_field_widget.html&quot;## DRF Serializer Fields- **IntegerPintRestField**: Used in DRF with IntegerPintField and BigIntegerPintField.- **DecimalPintRestField**: Used in DRF with DecimalPintField.## Settings&lt;dl&gt;  &lt;dt&gt;&lt;code&gt;DJANGO_PINT_FIELD_DECIMAL_PRECISION&lt;/code&gt;&lt;/dt&gt;  &lt;dd&gt;    Determines whether django_pint_field should automatically set the python decimal precision for the project. If an integer greater than 0 is provided, the decimal context precision for the entire project will be set to that value. Otherwise, the precision remains at the default (usually 28).&lt;br&gt;    &lt;em&gt;* Type: int&lt;/em&gt;    &lt;em&gt;* Default: 0&lt;/em&gt;  &lt;/dd&gt;  &lt;dt&gt;&lt;code&gt;DJANGO_PINT_FIELD_UNIT_REGISTER&lt;/code&gt;&lt;/dt&gt;  &lt;dd&gt;    The Unit Registry to use in the project. Defaults to pint.UnitRegistry.&lt;br&gt;    &lt;em&gt;* Type: int&lt;/em&gt;    &lt;em&gt;* Default: 0&lt;/em&gt;  &lt;/dd&gt;&lt;/dl&gt;## Rounding modes (upcoming feature)**decimal.ROUND_CEILING**Round towards Infinity.**decimal.ROUND_DOWN**Round towards zero.**decimal.ROUND_FLOOR**Round towards -Infinity.**decimal.ROUND_HALF_DOWN**Round to nearest with ties going towards zero.**decimal.ROUND_HALF_EVEN**Round to nearest with ties going to nearest even integer.**decimal.ROUND_HALF_UP**Round to nearest with ties going away from zero.**decimal.ROUND_UP**Round away from zero.**decimal.ROUND_05UP**Round away from zero if last digit after rounding towards zero would have been 0 or 5; otherwise round towards zero.Read more about rounding modes for decimals at the [decimal docs](https://docs.python.org/3/library/decimal.html#rounding-modes)## Use the test app with docker compose### Set up a virtual environment (recommended)Make a virtual environment named `.venv`:`python3 -m venv .venv`    Activate the new environment:`source .venv/bin/activate`### Install dependencies*Requires [poetry](https://python-poetry.org/). If you do not yet have it installed, run `pip install poetry`.*`poetry install --with dev`### Build and bring up```docker compose builddocker compose run django python manage.py migratedocker compose run django python manage.py createsuperuserdocker compose up -d```Navigate to `127.0.0.1:8000`### Test (assuming you have already performed `build`)`docker compose run django python manage.py test`## Run psql on the Postgres database`docker compose exec postgres psql -U postgres`## ToDos:- Implement rounding modes- Think through what it would take to build range types for these fields- Add extensible widget template</longdescription>
</pkgmetadata>