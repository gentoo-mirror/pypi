<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># Kubernetes CopilotKubernetes Copilot powered by OpenAI.**Status: Experimental****Caution: Copilot may generate and execute inappropriate operations, do not use in production environment!**Features:* Automatically operate Kubernetes cluster based on prompt instructions.* Human interactions on uncertain instructions to avoid inappropriate operations.* Native kubectl and bash commands for accessing Kubernetes cluster.* Web access and Google search support without leaving the terminal.## InstallInstall the copilot with pip command below:```shpip install kube-copilot```## Setup* `kubectl` should be [installed](https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/) in the local machine and kubeconfig file should be configured to access kubernetes cluster.* `docker` should be [installed](https://docs.docker.com/engine/install/) to evaluate the security issues of container images (for `audit` command).* OpenAI [API key](https://platform.openai.com/account/api-keys) should be set to `OPENAI_API_KEY` environment variable to enable the ChatGPT feature.  * `OPENAI_API_BASE` should be set as well for [Azure OpenAI service](https://learn.microsoft.com/en-us/azure/cognitive-services/openai/quickstart?tabs=command-line&amp;pivots=rest-api#retrieve-key-and-endpoint).* Google search is not enabled by default. Set `GOOGLE_API_KEY` and `GOOGLE_CSE_ID` if you want to enable it (get from [here](https://cloud.google.com/docs/authentication/api-keys?visit_id=638154888929258210-4085587461) and [here](http://www.google.com/cse/ )).## How to use```shUsage: kube-copilot [OPTIONS] COMMAND [ARGS]...  Kubernetes Copilot powered by OpenAIOptions:  --version  Show the version and exit.  --help     Show this message and exit.Commands:  audit     audit security issues for a Pod  diagnose  diagnose problems for a Pod  execute   execute operations based on prompt instructions```### Audit Security Issues for Pod`kube-copilot audit POD [NAMESPACE]` will audit security issues for a Pod:```shUsage: kube-copilot audit [OPTIONS] POD [NAMESPACE]  audit security issues for a PodOptions:  --short            Disable verbose information of copilot execution steps  --model TEXT       OpenAI model to use for copilot execution, default is                     gpt-3.5-turbo  --enable-terminal  Enable Copilot to run programs within terminal. Enable                     with caution since Copilot may execute inappropriate                     commands  --help             Show this message and exit.```Here is an example of auditing a Pod with old nginx image (note `image cve` is the ad-hoc prompt during the auditing process):```sh# kube-copilot audit nginx-6cc9f5fc9f-qxlxt&gt; Entering new AgentExecutor chain...Thought: I need to gather more information about the Pod and its configuration to start the audit.Action:{  &quot;action&quot;: &quot;Terminal&quot;,  &quot;action_input&quot;: &quot;kubectl get pod nginx-6cc9f5fc9f-qxlxt -n default -o yaml&quot;}Observation: apiVersion: v1kind: Podmetadata:  creationTimestamp: &quot;2023-03-25T11:08:16Z&quot;  generateName: nginx-6cc9f5fc9f-  labels:    app: nginx    pod-template-hash: 6cc9f5fc9f  name: nginx-6cc9f5fc9f-qxlxt  namespace: default  ownerReferences:  - apiVersion: apps/v1    blockOwnerDeletion: true    controller: true    kind: ReplicaSet    name: nginx-6cc9f5fc9f    uid: 09ccf31f-4b05-4327-aed2-a64f4fed6293  resourceVersion: &quot;221300881&quot;  uid: 544cd5bc-a126-40d8-9b46-a9ff0ee1df55spec:  containers:  - image: nginx:1.21.0    imagePullPolicy: IfNotPresent    name: nginx  ...Thought:I will now analyze the information obtained from the Pod and check for any possible security issues.Action:{  &quot;action&quot;: &quot;Human&quot;,  &quot;action_input&quot;: &quot;What are the main security concerns related to Kubernetes and cloud native technologies that I should be checking for?&quot;}What are the main security concerns related to Kubernetes and cloud native technologies that I should be checking for?image cveObservation: image cveThought:I need to check if the nginx image used in this Pod has any known CVE vulnerabilities.Action:{  &quot;action&quot;: &quot;Terminal&quot;,  &quot;action_input&quot;: &quot;trivy image --severity HIGH,CRITICAL nginx:1.21.0&quot;}Observation: 2023-03-25T11:23:13.756ZINFOVulnerability scanning is enabled2023-03-25T11:23:13.756ZINFOSecret scanning is enabled2023-03-25T11:23:13.756ZINFOIf your scanning is slow, please try '--scanners vuln' to disable secret scanning2023-03-25T11:23:13.756ZINFOPlease see also https://aquasecurity.github.io/trivy/v0.38/docs/secret/scanning/#recommendation for faster secret detection2023-03-25T11:23:13.766ZINFODetected OS: debian2023-03-25T11:23:13.766ZINFODetecting Debian vulnerabilities...2023-03-25T11:23:13.787ZINFONumber of language-specific files: 0nginx:1.21.0 (debian 10.10)===========================Total: 125 (HIGH: 95, CRITICAL: 30)...```### Diagnose Problems for Pod`kube-copilot diagnose POD [NAMESPACE]` will diagnose problems for a Pod:```shUsage: kube-copilot diagnose [OPTIONS] POD [NAMESPACE]  diagnose problems for a PodOptions:  --short            Disable verbose information of copilot execution steps  --model TEXT       OpenAI model to use for copilot execution, default is                     gpt-3.5-turbo  --enable-terminal  Enable Copilot to run programs within terminal. Enable                     with caution since Copilot may execute inappropriate                     commands  --help             Show this message and exit.```Here is an example of diagnosing a problem Pod:```sh# kube-copilot diagnose nginx-944b5f9bd-ch67l&gt; Entering new AgentExecutor chain...Question: What is the issue with the Pod nginx-944b5f9bd-ch67l in namespace default?Thought: I need to gather more information about the Pod before attempting to diagnose any issues.Action:{  &quot;action&quot;: &quot;Terminal&quot;,  &quot;action_input&quot;: &quot;kubectl describe pod nginx-944b5f9bd-ch67l -n default&quot;}Observation: Name:             nginx-944b5f9bd-ch67lNamespace:        defaultStart Time:       Sat, 25 Mar 2023 11:27:15 +0000Labels:           app=nginx                  pod-template-hash=944b5f9bdAnnotations:      &lt;none&gt;Status:           PendingContainers:  nginx:    Container ID:    Image:          nginx:1.21.100  ...Thought:The Pod nginx-944b5f9bd-ch67l in namespace default is in Pending state, and the container inside it is in Waiting state with Reason as ImagePullBackOff. This indicates that the container is unable to pull the required image from the registry. Looking at the Event logs, we see that the image &quot;nginx:1.21.100&quot; could not be pulled due to a &quot;NotFound&quot; error. To resolve this issue, we need to check if the required image is available in the container registry and if it has the correct image name and tag.Action:{  &quot;action&quot;: &quot;Terminal&quot;,  &quot;action_input&quot;: &quot;kubectl get pods nginx-944b5f9bd-ch67l -n default -o yaml | grep image:&quot;}Observation:   - image: nginx:1.21.100  - image: nginx:1.21.100Thought:The image name and tag in the Pod configuration file match the name and tag of the image that needs to be pulled. This means that the issue is not with the image configuration in the Pod file.Action:{  &quot;action&quot;: &quot;Terminal&quot;,  &quot;action_input&quot;: &quot;kubectl describe pod nginx-944b5f9bd-ch67l -n default | grep -i events -A 5&quot;}Observation: Events:  Type     Reason     Age                    From               Message  ----     ------     ----                   ----               -------  Normal   Pulling    5m6s (x4 over 6m43s)   kubelet            Pulling image &quot;nginx:1.21.100&quot;  Warning  Failed     5m5s (x4 over 6m42s)   kubelet            Failed to pull image &quot;nginx:1.21.100&quot;: rpc error: code = NotFound desc = failed to pull and unpack image &quot;docker.io/library/nginx:1.21.100&quot;: failed to resolve reference &quot;docker.io/library/nginx:1.21.100&quot;: docker.io/library/nginx:1.21.100: not foundThought:From the Event logs, we can see that the image could not be found in the Docker registry. This indicates that the image has not been pushed to the required registry, or the image name and tag is incorrect. To resolve this issue, we need to either push the required image to the Docker registry or update the Pod configuration file with the correct image name and tag.Action:{  &quot;action&quot;: &quot;Human&quot;,  &quot;action_input&quot;: &quot;Can you check if the image nginx:1.21.100 is available in Dockerhub?&quot;}Can you check if the image nginx:1.21.100 is available in Dockerhub?NoObservation: NoThought:The required image is not available in Dockerhub. We need to update the Pod configuration file with the correct image repository address and/or update the image tag to use an existing image in the repository. This should help the container to pull the required image and run the Pod without issues.Action:{  &quot;action&quot;: &quot;Human&quot;,  &quot;action_input&quot;: &quot;Do you know the URL of a container registry that contains the required image?&quot;}Do you know the URL of a container registry that contains the required image?NoObservation: NoThought:We do not have any available container registry URL that contains the required image. We need to look for another image of the container with the correct image name and tag available on a container registry or build a new Docker image and push it to the registry with the correct name and tag.Final Answer: The issue with the Pod nginx-944b5f9bd-ch67l in namespace default is that the required image &quot;nginx:1.21.100&quot; could not be found in the Docker registry. It is recommended to either push the required image to the Docker registry or update the Pod configuration file with the correct image repository address and/or update the image tag to use an existing image in the repository. If the issue still persists, look for another image of the container with the correct image name and tag available on a container registry or build a new Docker image and push it to the registry with the correct name and tag.&gt; Finished chain.The issue with the Pod nginx-944b5f9bd-ch67l in namespace default is that the required image &quot;nginx:1.21.100&quot; could not be found in the Docker registry. It is recommended to either push the required image to the Docker registry or update the Pod configuration file with the correct image repository address and/or update the image tag to use an existing image in the repository. If the issue still persists, look for another image of the container with the correct image name and tag available on a container registry or build a new Docker image and push it to the registry with the correct name and tag.```### Execute Operations Based on Prompt Instructions`kube-copilot execute INSTRUCTIONS` will execute operations based on prompt instructions.It could also be used to ask any questions.```shUsage: kube-copilot execute [OPTIONS] INSTRUCTIONS  execute operations based on prompt instructionsOptions:  --short            Disable verbose information of copilot execution steps  --model TEXT       OpenAI model to use for copilot execution, default is                     gpt-3.5-turbo  --enable-terminal  Enable Copilot to run programs within terminal. Enable                     with caution since Copilot may execute inappropriate                     commands  --help             Show this message and exit.```Here is an example of querying the Pod consumed most CPU:```sh# kube-copilot execute &quot;list the the Pod consumed most CPU with its current CPU consumption&quot;Copilot may generate and execute inappropriate operations steps, are you sure to continue? [y/N]: y&gt; Entering new AgentExecutor chain...Thought: To complete the task, we need to use `Terminal` tool and run some kubectl commands to get the desired output.Action:{  &quot;action&quot;: &quot;Terminal&quot;,  &quot;action_input&quot;: &quot;kubectl top pods --all-namespaces | sort -k 3 -n -r | head -n 2 | tail -n 1&quot;}Observation: pl                                  pl-etcd-0                                                        46m          257MiThought:The output shows the Pod &quot;pl&quot; with its current CPU consumption at 257Mi. We need to further filter the output to show only the Pod name and its current CPU consumption.Action:{  &quot;action&quot;: &quot;Terminal&quot;,  &quot;action_input&quot;: &quot;kubectl top pods --all-namespaces | sort -k 3 -n -r | awk '{if (NR!=1){print $2,$3}}' | head -n 1&quot;}Observation: pl-etcd-0 46mThought:The current output shows the Pod name and CPU consumption in millicores. We need to convert the CPU consumption to a more readable format.Action:{  &quot;action&quot;: &quot;Terminal&quot;,  &quot;action_input&quot;: &quot;kubectl top pods --all-namespaces | sort -k 3 -n -r | awk '{if (NR!=1){print $2,$3\&quot;m\&quot;}}' | awk '{printf \&quot;%-50s %s\\n\&quot; ,$1, $2/1000\&quot;CPU\&quot;}'&quot;}Observation: pl-etcd-0                                          0.046CPUpl-etcd-1                                          0.045CPUpl-etcd-2                                          0.042CPU...Thought:The Pod that consumes most CPU with its current CPU consumption is &quot;pl-etcd-0&quot; with a consumption of 0.046CPU.Final Answer: pl-etcd-0 with a consumption of 0.046CPU.&gt; Finished chain.pl-etcd-0 with a consumption of 0.046CPU.```## ContributionThe project is opensource at github [feiskyer/kube-copilot](https://github.com/feiskyer/kube-copilot) with Apache License.If you would like to contribute to the project, please follow these guidelines:1. Fork the repository and clone it to your local machine.2. Create a new branch for your changes.3. Make your changes and commit them with a descriptive commit message.4. Push your changes to your forked repository.5. Open a pull request to the main repository.</longdescription>
</pkgmetadata>