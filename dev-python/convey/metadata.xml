<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># Convey[![Build Status](https://github.com/CZ-NIC/convey/actions/workflows/run-unittest.yml/badge.svg)](https://github.com/CZ-NIC/convey/actions) [![Downloads](https://pepy.tech/badge/convey)](https://pepy.tech/project/convey)Swiss knife for mutual conversion of the web related data types, like `base64` or outputs of the programs `whois`, `dig`, `curl`.A convenient way to quickly gather all meaningful information or to process large files that might freeze your spreadsheet processor.Any input is accepted:* if a **single value** input is detected, all **meaningful information** is fetched* multiline **base64**/**quoted_printable** string gets decoded* **log/XLS/XLSX/ODS file** converted to CSV* **CSV file** (any delimiter, header or [pandoc](https://pandoc.org/MANUAL.html#tables) table format) performs one or more actions    1) **Pick, delete or sort columns** (if only some columns are needed)    2) **Add a column** (computes one field from another – see below)    3) **Filter** (keep/discard rows with specific values, no duplicates)    4) **Split by a column** (produce separate files instead of single file; these can then be sent by generic SMTP or through OTRS)    5) **Change CSV dialect** (change delimiter or quoting character, remove header)    6) **Aggregate** (count grouped by a column, sum...)    7) **Merge** (join other file)Python3.7+ required (older releases support 3.6).# Table of contents* [Usage](#usage)  + [Usage 1 – Single query](#usage-1--single-query)  + [Usage 2 – CSV processor program](#usage-2--csv-processor-program)  + [Usage 3 – Web service](#usage-3--web-service)* [Installation and first run](#installation-and-first-run)  + [Prerequisities](#prerequisities)  + [Launch as a package](#launch-as-a-package)  + [OR launch from a directory](#or-launch-from-a-directory)  + [Bash completion](#bash-completion)  + [Customisation](#customisation)* [Computing fields](#computing-fields)  + [Computable fields](#computable-fields)    - [Whois module](#whois-module)  + [Detectable fields](#detectable-fields)  + [Overview of all methods](#overview-of-all-methods)  + [External field how-to](#external-field-how-to)    - [Simple custom method](#simple-custom-method)      * [Launch an external method](#launch-an-external-method)      * [Register an external method](#register-an-external-method)    - [List of results possible](#list-of-results-possible)    - [PickMethod decorator](#pickmethod-decorator)    - [PickInput decorator](#pickinput-decorator)* [Web service](#web-service)* [Sending files](#sending-files)  + [Arbitrary e-mail headers, &quot;From&quot; header, GPG signing](#arbitrary-e-mail-headers-from-header-gpg-signing)  + [Dynamic templates](#dynamic-templates)* [Examples](#examples)  + [URL parsing](#url-parsing)    - [Output formats](#output-formats)    - [Computing TLD from another column](#computing-tld-from-another-column)    - [CSV processing](#csv-processing)    - [File splitting](#file-splitting)    - [CSIRT Usecase](#csirt-usecase)  + [Custom code field](#custom-code-field)  + [Base64 and Regular expressions](#base64-and-regular-expressions)  + [Converting units](#converting-units)  + [Aggregate](#aggregate)  + [Merge](#merge)  + [Sending images to different recipients](#sending-images-to-different-recipients)* [Credits](#credits)## Usage### Usage 1 – Single queryCheck what happens if an IP is provided, it returns table with WHOIS-related information and scraped HTTP content.```bash$ convey 1.1.1.1 # single query inputInput value detected: ip1.1.1.1 ...aufield             value----------------  -----------------prefix            1.1.1.0-1.1.1.255asn               as13335abusemail         abuse@apnic.netcountry           aunetname           apnic-labscsirt-contact     -incident-contact  austatus            200text              DNSThe free app that makes your (much longer text...)```### Usage 2 – CSV processor programParses CSV file.```bash$ convey my-file-with-ips.csv # will trigger file parsingSource file: /tmp/my-file.csvLog lines: 200Sample:...Delimiter character found: ','Quoting character: '&quot;'Header is present: not usedCould you confirm this? [y]/n......```### Usage 3 – Web serviceAgain, let's provide an IP to the [web service](#web-service), it returns JSON with WHOIS-related information and scraped HTTP content.```bash$ convey --server  # start a UWSGI session```Access in the browser: http://localhost:26683/?q=example.com```json{&quot;ip&quot;: &quot;93.184.216.34&quot;, &quot;prefix&quot;: &quot;93.184.216.0-93.184.216.255&quot;, &quot;asn&quot;: &quot;&quot;, &quot;abusemail&quot;: &quot;abuse@verizondigitalmedia.com&quot;, &quot;country&quot;: &quot;unknown&quot;, &quot;netname&quot;: &quot;edgecast-netblk-03&quot;, &quot;csirt-contact&quot;: &quot;-&quot;, &quot;incident-contact&quot;: &quot;unknown&quot;, &quot;status&quot;: 200, &quot;text&quot;: &quot;DNSThe free app that makes your (much longer text...)&quot;}```## Installation and first run### Prerequisites* You'll be asked to install `dialog` library at the first run if not already present in the system.* If something is missing on your system, you may find help yourself with this command:`sudo apt install python3-pip python3-dev python3-tk git xdg-utils dialog whois dnsutils nmap curl build-essential libssl-dev libpcre3 libpcre3-dev &amp;&amp; pip3 install setuptools wheel uwsgi &amp;&amp; pip3 install --upgrade ipython`    * `build-essential` is needed to build `uwsgi` and `envelope`    * `libpcre3 libpcre3-dev` needed to suppress uWSGI warning `!!! no internal routing support, rebuild with pcre support !!!`    * `libssl-dev` needed to be present before building `uwsgi` if you will need to use `--https`### Launch as a package:```bash# (optional) setup virtual environmentpython3 -m venv venv. venv/bin/activate(venv) $ ... # continue below# install from PyPipip3 install convey  # without root use may want to use --user# (optional) alternatively, you may want to install current master from GitHubpip3 install git+https://github.com/CZ-NIC/convey.git# launchconvey [filename or input text] # or try `python3 -m convey` if you're not having `.local/bin` in your executable path```Parameter `[filename or input text]` may be the path of the CSV source file or any text that should be parsed. Note that if the text consist of a single value, program prints out all the computable information and exits; I.E. inputting a base64 string will decode it.### OR launch from a directory```bash# download from GitHubgit clone git@github.com:CZ-NIC/convey.gitcd conveypip3 install -r requirements.txt  --user# launch./convey.py```### Bash completion1. Run: `apt-get install bash-completion jq`2. Copy: [extra/convey-autocompletion.bash](./extra/convey-autocompletion.bash) to `/etc/bash_completion.d/`3. Restart terminal### Customisation* Launch convey with [`--help`](docs/convey-help-cmd-output.md) flag to see [further options](docs/convey-help-cmd-output.md).* A file [`config.ini`](convey/defaults/config.ini) is automatically created in [user config folder](convey/defaults/config.ini). This file may be edited for further customisation. Access it with `convey --config`.&gt; * Convey tries to open the file in the default GUI editor or in the terminal editor if GUI is not an option.&gt; * If `config.ini` is present at working directory, that one is used over the one in the user config folder.&gt; * Configuration is updated automatically on upgrade.## Computing fields### Computable fieldsSome field types are directly computable:* **abusemail** – got abuse e-mail contact from whois* **asn** – got from whois* **base64** – encode/decode* **cc_contact** – e-mail address corresponding with the abusemail, taken from your personal contacts_cc CSV in the format `domain,cc;cc` (mails delimited by a semicolon). Path to this file has to be specified in `config.ini » contacts_cc`.* **country** – country code from whois* **~~csirt_contact~~** – e-mail address corresponding with country code, taken from your personal contacts_abroad CSV in the format `country,abusemail`. Path to this file has to be specified in `config.ini » contacts_abroad`* **external** – you specify method in a custom .py file that receives the field and generates the value for you, see below* **hostname** – domain from url* **incident_contact** – if the IP comes from local country (specified in `config.ini » local_country`) the field gets *abusemail*, otherwise we get *country@@mail* where *mail* is either *abusemail* or abroad country e-mail. When splitting by this field, convey is subsequently able to send the split files to local abuse and foreign csirt contacts.* **ip** – translated from url* **netname** – got from whois* **prefix** – got from whois#### Whois moduleWhen obtaining a WHOIS record* We are internally calling `whois` program, detecting what servers were asked.* Sometimes you encounter a funny formatted *whois* response. We try to mitigate such cases and **re-ask another registry** in well known cases.* Since IP addresses in the same prefix share the same information we cache it to gain **maximal speed** while reducing *whois* queries.* Sometimes you encounter an IP that gives no information but asserts its prefix includes a large portion of the address space. All IP addresses in that portion ends labeled as unknowns. At the end of the processing you are **asked to redo unknowns** one by one to complete missing information, flushing misleading superset from the cache.* You may easily hit **LACNIC query rate** quota. In that case, we re-queue such lines to be queried after the quota is over if possible. At the end of the processing, you will get asked whether you wish to carefully and slowly reprocess the lines awaiting the quota lift.### Detectable fieldsSome of the field types are possible to be auto-detected:* **ip** – standard IPv4 / IPv6 addresses* **cidr** – CIDR notation, ex: 127.0.0.1/32* **port_ip** – IPv4 in the form 1.2.3.4.port* **any_ip** – IPv4 garbled in the form `any text 1.2.3.4 any text`* **hostname** – or FQDN; 2nd or 3rd domain name* **url** – URL starting with http/https* **asn** – AS Number* **base64** – text encoded with base64* **wrong_url** – URL that has been deactivated by replacing certain chars, ex: &quot;hxxp://example[.]com&quot;### Overview of all methodsCurrent field computing capacity can be get from `--show-uml` flag. Generate yours by ex: `convey --show-uml | dot -Tsvg -o /tmp/convey-methods.svg`* Dashed node: field type is auto-detectable* Dashed edge: field types are identical* Edge label: generating options asked at runtime* Rectangle: field category border![Methods overview](./docs/convey-methods.svg?sanitize=True)### External field how-to#### Simple custom methodIf you wish to compute an **external** field, prepare a file whose contents can be as simple as this:```python3def any_method(value):    # do something    return &quot;modified :)&quot;```##### Launch an external method* When CSV processing, hit *'Add column'* and choose *'new external... from a method in your. py file'** Or in the terminal append `--field external` to your `convey` command. A dialog for a path of the Python file and desired method will appear.```bash$ convey [string_or_filepath] --field external```* You may as well directly specify the path and the callable. Since the `--field` has following syntax:&gt; *FIELD[[CUSTOM]],[COLUMN],[SOURCE_TYPE],[CUSTOM],[CUSTOM]*You may omit both *COLUMN* and *SOURCE_TYPE* writing it this way:&gt; *FIELD,~~COLUMN,SOURCE_TYPE~~,CUSTOM,CUSTOM*&gt; external,/tmp/myfile.py,any_method```bash$ convey [string_or_filepath] --field external,/tmp/myfile.py,any_methodInput value seems to be plaintext.field     value--------  -----------------------external  modified :)```##### Register an external method* You may as well hard code custom fields in the [`config.ini`](convey/config.ini.default) by providing paths to the entry point Python files delimited by a comma: `external_fields = /tmp/myfile.py, /tmp/anotherfile.py`. All the public methods in the defined files will become custom fields!```editorconfig[EXTERNAL]external_fields = /tmp/myfile.py```* If this is not needed, you may register one by one by adding new items to the `EXTERNAL` section. Delimit the method name by a colon.```editorconfig[EXTERNAL]any_method = /tmp/myfile.py:any_method```#### List of results possibleIf you need a single call to generate multiple rows, return list, the row accepting a list will be duplicated.```python3def any_method(value):    # do something    return [&quot;foo&quot;, &quot;bar&quot;]```When convey receives multiple lists, it generates a row for each combination. Ex: If a method returns 2 items and another 3 items, you will receive 6 similar rows.#### PickMethod decoratorShould there be multiple ways of using your generator, place them as methods of a class decorated with `PickMethod` and let the user decide at the runtime. `PickMethod` has optional `default:str` parameter that specifies the default method.```python3from convey import PickMethod@PickMethod(&quot;all&quot;)class any_method(PickMethod):    def all(x):        ''' All of them.  '''        return x    def filtered(cls, x):        ''' Filter some of them '''        if x in country_code_set:            return x``````bash$ convey file.csv --field any_method  # user will be asked whether to use `all` or `filtered`$ convey file.csv --field any_method[filtered]  # `filtered` sub-method will be used$ convey file.csv --field any_method --yes  # the default `all` sub-method will be used```#### PickInput decoratorIf you need a direct user entry before each processing, import `PickInput` and make your method accept *two* parameters. The latter will be set by the user and may have a default value.```python3from convey import PickInputimport dateutil@PickInputdef time_format(val, format=&quot;%H:%M&quot;):    ''' This text will be displayed to the user.        If running in headless mode, the default format will be &quot;%H:%M&quot; (hours:minutes).   '''    return dateutil.parser.parse(val).strftime(format)``````bash$ convey file.csv --field time_format  # user will be asked for a format parameter$ convey file.csv --field time_format[%M]  # `format` will have the value `M%`$ convey file.csv --field time_time --yes  # the default `format` `%H:%M` will be used```## Web serviceWhen launched as a web service, several parameters are available:* `q` – search query* `type` – same as `--type` CLI flag* `field` – same as `--field` CLI flag.    * Note that unsafe field types `code` and `external` are disabled in web service by default. You may re-allow them in `webservice_allow_unsafe_fields` config option    * full syntax of CLI flag is supported    &gt; *FIELD[[CUSTOM]],[COLUMN],[SOURCE_TYPE],[CUSTOM],[CUSTOM]*    Ex: `reg_s,l,L` performs regular substitution of *'l'* by *'L'** `clear=web` – clears web scrapping module cacheQuick deployment may be realized by a single command:```bash$ convey --server```* Note that convey must be installed via `pip`* Note that LACNIC may freeze for 300 s, hence the timeout recommendation.* Note that you may find your convey installation path by launching `pip3 show convey`* If you received or [generated](https://uwsgi-docs.readthedocs.io/en/latest/HTTPS.html#https-support-from-1-3) key and certificate, you may turn on HTTPS in `uwsgi.ini` accesible by: `convey --config uwsgi`* Internally, flag `--server` launches `wsgi.py` with a UWSGI session.    ```bash    $ uwsgi --http :26683 --http-timeout 310 --wsgi-file /home/$USER/.local/lib/python3.../site-packages/convey/wsgi.py    ```Access: `curl http://localhost:26683/?q=example.com````json{&quot;ip&quot;: &quot;93.184.216.34&quot;, &quot;prefix&quot;: &quot;93.184.216.0-93.184.216.255&quot;, &quot;asn&quot;: &quot;&quot;, &quot;abusemail&quot;: &quot;abuse@verizondigitalmedia.com&quot;, &quot;country&quot;: &quot;unknown&quot;, &quot;netname&quot;: &quot;edgecast-netblk-03&quot;, &quot;csirt-contact&quot;: &quot;-&quot;, &quot;incident-contact&quot;: &quot;unknown&quot;, &quot;status&quot;: 200, &quot;text&quot;: &quot;DNSThe free app that makes your (much longer text...)&quot;}```Access: `curl http://localhost:26683/?q=example.com&amp;field=ip````json{&quot;ip&quot;: &quot;93.184.216.34&quot;}```Access: `curl http://localhost:26683?q=hello&amp;type=country&amp;field=reg_s,l,L````json{&quot;reg_s&quot;: &quot;heLLo&quot;}```## Sending filesWhen you split the CSV file into chunks by an e-mail, generated files may be sent to these addresses. Look at the example of an unlocked &quot;send&quot; menu below. You see the list of the recipients, followed by a conditional list of recipients that have been already sent to. Next, an exact e-mail message is printed out, including headers.In the menu, you may either: * **Send** the e-mails * **Limit** the messages that are being send at once; if you are not 100 % sure you want to send the the whole message bucket at once. * **Edit** the template. The message file will open either in the default GUI or terminal editor. The first line of the template should be `Subject: ...`, followed by a free line. Note that you may include any e-mail headers, such as `Reply-To: ...`, `Cc: ...`, etc. The e-mail will reflect all of them. You may write the message either in plain text or in the HTML. * **Choose** which recipients in a checkbox list will receive the message. * **Test** sending a message to your own address. You'll be prompted which of the messages should be delivered to you. The e-mail contents possibly modified by a dynamic template is shown just before sending. * **Print all e-mails** to a file to have the more granulated control over what is going to be sent. * **Toggle file attaching** on and off. A portion of the source file related to this e-mail address might be attached. There are use cases when you do not want the files to be sent with as the body text suits fine. * **Toggle paths from the path column attaching** on and off. Files mentioned in a path column and related to this e-amil address might be attached.```bash  *** E-mail template ***Recipient list (1/3): alice@example.comAlready sent (2/3): bob@example.com, cilia@example.comAttachment: split CSV file attachedContent-Type: text/plain; charset=&quot;utf-8&quot;Content-Transfer-Encoding: 7bitMIME-Version: 1.0Subject: My subjectFrom: me@example.comDate: Fri, 17 Jan 2020 01:36:28 +0100Hello,this is my testing message.Keen regards**************************************************1) Send all e-mails via localhost (1) ←←←←←l) Limit sending amount to...e) Edit template...r) Choose recipients...t) Send test e-mail...p) Print e-mails to a file...a) Attach files (toggle): Truei) Attach paths from path column (toggle): Falsex) Go back...?```### Arbitrary e-mail headers, &quot;From&quot; header, GPG signingIn the template, you may specify any e-mail header, such as `Reply-To`, `Cc` or `From`. If `From` is not found, we take `SMTP/email_from_name` config value. If `gnupg` home is found on the default user path, we check if there is a secret key matching the `From` header and if found, e-mail will be GPG-signed. If it is going to be signed, you would see something like `Content-Type: multipart/signed; protocol=&quot;application/pgp-signature&quot;;` header in the e-mail template preview.### Dynamic templatesMessage is processed with [Jinja2](https://jinja.palletsprojects.com/en/2.10.x/) templating system by default.Few instruments are included to treat the attachment contents:* **attachment()** – Prints the attachment contents and prevent it to be attached.    ```jinja2    You will find our findings below.    {{ attachment() }}    ```* **row()** – Generate attachment contents fields row by row. Header skipped.* **amount(count=2)** – Check if the attachment has at least `count` number of lines. Header is not counted. Useful when deciding whether the are single row in the result or multiple.* **joined(column: int, delimiter=&quot;, &quot;)** – Return a column joined by delimiter* **first_row** – Access first line fields    Example:    ```jinja2    {% if amount() %}        Here is the complete list of the elements.        {{ joined(1,&quot;\n&quot;) }}    {% else %}        Here is the element you had problems with: {{ first_row[1] }}    {% endif %}    ```## ExamplesIn the examples, we will use these parameters to add a field and to shorten the result.```bash# -f, --field adding field syntax: FIELD[[CUSTOM]],[COLUMN],[SOURCE_TYPE],[CUSTOM],[CUSTOM]# -H, --headless: just quietly print out single value, no dialog```### URL parsing#### Output formatsPut any IP or URL as the argument.```bash$ convey example.comInput value detected: hostnameWhois 93.184.216.34... abuse@verizondigitalmedia.comScrapping http://example.com...field             value----------------  ------------------------------------------------------------------------------cidr              93.184.216.0/24ip                93.184.216.34tld               comurl               http://example.comabusemail         abuse@verizondigitalmedia.comcsirt_contact     -incident_contact  abuse@verizondigitalmedia.comnetname           edgecast-netblk-03prefix            93.184.216.0-93.184.216.255a                 93.184.216.34aaaa              2606:2800:220:1:248:1893:25c8:1946mx                0 .ns                ['a.iana-servers.net.', 'b.iana-servers.net.']spf               v=spf1 -allhttp_status       200text              Example Domain                  This domain is for use in illustrative examples in documents. You may use this                   domain in literature without prior coordination or asking for permission.                  More informatio                  n...```Should you need just the country the domain/IP is hosted in, use `--field, -f` argument```bash$ convey wikipedia.com -f countryInput value detected: hostnameWhois 208.80.154.232... usfield    value-------  -------country  us```Use `--headless, -H` or `--quiet, -q` flag to shorten the output (and cut down all dialogues).```bash$ convey wikipedia.com -f country -Hus```Flag `--json` modifies the output.```bash$ convey wikipedia.com -f country -H --json{&quot;country&quot;: &quot;us&quot;}```#### Computing TLD from another columnTo compute a TLD from the abusemail that is being used for the IP domain is hosted in, add a field `abusemail` and then another field `tld`. Specifically say that the latter should source from the second column (which is `abusemail`) – either type '2' or 'abusemail'.```bash$ convey example.com -f abusemail -f tld,2$ convey example.com -f abusemail -f tld,abusemailInput value detected: hostnameWhois 93.184.216.34... abuse@verizondigitalmedia.comfield      value---------  -----------------------------abusemail  abuse@verizondigitalmedia.comtld        com```To prevent `abusemail` from being output, use `--field-excluded, -fe` instead of `--field, -f`:```bash$ convey example.com -fe abusemail -f tld,2 -HInput value detected: hostnameWhois 93.184.216.34... abuse@verizondigitalmedia.comfield    value-------  -------tld      com```We did not say earlier, user is asked each time whether they wish to get any `tld`, `gTLD` (ex: *com*) or `ccTLD` (ex: *cz*). You may specify it from CLI by one of those equivalent commands.```bash$ convey test.csv --fresh --field tld[gTLD]$ convey test.csv --fresh --field tld,,,gTLD# flag --yes or --headless will choose the default option which is *all*$ convey test.csv --fresh --field tld --yes```#### CSV processingShould you have a list of the object that you want to enrich of a CIDR they are hosted at, load the file `test.csv` they are located in.```csv# file text.csvdomain listwikipedia.comexample.com```And see the menu just by adding `--field cidr` argument.```bash$ convey test.csv -f cidrSource file: /tmp/ram/test.csvIdentified columns:Log lines: 3Sample:domain listwikipedia.comexample.comDelimiter character found: ','Quoting character: '&quot;'Header is present: yesCould you confirm this? [y]/n: (HIT ENTER)Source file: /tmp/ram/test.csv, delimiter: ',', quoting: '&quot;', header: usedIdentified columns: domain list (hostname)Computed columns: cidr (from domain list)Log lines: 3Sample:domain listwikipedia.comexample.comWhois 208.80.154.232... usWhois 93.184.216.34... abuse@verizondigitalmedia.comPreview:domain list      cidr from:   (hostname)    domain list---------------  ---------------wikipedia.com    208.80.152.0/22example.com      93.184.216.0/24Main menu - how the file should be processed?1) Pick or delete columns2) Add a column3) Filter4) Split by a column5) Change CSV dialect6) Aggregate7) Mergep) process ←←←←←~) send (split first)~) show all details (process first)r) redo...c) config...x) exit?```#### File splittingWe will create an ASN field and split the file.csv by this field, without adding it into the output.```csv# file.csvwikipedia.com,443,2016-02-09T01:12:26-05:00,16019,USseznam.cz,25,2016-02-27T22:20:21-05:00,16019,CZgoogle.com,25,2016-02-28T02:27:21-05:00,16019,US``````bash$ convey file.csv --field-excluded asn --split asn(...)** Processing completed: 3 result files in /tmp/ram/file.csv_convey1573236314(...)``````csv# file as14907wikipedia.com,443,2016-02-09T01:12:26-05:00,16019,US``````csv# file as43037seznam.cz,25,2016-02-27T22:20:21-05:00,16019,CZ``````csv# file as15169google.com,25,2016-02-28T02:27:21-05:00,16019,US```#### CSIRT UsecaseA CSIRT may use the tool to automate incident handling tasks. The input is any CSV we receive from partners; there is at least one column with IP addresses or URLs. We fetch whois information and produce a set of CSV grouped by country AND/OR abusemail related to IPs. These CSVs are then sent by through OTRS from within the tool.A most of the work is done by this command.```bashconvey --field-excluded incident_contact,source_ip --split incident_contact --yes [FILENAME]```### Custom code fieldAdding a column from custom Python code:```bash$ convey example.com -f code,&quot;x=x[1:5]&quot;xamp```### Base64 and Regular expressionsCode there and back:```bash$ convey hello -f base64  -H  # --headless conversion to base64aGVsbG8=$ convey aGVsbG8= -H  # automatically identifies input as base64 and produces plaintexthello```Use a `reg` column for regular expressions.```bash# start adding a new reg column wizzard that will take decoded &quot;hello&quot; as input$ convey aGVsbG8= -f reg$ convey aGVsbG8= -f reg_s,&quot;ll&quot;,&quot;LL&quot; -H   # substitute 'll' with 'LL'heLLo```Specify source```bash# start adding a new reg column wizzard that will take plaintext &quot;aGVsbG8=&quot; as input$ convey aGVsbG8= -f reg,plaintext# specifying plaintext as a source type will prevent implicit convertion from base64$ convey aGVsbG8= -f reg_s,plaintext,&quot;[A-Z]&quot;,&quot;!&quot; -H  # substitute uppercase letters with '!'a!!sb!8=```### Converting unitsWe are connected to the [pint](https://pint.readthedocs.io/en/0.9/) unit converter!```bash$ convey &quot;3 kg&quot;Input value detected: unitfield      value---------  --------------------------------------------------------------------------------------------plaintext  ['1.806642538265029e+27 atomic_mass_unit', '105.82188584874123 ounce', '96.45223970588393 ap           othecary_ounce', '0.0703602964419822 bag', '0.05905239165666364 long_hunderweight', '0.06613           867865546327 US_hundredweight', '0.002952619582833182 UK_ton', '0.002952619582833182 long_to           n', '1929.0447941176785 pennyweight', '46297.07505882429 grain', '1.7935913792661326e+27 pro           ton_mass', '771.6179176470714 apothecary_dram', '3000.0 gram', ...]$ convey &quot;3 kg&quot; -f unit # launches wizzard that let's you decide what unit to convert to$ convey &quot;3 kg&quot; -f unit[g] -H3000.0 gram$ convey &quot;kg&quot; -f unit --csv-processing --headlesskg|6.022141794216764e+26 atomic_mass_unitkg|0.001 metric_tonkg|0.0009842065276110606 UK_tonkg|771.6179176470714 scruplekg|257.2059725490238 apothecary_dramkg|1000.0 gram# You may try to specify the units with no space and quotation.# In the following example, convey expand all time-units it is able to compute# – time units will be printed out and each is base64 encoded.$ convey 3hoursInput value detected: timestamp, unitfield                value-------------------  ------------------------------------------------------------------(...)base64               ['MC4wMDQxMDY4NjM4OTc0NTAwNzcgbW9udGg=', 'MTA4MDAuMCBzZWNvbmQ=', 'MC4wMTc4NTcxNDI4NTcxNDI4NSB3ZWVr']plaintext            ['0.004106863897450077 month', '10800.0 second', '0.01785714285714285 week', (...)]time                 03:00:00(...)# What if$ convey 3hours -f urlencodeInput value detected: timestamp, unitInput unit_expand variable unit: *you type here sec or seconds to see the wizzard*Preview| original   | result         ||------------|----------------|| 3hours     | 10800.0 second |field      value---------  ----------------urlencode  10800.0%20second# What if we wanted to urlencode text &quot;3hours&quot; without converting it to unit first?# Just specify the SOURCE_TYPE to be plaintext:$ convey &quot;3hours&quot; -f urlencode,plaintextInput value detected: timestamp, unitfield      value---------  -------urlencode  3hours```### Country namesWhen specifying country code, you get country name.```bash$ convey --type country scSeychelles```Lots of countries can be recognized.```bash$ convey --type country_name Futunawf```You may get the country code from various telephone number formats.```bash$ convey +2481234567Seychelles$ convey &quot;1-541-754-3010&quot;['ca', 'us']$ convey```### AggregateSyntax is `[COLUMN, FUNCTION], ..., [group-by-COLUMN]`.Possible functions are:* avg* sum* count* min* max* list* setLet's have a file.```csv# file.csvcategory,price,consumptionbulb,100,30bulb,150,10kettle,250,70kettle,352,80bulb,120,15```Sum the `price` column.```bash$ convey file.csv --aggregate price,sum  sum(price)------------         972```Group the `price` sum by `category`.```bash$ convey file.csv --aggregate price,sum,categorycategory     sum(price)---------  ------------total               972bulb                370kettle              602```Group the `price` sum and the `consumption` average value by `category`.```bash$ convey file.csv --aggregate price,sum,consumption,avg,categorycategory      sum(price)    avg(consumption)----------  ------------  ------------------total                972               41bulb                 370               18.33kettle               602               75```Group the `price` sum by `category` and list its values.```bash$ convey file.csv --aggregate price,sum,price,list,categorycategory      sum(price)  list(price)----------  ------------  ---------------------total                972  (all)bulb                 370  ['100', '150', '120']kettle               602  ['250', '352']```You can even split while aggregating. Each file will count its own results.```bash$ convey file.csv --agg price,sum --split categorySplit location: bulb  sum(price)------------         370Split location: kettle  sum(price)------------         602```### MergeYou can merge two file based on a common column.Imagine a XLS file `person.xls`, containing following rows:```john@example.com,foo,malemary@example.com,foo,femalehyacint@example.com,bar,male```And a file `sheet.csv````foo,red,second.example.comfoo,green,first.example.combar,blue,wikipedia.orgbar,yellow,example.comfoo,orange,wikipedia.com```Get them merged with a single command. We specify the merged file will be `person.xls`, while the common column (`foo/bar`) is the second in the remote and the first in the local `sheet.csv` file.```bash$ convey --output --headless --file sheet.csv --merge person.xls,2,1foo,red,second.example.com,mary@example.com,femalefoo,red,second.example.com,john@example.com,malefoo,green,first.example.com,mary@example.com,femalefoo,green,first.example.com,john@example.com,malebar,blue,wikipedia.org,hyacint@example.com,malebar,yellow,example.com,hyacint@example.com,malefoo,orange,wikipedia.com,mary@example.com,femalefoo,orange,wikipedia.com,john@example.com,male```* When a pivot key (local column value)  * is missing from the remote file, the fields on the line stays blank.  * is found twice, the row gets duplicated.* Performance note: Working with really huge files? Whereas the local file that you merge to can be of an arbitrary size, the remote file being merged should not be excessively big, it should fit to the RAM.### Sending images to different recipientsImagine you have a directory full of PNG files, containg info for respective domain administrators.```example.com.pngexample.com-2.pngwikipedia.org.pngcsirt.cz.png```We want to send two images to the admin of `example.com` and single one for `wikipedia.org` and `csirt.cz`. First, create a CSV having first column the domain name and second the respective image. To do so, we use the [pz](https://github.com/CZ-NIC/pz) library.```pip3 install pz  # install `pz` if neededls *.png | pz 're.sub(&quot;-\d+$&quot;, &quot;&quot;, Path(s).stem),s' &gt; domains_images.csv```CSV domains_images.csv now looks like this:```example.comexample.com-2.pngexample.comexample.com.pngwikipedia.comwikipedia.com.pngcsirt.czcsirt.cz.png```The following command will tell `convey` to add an e-mail column derived from the hostname and when sending files, attach all our images from the path column.```convey domains_images.csv  -t hostname,path -f abusemail --split abusemail --attach-files False  --attach-paths-from-path-column True```Wizzard will lead you to sending the test mail to you own address. This is the sending a testing e-mail dialog for the `wikipedia.org` domain.```Attachment wikipedia.com.png (image/png): PNG...MIME-Version: 1.0Subject: PNG that might interest youTo: abuse@wikimedia.orgDate: Fri, 06 Jan 2023 20:04:31 +0100Body text messageTesting e-mail address to be sent to – type in or hit Enter to use your-testing-mail@example.com (Ctrl+C to go back):```## CreditsBrought by [CSIRT.cz](https://csirt.cz).</longdescription>
</pkgmetadata>