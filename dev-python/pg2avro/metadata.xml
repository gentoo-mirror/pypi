<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># pg2avroPostgres to Avro generator.## Features- Generate Avro schema from column definition.- Generate  data format consumable for Avro serialization.# Usage## Generating schemaMethod: `pg2avro.get_avro_schema````get_avro_schema(    &quot;mytable&quot;,     &quot;public&quot;,     [        # Dictionary mode        {            &quot;name&quot;: &quot;column_name_1&quot;,            &quot;type&quot;: &quot;int2&quot;,            &quot;nullable&quot;: False,        },        # SqlAlchemy mode        SqlAlchemyColumn(ARRAY(TEXT), name=&quot;column_name_2&quot;),        ...    ])```Schema generator needs the following information:- table name- namespace (`schema` in SQL, `dataset` in Big Query etc.)- columns - iterable of columns, each element with:    - name    - type - `_` prefix is used to indicate array types    - nullable (optional, `True` assumed if not provided)- column mapping - optional `ColumnMapping` object with column mappings (see below for more info).Column data can be passed in multiple formats.### Supported column formats- Dictionary with required keys and data- SqlAlchemy Column object- Any object with compatible attributes and required data- Dictionary or object with required data, but without compatible attributes/keys, supplied with ColumnMapping.Note: this mode supports **generating schema from raw postgres data** - `udt_name` can be used to generate the schema.```columns = [    CustomColumn(name=&quot;column_name&quot;, udt_name=&quot;int2&quot;, is_nullable=False),]get_avro_schema(    table_name,    namespace,    columns,    ColumnMapping(name=&quot;name&quot;, type=&quot;udt_name&quot;, nullable=&quot;is_nullable&quot;),)```## Generating rows dataMethod: `pg2avro.get_avro_row_dict`This method requires rows data and schema to generate the rows with.### Supported row formats- Dictionary with keys corresponding to schema field names- Object with keys corresponding to schema field names (works the same as dictionary with corresponding fields)- Tuple with data in the same order as fields specified in schema```columns = [    {&quot;name&quot;: &quot;name&quot;, &quot;type&quot;: &quot;varchar&quot;, &quot;nullable&quot;: False},    {&quot;name&quot;: &quot;number&quot;, &quot;type&quot;: &quot;float4&quot;, &quot;float4&quot;, &quot;nullable&quot;: False},]schema = get_avro_schema(table_name, namespace, columns)rows = [    {&quot;name&quot;: &quot;John&quot;, &quot;number&quot;: 1.0},    RowObject(name=&quot;Jack&quot;, number=2.0),    (&quot;Jim&quot;, 3.0),]data = [get_avro_row_dict(row, schema) for row in rows]```### Overriding mappingsSome cases might require overriding standard mapping. An example of such scenario is moving pg data into google bigquerywhere numeric types are handled differently and cannot accept arbitrary scale, so we may want to override that into float. To do so, simply pass your mapping overrides as a column name keyed dict to the `get_avro_schema` function like so:```columns = [    {&quot;name&quot;: &quot;some_special_field&quot;, &quot;type&quot;: &quot;int&quot;},    {&quot;name&quot;: &quot;numeric_with_high_scale&quot;, &quot;type&quot;: &quot;numeric(20, 15)&quot;},]overrides = {    &quot;some_special_field&quot;: {&quot;pg_type&quot;: &quot;string&quot;, &quot;python_type&quot;: str},    &quot;numeric_with_high_scale&quot;: {&quot;pg_type&quot;: &quot;float8&quot;, &quot;python_type&quot;: float},}schema = get_avro_schema(table_name, namespace, columns, mapping_overrides=overrides)```- `pg_type` - the type you want the column to look like for pg2avro instead of what was retrieved from pg/sqlalchemy etc.- `python_type` - built in python type to use for typecasting. Use `str`, `float`, `int`, `tuple`, `list`, `set` and `dict` here.And your `some_special_field` will be mapped into a string instead of int accordingly.</longdescription>
</pkgmetadata>