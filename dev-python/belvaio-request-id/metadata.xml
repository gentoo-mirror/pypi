<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># Belvaio Request Id[![Package version](https://img.shields.io/pypi/v/belvaio-request-id)](https://pypi.org/project/belvaio-request-id/)[![PyPI - Downloads](https://img.shields.io/pypi/dm/belvaio-request-id)](https://pypistats.org/packages/belvaio-request-id)[![Build Status](https://travis-ci.com/belvo-finance/belvaio-request-id.svg?branch=master)](https://travis-ci.com/belvo-finance/belvaio-request-id)[![codecov](https://codecov.io/gh/belvo-finance/belvaio-request-id/branch/master/graph/badge.svg)](https://codecov.io/gh/belvo-finance/belvaio-request-id)Belvaio Request Id is an [aiohttp][aiohttp] set of utils that help us to track request journey between services.1. **`request_id_middleware`**: aiohttp middleware that generate random `request_id` or read it from `X-Request-Id` header for each http request.2. **`RequestIdFilter`**: logging filter that allow attach `request_id` to every logging record.3. **`RequestIdAccessLogger`**: add `request_id` to aiohttp access log. This log message is logged outside the scope where we set the context var that store the `request_id`, so we need to define our own [AccessLogger][access-logs] that fixes this.4. If [Sentry][sentry-aiohttp] is used  a `request_id` tag is added when the http request is processed.Motivation: [Skyscanner / aiotask-context][motivation]## Requirements- Python 3.7+- [`aiohttp`][aiohttp] &gt;= 3.5## Installation```shellpip install belvaio-request-id```## Example```python&quot;&quot;&quot;POC to demonstrate the usage of the belvaio-request-id package for writing the request_id from aiohttp into every log call. If you run this script, you can try to query with curl or the browser:    $ curl http://127.0.0.1:8080/Mateu    Hello, Mateu. Your request id is 93234aa6d4524f4bb76622e5d0c85589.    $ curl -H &quot;X-Request-ID: e72ec21b412845cf86a8aee50331cc4f&quot; http://127.0.0.1:8080/Mateu    Hello, Mateu. Your request id is e72ec21b412845cf86a8aee50331cc4f.In the terminal you should see something similar to:    ======== Running on http://0.0.0.0:8080 ========    (Press CTRL+C to quit)    2020-03-20 11:43:20,248 INFO __main__ 93234aa6d4524f4bb76622e5d0c85589 | Received new GET /Mateu call    2020-03-20 11:43:20,249 INFO aiohttp.access 93234aa6d4524f4bb76622e5d0c85589 | 127.0.0.1 &quot;GET /Mateu HTTP/1.1&quot; 200 266 &quot;curl/7.64.1&quot;&quot;&quot;&quot;import logging.configfrom aiohttp import webfrom belvaio_request_id.logger import RequestIdAccessLoggerfrom belvaio_request_id.middleware import request_id_middlewarefrom belvaio_request_id.utils import get_request_idLOG_SETTINGS = {    &quot;version&quot;: 1,    &quot;disable_existing_loggers&quot;: False,    &quot;handlers&quot;: {        &quot;console&quot;: {            &quot;class&quot;: &quot;logging.StreamHandler&quot;,            &quot;level&quot;: &quot;INFO&quot;,            &quot;formatter&quot;: &quot;default&quot;,            &quot;filters&quot;: [&quot;requestid&quot;],        },    },    &quot;filters&quot;: {&quot;requestid&quot;: {&quot;()&quot;: &quot;belvaio_request_id.logger.RequestIdFilter&quot;,},},    &quot;formatters&quot;: {        &quot;default&quot;: {            &quot;format&quot;: &quot;%(asctime)s %(levelname)s %(name)s %(request_id)s | %(message)s&quot;,        },    },    &quot;loggers&quot;: {&quot;&quot;: {&quot;level&quot;: &quot;DEBUG&quot;, &quot;handlers&quot;: [&quot;console&quot;], &quot;propagate&quot;: True},},}logging.config.dictConfig(LOG_SETTINGS)logger = logging.getLogger(__name__)async def handle(request):    name = request.match_info.get(&quot;name&quot;)    logger.info(&quot;Received new GET /%s call&quot;, name)    text = f&quot;Hello, {name}. Your request id is {get_request_id()}.\n&quot;    return web.Response(text=text)if __name__ == &quot;__main__&quot;:    app = web.Application(middlewares=[request_id_middleware])    app.router.add_route(&quot;GET&quot;, &quot;/{name}&quot;, handle)    web.run_app(        app,        access_log_format='%a &quot;%r&quot; %s %b &quot;%{User-Agent}i&quot;',        access_log_class=RequestIdAccessLogger,    )```## ContributingThe Belvo team happily welcomes contributions.If you wish to submit a pull request, please be sure check the items on this list:- [ ] Tests related to the changed code were executed- [ ] The source code has been coded following the OWASP security best practices (https://owasp.org/www-pdf-archive/OWASP_SCP_Quick_Reference_Guide_v2.pdf).- [ ] Commit message properly labeled- [ ] There is a ticket associated to each PR.[Guidelines][guidelines] will help you get ready to contribute to this project![aiohttp]: https://docs.aiohttp.org/en/stable/index.html[guidelines]: https://github.com/belvo-finance/belvaio-request-id/blob/master/CONTRIBUTING.md[access-logs]: https://docs.aiohttp.org/en/stable/logging.html#access-logs[sentry-aiohttp]: https://docs.sentry.io/platforms/python/aiohttp/[motivation]: https://github.com/Skyscanner/aiotask-context </longdescription>
</pkgmetadata>