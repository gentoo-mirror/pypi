<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># coverage-conditional-plugin[![wemake.services](https://img.shields.io/badge/%20-wemake.services-green.svg?label=%20&amp;logo=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC%2FxhBQAAAAFzUkdCAK7OHOkAAAAbUExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP%2F%2F%2F5TvxDIAAAAIdFJOUwAjRA8xXANAL%2Bv0SAAAADNJREFUGNNjYCAIOJjRBdBFWMkVQeGzcHAwksJnAPPZGOGAASzPzAEHEGVsLExQwE7YswCb7AFZSF3bbAAAAABJRU5ErkJggg%3D%3D)](https://wemake.services)[![Build Status](https://github.com/wemake-services/coverage-conditional-plugin/workflows/test/badge.svg?branch=master&amp;event=push)](https://github.com/wemake-services/coverage-conditional-plugin/actions?query=workflow%3Atest)[![codecov](https://codecov.io/gh/wemake-services/coverage-conditional-plugin/branch/master/graph/badge.svg)](https://codecov.io/gh/wemake-services/coverage-conditional-plugin)[![Python Version](https://img.shields.io/pypi/pyversions/coverage-conditional-plugin.svg)](https://pypi.org/project/coverage-conditional-plugin/)[![wemake-python-styleguide](https://img.shields.io/badge/style-wemake-000000.svg)](https://github.com/wemake-services/wemake-python-styleguide)Conditional coverage based on any rules you define!Some projects have different parts that relies on different environments:- Python version, some code is only executed on specific versions and ignored on others- OS version, some code might be Windows, Mac, or Linux only- External packages, some code is only executed when some 3rd party package is installedCurrent best practice is to use `# pragma: no cover` for this places in our project.This project allows to use configurable pragmasthat include code to the coverage if some condition evaluates to true,and fallback to ignoring this code when condition is false.Read [the announcing post](https://sobolevn.me/2020/02/conditional-coverage).## Installation```bashpip install coverage-conditional-plugin```Then you will need to add to your `setup.cfg` or `.coveragerc` filesome extra configuration:```ini[coverage:run]# Here we specify plugins for coverage to be used:plugins =  coverage_conditional_plugin[coverage:coverage_conditional_plugin]# Here we specify files to conditionally omit:omit =  &quot;sys_platform == 'win32'&quot;:      &quot;my_project/omit*.py&quot;      &quot;my_project/win.py&quot;# Here we specify our pragma rules:rules =  &quot;sys_version_info &gt;= (3, 8)&quot;: py-gte-38  &quot;is_installed('mypy')&quot;: has-mypy```Or to your `pyproject.toml`:```toml[tool.coverage.run]# Here we specify plugins for coverage to be used:plugins = [&quot;coverage_conditional_plugin&quot;][tool.coverage.coverage_conditional_plugin.omit]# Here we specify files to conditionally omit:&quot;my_project/omit*.py&quot; = &quot;sys_platform == 'win32'&quot;[tool.coverage.coverage_conditional_plugin.rules]# Here we specify our pragma rules:py-gte-38 = &quot;sys_version_info &gt;= (3, 8)&quot;has-mypy = &quot;is_installed('mypy')&quot;```Adapt rules to suit your needs!## ExampleImagine that we have this code:```pythontry:  # pragma: has-django    import djangoexcept ImportError:  # pragma: has-no-django    django = Nonedef run_if_django_is_installed():    if django is not None:  # pragma: has-django        ...```And here's the configuration you might use:```ini[coverage:coverage_conditional_plugin]rules =  &quot;is_installed('django')&quot;: has-django  &quot;not is_installed('django')&quot;: has-no-django```When running tests with and without `django` installedyou will have `100%` coverage in both cases.But, different lines will be included.With `django` installed it will includeboth `try:` and `if django is not None:` conditions.When running without `django` installed,it will include `except ImportError:` line.## Writing pragma rulesFormat for pragma rules is:```&quot;pragma-condition&quot;: pragma-name```Code inside `&quot;pragma-condition&quot;` is evaluted with `eval`.Make sure that the input you pass there is trusted!`&quot;pragma-condition&quot;` must return `bool` value after evaluation.We support all environment markers specified in [PEP-496](https://www.python.org/dev/peps/pep-0496/).See [Strings](https://www.python.org/dev/peps/pep-0496/#strings)and [Version Numbers](https://www.python.org/dev/peps/pep-0496/#version-numbers)sections for available values. Also, we provide a bunch of additional markers:- `sys_version_info` is the same as [`sys.version_info`](https://docs.python.org/3/library/sys.html#sys.version_info)- `os_environ` is the same as [`os.environ`](https://docs.python.org/3/library/os.html#os.environ)- `is_installed` is our custom function that tries to import the passed string, returns `bool` value- `package_version` is our custom function that tries to get package version from `pkg_resources` and returns its [parsed version](https://packaging.pypa.io/en/latest/version/#packaging.version.parse)Use `get_env_info` to get values for the current environment:```pythonfrom coverage_conditional_plugin import get_env_infoget_env_info()```## Writing omitsOmits allow entire files to be conditionally omitted from coverage measurement.The TOML format for omits is:```toml[tool.coverage.coverage_conditional_plugin.omit]&quot;pragma-condition&quot; = [&quot;project/prefix*.py&quot;, &quot;project/filename.py&quot;]# or&quot;pragma-condition&quot; = &quot;project/filename.py&quot;```**Note**: `ini` format is not supported for `omit` configuration option,because there's no easy way to parse `ini` complex configuration. PRs with the fix are welcome!File name patterns should follow coverage.py's `[run] omit` syntax.See [coverage.py](https://coverage.readthedocs.io/en/stable/source.html).## License[MIT](https://github.com/wemake.services/coverage-conditional-plugin/blob/master/LICENSE)</longdescription>
</pkgmetadata>