<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># pg-replica-auditorA tool to compare a PostgreSQL logical replica to its primary. It can help detect data inconsistencies.## Features### AssumptionsThese tests assume that `id` and `updated_at` (or column specified in `--lag-column`) columns exist and have indexes for efficient querying and that the table exists on both databases.#### Row comparisonRuns row comparisons between primary and replica using two methods:1. select 8128 rows (or number of rows given to `--rows`) at random between `MIN(id)` and `MAX(id)`2. select the last 1000 rows.#### Replica lagChecks for &quot;replica lag&quot; by comparing `MAX(updated_at)` on the given table on both databases.#### MinMaxChecks that the minimum `id` and the maximum `id` match on both replica and primary. These can drift _a little_ because of replica lag.#### Bulk 1000 SumTake the sum of the `id` column in chunks of 1000 and compare it between databases. This assumes that retrieving rows in bulk is easier than at random and runs faster than the row comparison and can scan more rows.#### Count all rowsCounts all the rows using `COUNT(lag_column)` to make sure row counts match on both replica and primary. Very slow, since it has to do a full scan (index or table). Adjust `--count-before` to count all columns before a timestamp on `--lag-column`, or `updated_at` by default.#### Missing Sequential RecordsGo throught the table with a step size of `MAX(id)` * `--step-size=0.01`. The assumption is that if records will be missing, they will be missing in bulk, grouped together.## Requirements1. Python 32. Postgres development files (required by psycopg2). On Mac OS, use `brew install postgresql`. On Ubuntu, install `libpq-dev`.## Installation### DevelopmentUsing virtualenv, `pip install -r requirements.txt`### ProductionUsing Pypi, `pip install pg-replica-auditor`.## UsageThis script requires three arguments:1. `--primary`, any acceptable Postgres connection string (incl. DSN),2. `--replica`, same as `--primary` but for the replica database,Optional arguments:1. `--exclude-tables`, excludes the comma-separated tables from the scan,2. `--table`, only scans this table,3. `--debug`, will print debugging information,4. `--rows`, will scan this many rows in the row comparisons check,5. `--lag-column`, will use this column for the replica lag check,6. `--show-skipped`, will print the skipped rows in the Last 1000 check,7. `--count-before`, will count all rows in the table created/updated before this timestamp,8. `--step-size`, will decrease the step size for missing sequential records search.Example:```bash$ pgreplicaauditor --primary=postgres://primary-db.amazonaws.com:5432/my_db --replica=postgres://replica-db.amazonaws.com:5432/my_db --table=immutable_items --lag-column=created_at --count-before=&quot;2020-04-06&quot;```</longdescription>
</pkgmetadata>