<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># python-logging-rabbitmq[![Build Status](https://travis-ci.org/albertomr86/python-logging-rabbitmq.svg?branch=master)](https://travis-ci.org/albertomr86/python-logging-rabbitmq)Logging handler to ships logs to RabbitMQ. Compatible with Django.## InstallationInstall using pip.```shpip install python_logging_rabbitmq```### Versions| Version      | Dependency      ||--------------|-----------------|| &amp;gt;= 2.x    |  Pika == 0.13   || &lt;= 1.1.1     |  Pika &lt;= 0.10   |## HandlersThis package has two built-in handlers that you can import as follows:```pythonfrom python_logging_rabbitmq import RabbitMQHandler```or (thanks to [@wallezhang](https://github.com/wallezhang))```pythonfrom python_logging_rabbitmq import RabbitMQHandlerOneWay```| Handler               | Description                                                                                                                                                                                                                                                                                  ||-----------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|| RabbitMQHandler       | Basic handler for sending logs to RabbitMQ. Every record will be delivered directly to RabbitMQ using the exchange configured.                                                                                                                                                               || RabbitMQHandlerOneWay | High throughput handler. Initializes an internal queue where logs are stored temporarily. A thread is used to deliver the logs to RabbitMQ using the exchange configured. Your app doesn't need to wait until the log is delivered. Notice that if the main thread dies you might lose logs. |## Standalone pythonTo use with python first create a logger for your app, then create an instance of the handler and add it to the logger created.```pythonimport loggingfrom python_logging_rabbitmq import RabbitMQHandlerlogger = logging.getLogger('myapp')logger.setLevel(logging.DEBUG)rabbit = RabbitMQHandler(host='localhost', port=5672)logger.addHandler(rabbit)logger.debug('test debug')```As result, a similar message as follows will be sent to RabbitMQ:```json{&quot;relativeCreated&quot;:280.61580657958984,&quot;process&quot;:13105,&quot;args&quot;:[],&quot;module&quot;:&quot;test&quot;,&quot;funcName&quot;:&quot;&lt;module&gt;&quot;,&quot;host&quot;:&quot;albertomr86-laptop&quot;,&quot;exc_text&quot;:null,&quot;name&quot;:&quot;myapp&quot;,&quot;thread&quot;:140032818181888,&quot;created&quot;:1482290387.454017,&quot;threadName&quot;:&quot;MainThread&quot;,&quot;msecs&quot;:454.01692390441895,&quot;filename&quot;:&quot;test.py&quot;,&quot;levelno&quot;:10,&quot;processName&quot;:&quot;MainProcess&quot;,&quot;pathname&quot;:&quot;test.py&quot;,&quot;lineno&quot;:11,&quot;msg&quot;:&quot;test debug&quot;,&quot;exc_info&quot;:null,&quot;levelname&quot;:&quot;DEBUG&quot;}```## Sending logsBy default, logs will be sent to RabbitMQ using the exchange **'log'**, this should be of **type topic**. The **routing key** used is formed by concatenating the *logger name* and the *log level*. For example:```pythonimport loggingfrom python_logging_rabbitmq import RabbitMQHandlerlogger = logging.getLogger('myapp')logger.setLevel(logging.DEBUG)logger.addHandler(RabbitMQHandler(host='localhost', port=5672))logger.info('test info')logger.debug('test debug')logger.warning('test warning')```The messages will be sent using the following routing keys:- myapp.INFO- myapp.DEBUG- myapp.WARNINGFor an explanation about topics and routing keys go to https://www.rabbitmq.com/tutorials/tutorial-five-python.htmlWhen create the handler, you're able to specify different parameters in order to connect to RabbitMQ or configure the handler behavior.## Overriding routing-key creationIf you wish to override routing-key format entirely, you can pass`routing_key_formatter` function which takes `LogRecord` objects and returnsrouting-key. For example:```pythonRabbitMQHandler(host='localhost',port=5672,routing_key_formatter=lambda r: ('some_exchange_prefix.{}'.format(r.levelname.lower())))```## ConfigurationThese are the configuration allowed:| Parameter             | Description                                                                                                                              | Default                               ||-----------------------|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|| host                  | RabbitMQ Server hostname or ip address.                                                                                                  | localhost                             || port                  | RabbitMQ Server port.                                                                                                                    | 5672                                  || username              | Username for authentication.                                                                                                             | None                                  || password              | Provide a password for the username.                                                                                                     | None                                  || exchange              | Name of the exchange to publish the logs. This exchange is considered of type topic.                                                     | log                                   || declare_exchange      | Whether or not to declare the exchange.                                                                                                  | False                                 || routing_key_format    | Customize how messages are routed to the queues.                                                                                         | {name}.{level}                        || routing_key_formatter | Customize how routing-key is constructed.                                                                                                | None                                  || connection_params     | Allow extra params to connect with RabbitMQ.                                                                                             | None                                  || formatter             | Use custom formatter for the logs.                                                                                                       | python_logging_rabbitmq.JSONFormatter || close_after_emit      | Close the active connection after send a log. A new connection is open for the next log.                                                 | False                                 || fields                | Dict to add as a field in each logs send to RabbitMQ. This is useful when you want fields in each log but without pass them every time.  | None                                  || fields_under_root     | When is True, each key in parameter 'fields' will be added as an entry in the log, otherwise they will be logged under the key 'fields'. | True                                  || message_headers       | A dictionary of headers to be published with the message.                                                                                | None                                  || record_fields         | A set of attributes that should be preserved from the record object.                                                                     | None                                  || exclude_record_fields | A set of attributes that should be ignored from the record object.                                                                       | None                                  || heartbeat             | Lower bound for heartbeat timeout.                                                                                                       | 60                                    || content_type          | The format of the message sent to the queue.                                                                                             | text/plain                            |### Examples#### RabbitMQ Connection```pythonrabbit = RabbitMQHandler(host='localhost',port=5672,username='guest',password='guest',connection_params={'virtual_host': '/','connection_attempts': 3,'socket_timeout': 5000})```#### Custom fields```pythonrabbit = RabbitMQHandler(host='localhost',port=5672,fields={'source': 'MyApp','env': 'production'},fields_under_root=True)```#### Custom formatterBy default, python_logging_rabbitmq implements a custom JSONFormatter; but if you prefer to format your own message you could do it as follow:```pythonimport loggingfrom python_logging_rabbitmq import RabbitMQHandlerFORMAT = '%(asctime)-15s %(message)s'formatter = logging.Formatter(fmt=FORMAT)rabbit = RabbitMQHandler(formatter=formatter)```For a custom JSON Formatter take a look at https://github.com/madzak/python-json-logger## DjangoTo use with Django add the handler in the [logging config](https://docs.djangoproject.com/en/1.9/topics/logging/#configuring-logging).```pythonLOGGING = {'version': 1,'disable_existing_loggers': False,'handlers': {'rabbit': {'level': 'DEBUG','class': 'python_logging_rabbitmq.RabbitMQHandler','host': 'localhost'}},'loggers': {'myapp': {'handlers': ['rabbit'],'level': 'DEBUG','propagate': False}}}```## ConfigurationSame as when use it with standalone python, you could configure the handle directly when declaring it in the config:```pythonLOGGING = {'version': 1,'disable_existing_loggers': False,'handlers': {'rabbit': {'level': 'DEBUG','class': 'python_logging_rabbitmq.RabbitMQHandler','host': 'localhost','port': 5672,'username': 'guest','password': 'guest','exchange': 'log','declare_exchange': False,'connection_params': {'virtual_host': '/','connection_attempts': 3,'socket_timeout': 5000},'fields': {'source': 'MainAPI','env': 'production'},'fields_under_root': True}},'loggers': {'myapp': {'handlers': ['rabbit'],'level': 'DEBUG','propagate': False}}}```#### Custom formatter```pythonLOGGING = {'version': 1,'disable_existing_loggers': False,'formatters': {'standard': {'format': '%(levelname)-8s [%(asctime)s]: %(message)s'}},'handlers': {'rabbit': {'level': 'DEBUG','class': 'python_logging_rabbitmq.RabbitMQHandler','host': 'localhost','formatter': 'standard'}},'loggers': {'myapp': {'handlers': ['rabbit'],'level': 'DEBUG','propagate': False}}}```#### JSON formatter```shpip install python-json-logger``````pythonLOGGING = {'version': 1,'disable_existing_loggers': False,'formatters': {'json': {'()': 'pythonjsonlogger.jsonlogger.JsonFormatter','fmt': '%(name)s %(levelname) %(asctime)s %(message)s'}},'handlers': {'rabbit': {'level': 'DEBUG','class': 'python_logging_rabbitmq.RabbitMQHandler','host': 'localhost','formatter': 'json'}},'loggers': {'myapp': {'handlers': ['rabbit'],'level': 'DEBUG','propagate': False}}}```## Releases| Date         | Version | Notes                                                    ||--------------|---------|----------------------------------------------------------|| Apr 24, 2022 | 2.2.0   | Handling thread shutdown (Thanks to [@donbowman](https://github.com/donbowman)). || Mar 10, 2019 | 1.1.1   | Removed direct dependency with Django. Integration with [Travis CI](https://travis-ci.org/). Configuration for tests. Using [pipenv](https://github.com/pypa/pipenv). || May 04, 2018 | 1.0.9   | Fixed exchange_type parameter in channel.exchange_declare (Thanks to [@cklos](https://github.com/cklos)). || Mar 21, 2018 | 1.0.8   | Allowing message headers (Thanks to [@merretbuurman](https://github.com/merretbuurman)). || May 15, 2017 | 1.0.7   | Adding support to customize the routing_key (Thanks to [@hansyulian](https://github.com/hansyulian)). || Mar 30, 2017 | 1.0.6   | Fix compatibility with python3 in RabbitMQHandlerOneWay (by [@sactre](https://github.com/sactre)). || Mar 28, 2017 | 1.0.5   | Explicit local imports.                                  || Mar 16, 2017 | 1.0.4   | Added new handler RabbitMQHandlerOneWay (by [@wallezhang](https://github.com/wallezhang)). || Mar 14, 2017 | 1.0.3   | Added config parameter close_after_emit.                 || Dec 21, 2016 | 1.0.2   | Minor fixes.                                             || Dec 21, 2016 | 1.0.1   | Minor fixes.                                             || Dec 21, 2016 | 1.0.0   | Initial release.                                         |## What's next?- Let's talk about tests.- Issues, pull requests, suggestions are welcome.- Fork and improve it. Free for all.## Similar efforts- MQHandler (https://github.com/ziXiong/MQHandler)- http://stackoverflow.com/a/25479008/2716524- LogBook (http://pydoc.net/Python/Logbook/0.12.5/logbook.queues/)- https://pypi.python.org/pypi/py-amqp-logging/0.1</longdescription>
</pkgmetadata>