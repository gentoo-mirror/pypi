<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>[![stars](https://img.shields.io/github/stars/Impact-I/reFlutter)](https://github.com/Impact-I/reFlutter/stargazers)&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/87244850/135659542-22bb8496-bf26-4e25-b7c1-ffd8fc0cea10.png&quot; width=&quot;75%&quot;/&gt;&lt;/p&gt;#**Read more on the blog:** https://swarm.ptsecurity.com/fork-bomb-for-flutter/This framework helps with Flutter apps reverse engineering using the patched version of the Flutter library which is already compiled and ready for app repacking. This library has snapshot deserialization process modified to allow you perform dynamic analysis in a convenient way.Key features:- `socket.cc` is patched for traffic monitoring and interception;- `dart.cc` is modified to print classes, functions and some fields;- display absolute code offset for functions- contains minor changes for successfull compilation;- if you would like to implement your own patches, there is manual Flutter code change is supported using specially crafted `Dockerfile`### Supported engines- Android: arm64, arm32;- iOS: arm64;- Release: Stable, Beta### Install```# Linux, Windows, MacOSpip3 install reflutter==0.7.7```### Usage```consoleimpact@f:~$ reflutter main.apkPlease enter your Burp Suite IP: &lt;input_ip&gt;SnapshotHash: 8ee4ef7a67df9845fba331734198a953The resulting apk file: ./release.RE.apkPlease sign the apk fileConfigure Burp Suite proxy server to listen on *:8083Proxy Tab -&gt; Options -&gt; Proxy Listeners -&gt; Edit -&gt; Binding TabThen enable invisible proxying in Request Handling TabSupport Invisible Proxying -&gt; trueimpact@f:~$ reflutter main.ipa```### Traffic interceptionYou need to specify the IP of your Burp Suite Proxy Server located in the same network where the device with the flutter application is. Next, you should configure the Proxy in  `BurpSuite -&gt; Listener Proxy -&gt; Options tab`- Add port: `8083`- Bind to address: `All interfaces`- Request handling: Support invisible proxying = `True`&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/87244850/135753172-20489ef9-0759-432f-b2fa-220607e896b8.png&quot; width=&quot;84%&quot;/&gt;&lt;/p&gt;You don't need to install any certificates. On an Android device, you don't need root access as well. reFlutter also allows to bypass some of the flutter certificate pinning implementations.### Usage on AndroidThe resulting apk must be aligned and signed. I use [uber-apk-signer](https://github.com/patrickfav/uber-apk-signer/releases/tag/v1.2.1)```java -jar uber-apk-signer.jar --allowResign -a release.RE.apk```.To see which code is loaded through DartVM, you need to run the application on the device. Note that you must manually find what `_kDartIsolateSnapshotInstructions` (ex. 0xB000 ) equals to using a binary search. reFlutter writes the dump to the root folder of the application and sets `777` permissions to the file and folder. You can pull the file with adb command```consoleimpact@f:~$ adb -d shell &quot;cat /data/data/&lt;PACKAGE_NAME&gt;/dump.dart&quot; &gt; dump.dart```&lt;details&gt;&lt;summary&gt;file contents&lt;/summary&gt;  ```dartLibrary:'package:anyapp/navigation/DeepLinkImpl.dart' Class: Navigation extends Object {  String* DeepUrl = anyapp://evil.com/ ; Function 'Navigation.': constructor. (dynamic, dynamic, dynamic, dynamic) =&gt; NavigationInteractor {                 Code Offset: _kDartIsolateSnapshotInstructions + 0x0000000000009270                     }     Function 'initDeepLinkHandle':. (dynamic) =&gt; Future&lt;void&gt;* {                 Code Offset: _kDartIsolateSnapshotInstructions + 0x0000000000412fe8                     }     Function '_navigateDeepLink@547106886':. (dynamic, dynamic, {dynamic navigator}) =&gt; void {                 Code Offset: _kDartIsolateSnapshotInstructions + 0x0000000000002638                     }        } Library:'package:anyapp/auth/navigation/AuthAccount.dart' Class: AuthAccount extends Account {PlainNotificationToken* _instance = sentinel;  Function 'getAuthToken':. (dynamic, dynamic, dynamic, dynamic) =&gt; Future&lt;AccessToken*&gt;* {                  Code Offset: _kDartIsolateSnapshotInstructions + 0x00000000003ee548                     }   Function 'checkEmail':. (dynamic, dynamic) =&gt; Future&lt;bool*&gt;* {                  Code Offset: _kDartIsolateSnapshotInstructions + 0x0000000000448a08                      } Function 'validateRestoreCode':. (dynamic, dynamic, dynamic) =&gt; Future&lt;bool*&gt;* {                  Code Offset: _kDartIsolateSnapshotInstructions + 0x0000000000412c34                      } Function 'sendSmsRestorePassword':. (dynamic, dynamic) =&gt; Future&lt;bool*&gt;* {                  Code Offset: _kDartIsolateSnapshotInstructions + 0x00000000003efb88                     }       }```&lt;/details&gt;### Usage on iOSUse the IPA file created after the execution of `reflutter main.ipa` command. To see which code is loaded through DartVM, you need to run the application on the device. reFlutter will print the dump file path to the Xcode console logs with the reFlutter tag`Current working dir: /private/var/mobile/Containers/Data/Application/&lt;UUID&gt;/dump.dart`Next, you will need to pull the file from the device&lt;p align=&quot;center&quot;&gt;&lt;img src=&quot;https://user-images.githubusercontent.com/87244850/135860648-a13ba3fd-93d2-4eab-bd38-9aa775c3178f.png&quot; width=&quot;100%&quot;/&gt;&lt;/p&gt;### FridaThe resulting offset from the dump can be used in the frida [script](https://github.com/Impact-I/reFlutter/blob/main/frida.js)```frida -U -f &lt;package&gt; -l frida.js --no-pause```To get value for `_kDartIsolateSnapshotInstructions` you can use `readelf -Ws libapp.so` Where is the value you need in the `Value` field### To Do- [x] Display absolute code offset for functions;- [ ] Extract more strings and fields;- [x] Add socket patch;- [ ] Extend engine support to Debug using Fork and Github Actions;- [ ] Improve detection of `App.framework` and `libapp.so` inside zip archive  ### Build EngineThe engines are built using [reFlutter](https://github.com/Impact-I/reFlutter/blob/main/.github/workflows/main.yml) in [Github Actions](https://github.com/Impact-I/reFlutter/actions) to build the desired version, commits and snapshot hashes are used from this [table](https://github.com/Impact-I/reFlutter/blob/main/enginehash.csv).The hash of the snapshot is extracted from ```storage.googleapis.com/flutter_infra_release/flutter/&lt;hash&gt;/android-arm64-release/linux-x64.zip```&lt;details&gt;&lt;summary&gt;release&lt;/summary&gt;  [![gif](https://user-images.githubusercontent.com/87244850/135758767-47b7d51f-8b6c-40b5-85aa-a13c5a94423a.gif)](https://github.com/Impact-I/reFlutter/actions)  &lt;/details&gt;### Custom BuildIf you would like to implement your own patches, manual Flutter code change is supported using specially crafted [Docker](https://hub.docker.com/r/ptswarm/reflutter)```sudo docker pull ptswarm/reflutter``````# Linux, WindowsEXAMPLE BUILD ANDROID ARM64:    sudo docker run -e WAIT=300 -e x64=0 -e arm=0 -e HASH_PATCH=&lt;Snapshot_Hash&gt; -e COMMIT=&lt;Engine_commit&gt; --rm -iv${PWD}:/t ptswarm/reflutterFLAGS:    -e x64=0                         &lt;disables building for x64 archiitechture, use to reduce building time&gt;    -e arm=0                         &lt;disables building for arm archiitechture, use to reduce building time&gt;    -e WAIT=300                      &lt;the amount of time in seconds you need to edit source code&gt;    -e HASH_PATCH=[Snapshot_Hash]    &lt;here you need to specify snapshot hash which matches the engine_commit line of enginehash.csv table best. It is used for proper patch search in reFlutter and for successfull compilation&gt;    -e COMMIT=[Engine_commit]        &lt;here you specify commit for your engine version, take it from enginehash.csv table or from flutter/engine repo&gt;```</longdescription>
</pkgmetadata>