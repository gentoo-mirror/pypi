<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>About this fork===============This repo is a fork of `powergo/pytracking` since it's unmaintained, with code used from `QueraTeam/pytracking` whichmade changes to make the code compatible with Python 3.5-3.10 and Django 1.11-4.0.This fork made further changes and gets released on PyPI under the name `pytracking2`.Tests are run against Python 3.7-3.10 and Django 3.2, 4.0, 4.1... image:: https://img.shields.io/badge/code%20style-black-000000.svg   :target: https://github.com/psf/blackpytracking - Email Open and Click Tracking Library==================================================:Authors:  Resulto Developpement Web Inc., QueraTeam, Mikuláš Poul:Version: 0.4.5This library provides a set of functions that provide open and click trackingwhen sending emails. This is particularly useful if you rely on an EmailService Provider (ESP) such as Amazon SES or PostmarkApp that does not provideopen and click tracking.The library only provides building blocks and does not handle the actualsending of email or the serving of tracking pixel and links, but it comespretty close to this... image:: https://img.shields.io/pypi/v/pytracking2.svg    :target: https://pypi.python.org/pypi/pytracking2.. image:: https://img.shields.io/pypi/l/pytracking2.svg.. image:: https://img.shields.io/pypi/pyversions/pytracking2.svg.. contents:: Summary    :backlinks: entry    :local:Overview--------There are two main steps when tracking email opens and link clicks:1. Adding tracking information to emails~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~To track email opens, the generally accepted strategy is to add a small 1x1transparent pixel at the end of an email. When a user opens an email, the emailclient (e.g., gmail, outlook, thunderbird) will load the pixel by making a GETrequest. The web server serving the request will then record the open andnotify the sender of the email.To track link clicks, the generally accepted strategy is to rewrite links in anemail to change the destination to a proxy. Once a user clicks on the link, theproxy redirects the user to the real link and notifies the sender of the email.pytracking provides a stateless strategy to open and click tracking: all theinformation you want to track are encoded in the pixel (open) and proxy (click)URLs. For example, if you want to track the customer id and the transaction idassociated with a particular email, pytracking will encode this information inthe URL. When the user opens the email or clicks on a link, the customer id andtransaction id will be decoded and can then be sent to a webhook.See the `Get Open Tracking Link`_ section for a quick example.2. Handling email opens and link clicks~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Once a user opens an email or clicks on a link, the email client will send arequest to the encoded URL. Your web server will receive such request and passit to pytracking, which will decode the tracking information. You can then usethe tracking information directly (e.g., update your tracking database) or youcan send the information to a webhook.In the case of link tracking, the decoded information will contain the originalURL that you must redirect the email client to.See the `Get Open Tracking Data from URL`_ section for a quick example.Optional Major Features provided by pytracking~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~1. Encryption: pytracking uses base 64 to encode your tracking information,   which can be decoded by anyone. You can optionaly encrypt your tracking   information, which can only be decoded if you have the key. See the   `Encrypting Data`_ section for more information.2. HTML modification: pytracking can modify an HTML email to replace all links   and add a tracking pixel. See the `Modifying HTML emails to add tracking links`_ section.3. Django: if you use Django to serve open and click tracking URLs, you can   extend pytracking Django views, which already provides the redirect and   pixel serving. See the `Using pytracking with Django`_ section.4. Webhooks: pytracking offers a shortcut function to make a POST request to a   webhook. See the `Notifying Webhooks`_ section.Requirements------------pytracking works with Python 3.4+. It doesn't require any external library, butthere are many optional features that have dependencies.Installation------------You can install pytracking using pip:::    pip install pytracking2You can install specific features with extras:::    pip install pytracking2[django,crypto]You can also install all features:::    pip install pytracking2[all]Basic Library Usage-------------------You can generate two kinds of tracking links with pytracking: a link to atransparent tracking pixel and a link that redirects to another link.Encoding~~~~~~~~You can encode metadata in both kinds of links. For example, you can associatea customer id with a click tracking link so when the customer clicks on thelink, you'll know exactly which customer clicked on it.pylinktracking implements a stateless tracking strategy: all necessaryinformation can be encoded in the tracking links. You can optionally keepcommon settings (e.g., default metadata to associate with all links, webhookURL) in a separate configuration.The information is encoded using url-safe base64 so anyone intercepting yourlinks, including your customers, could potentially decode the information. Youcan optionally encrypt the tracking information (see below).Most functions take as a parameter a ``pytracking.Configuration``instance that tells how to generate the links. You can also pass theconfiguration parameters as ``**kwargs`` argument or can mix both: the kwargswill override the configuration parameters.Decoding~~~~~~~~Once you get a request from a tracking link, you can use pytracking to decodethe link and get a ``pytracking.TrackingResult`` instance, which containsinformation such as the link to redirect to (if it's a click tracking link),the associated metadata, the webhook URL to notify, etc.Basic Library Examples----------------------Get Open Tracking Link~~~~~~~~~~~~~~~~~~~~~~::    import pytracking    open_tracking_url = pytracking.get_open_tracking_url(        {&quot;customer_id&quot;: 1}, base_open_tracking_url=&quot;https://trackingdomain.com/path/&quot;,        webhook_url=&quot;http://requestb.in/123&quot;, include_webhook_url=True)    # This will produce a URL such as:    # https://trackingdomain.com/path/e30203jhd9239754jh21387293jhf989sda=Get Open Tracking Link with Configuration~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~::    import pytracking    configuration = pytracking.Configuration(        base_open_tracking_url=&quot;https://trackingdomain.com/path/&quot;,        webhook_url=&quot;http://requestb.in/123&quot;,        include_webhook_url=False)    open_tracking_url = pytracking.get_open_tracking_url(        {&quot;customer_id&quot;: 1}, configuration=configuration)    # This will produce a URL such as:    # https://trackingdomain.com/path/e30203jhd9239754jh21387293jhf989sda=Get Click Tracking Link~~~~~~~~~~~~~~~~~~~~~~~::    import pytracking    click_tracking_url = pytracking.get_click_tracking_url(        &quot;http://www.example.com/?query=value&quot;, {&quot;customer_id&quot;: 1},        base_click_tracking_url=&quot;https://trackingdomain.com/path/&quot;,        webhook_url=&quot;http://requestb.in/123&quot;, include_webhook_url=True)    # This will produce a URL such as:    # https://trackingdomain.com/path/e30203jhd9239754jh21387293jhf989sda=Get Open Tracking Data from URL~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~::    import pytracking    full_url = &quot;https://trackingdomain.com/path/e30203jhd9239754jh21387293jhf989sda=&quot;    tracking_result = pytracking.get_open_tracking_result(        full_url, base_open_tracking_url=&quot;https://trackingdomain.com/path/&quot;)    # Metadata is in tracking_result.metadata    # Webhook URL is in tracking_result.webhook_urlGet Click Tracking Data from URL~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~::    import pytracking    full_url = &quot;https://trackingdomain.com/path/e30203jhd9239754jh21387293jhf989sda=&quot;    tracking_result = pytracking.get_click_tracking_result(        full_url, base_click_tracking_url=&quot;https://trackingdomain.com/path/&quot;)    # Metadata is in tracking_result.metadata    # Webhook URL is in tracking_result.webhook_url    # Tracked URL to redirect to is in tracking_result.tracked_urlGet a 1x1 transparent PNG pixel~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~::    import pytracking    (pixel_byte_string, mime_type) = pytracking.get_open_tracking_pixel()Encrypting Data---------------You can encrypt your encoded data to prevent third parties from accessing thetracking data encoded in your link.To use the encryption feature, you must install pytracking with``pytracking[crypto]``, which uses the `cryptography Python library&lt;https://cryptography.io/en/latest/&gt;`_.Encrypting your data slightly increases the length of the generated URL.::    import pytracking    from cryptography.fernet import Fernet    key = Fernet.generate_key()    # Encode    click_tracking_url = pytracking.get_click_tracking_url(        &quot;http://www.example.com/?query=value&quot;, {&quot;customer_id&quot;: 1},        base_click_tracking_url=&quot;https://trackingdomain.com/path/&quot;,        webhook_url=&quot;http://requestb.in/123&quot;, include_webhook_url=True,        encryption_bytestring_key=key)    # Decode    tracking_result = pytracking.get_open_tracking_result(        full_url, base_click_tracking_url=&quot;https://trackingdomain.com/path/&quot;,        encryption_bytestring_key=key)Using pytracking with Django----------------------------pytracking comes with View classes that you can extend and that handle open andclick tracking link request.For example, the ``pytracking.django.OpenTrackingView`` will return a 1x1transparent PNG pixel for GET requests. The``pytracking.django.ClickTrackingView`` will return a 302 redirect response tothe tracked URL.Both views will return a 404 response if the tracking URL is invalid. Bothviews will capture the user agent and the user ip of the request. Thisinformation will be available in TrackingResult.request_data.You can extend both views to determine what to do with the tracking result(e.g., call a webhook or submit a task to a celery queue). Finally, you canencode your configuration parameters in your Django settings or you can computethem in your view.To use the django feature, you must install pytracking with``pytracking[django]``.Configuration parameters in Django settings~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~You can provide default configuration parameters in your Django settings byadding this key in your settings file:::    PYTRACKING_CONFIGURATION = {        &quot;webhook_url&quot;: &quot;http://requestb.in/123&quot;,        &quot;base_open_tracking_url&quot;: &quot;http://tracking.domain.com/open/&quot;,        &quot;base_click_tracking_url&quot;: &quot;http://tracking.domain.com/click/&quot;,        &quot;default_metadata&quot;: {&quot;analytics_key&quot;: &quot;123456&quot;}    }Extending default views~~~~~~~~~~~~~~~~~~~~~~~::    from pytracking import Configuration    from pytracking.django import OpenTrackingView, ClickTrackingView    class MyOpenTrackingView(OpenTrackingView):        def notify_tracking_event(self, tracking_result):            # Override this method to do something with the tracking result.            # tracking_result.request_data[&quot;user_agent&quot;] and            # tracking_result.request_data[&quot;user_ip&quot;] contains the user agent            # and ip of the client.            send_tracking_result_to_queue(tracking_result)        def notify_decoding_error(self, exception, request):            # Called when the tracking link cannot be decoded            # Override this to, for example, log the exception            logger.log(exception)        def get_configuration(self):            # By defaut, fetchs the configuration parameters from the Django            # settings. You can return your own Configuration object here if            # you do not want to use Django settings.            return Configuration()    class MyClickTrackingView(ClickTrackingView):        def notify_tracking_event(self, tracking_result):            # Override this method to do something with the tracking result.            # tracking_result.request_data[&quot;user_agent&quot;] and            # tracking_result.request_data[&quot;user_ip&quot;] contains the user agent            # and ip of the client.            send_tracking_result_to_queue(tracking_result)        def notify_decoding_error(self, exception, request):            # Called when the tracking link cannot be decoded            # Override this to, for example, log the exception            logger.log(exception)        def get_configuration(self):            # By defaut, fetchs the configuration parameters from the Django            # settings. You can return your own Configuration object here if            # you do not want to use Django settings.            return Configuration()URLs configuration~~~~~~~~~~~~~~~~~~Add this to your urls.py file:::    urlpatterns = [        url(            &quot;^open/(?P&lt;path&gt;[\w=-]+)/$&quot;, MyOpenTrackingView.as_view(),            name=&quot;open_tracking&quot;),        url(            &quot;^click/(?P&lt;path&gt;[\w=-]+)/$&quot;, MyClickTrackingView.as_view(),            name=&quot;click_tracking&quot;),    ]Notifying Webhooks------------------You can send a POST request to a webhook with the tracking result. The webhookfeature just packages the tracking result as a json string in the POST body. Italso sets the content encoding to ``application/json``.To use the webhook feature, you must install pytracking with``pytracking[webhook]``.::    import pytracking    from pytracking.webhook import send_webhook    # Assumes that the webhook url is encoded in the url.    full_url = &quot;https://trackingdomain.com/path/e30203jhd9239754jh21387293jhf989sda=&quot;    tracking_result = pytracking.get_open_tracking_result(        full_url, base_click_tracking_url=&quot;https://trackingdomain.com/path/&quot;)    # Will send a POST request with the following json str body:    #  {    #    &quot;is_open_tracking&quot;: False,    #    &quot;is_click_tracking&quot;: True,    #    &quot;metadata&quot;: {...},    #    &quot;request_data&quot;: None,    #    &quot;tracked_url&quot;: &quot;http://...&quot;,    #    &quot;timestamp&quot;: 1389177318    #  }    send_webhook(tracking_result)Modifying HTML emails to add tracking links-------------------------------------------If you have an HTML email, pytracking can update all links with tracking linksand it can also add a transparent tracking pixel at the end of your email.To use the HTML feature, you must install pytracking with ``pytracking[html]``,which uses the `lxml library &lt;http://lxml.de/&gt;`_.::    import pytracking    from pytracking.html import adapt_html    html_email_text = &quot;...&quot;    new_html_email_text = adapt_html(        html_email_text, extra_metadata={&quot;customer_id&quot;: 1},        click_tracking=True, open_tracking=True)Testing pytracking------------------pytracking uses `tox &lt;https://tox.readthedocs.io/en/latest/&gt;`_ and `py.test&lt;http://docs.pytest.org/en/latest/&gt;`_. If you have tox installed, just run``tox`` and all possible configurations of pytracking will be tested on Python3.4.TODO----1. Add various checks to ensure that the input data is sane and does not bust   any known limits (e.g., URL length).2. Add more examples.3. Allow mulitple webhooks and webhooks per tracking method.4. Transform Django views into view mixins.5. Add option to encode the webhook timeout in the tracking URL.6. Document caveats of using pytracking.html (example: long emails are often   cut off by the email clients and the tracking pixel is thus not loaded).7. Add some form of API documentation (at least Configuration and   TrackingResult), maybe as a separate document.License-------This software is licensed under the `New BSD License`. See the `LICENSE` filein the repository for the full license text.</longdescription>
</pkgmetadata>