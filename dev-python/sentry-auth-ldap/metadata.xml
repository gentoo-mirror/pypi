<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># sentry-auth-ldap[![GitHub Workflow Status](https://img.shields.io/github/actions/workflow/status/PMExtra/sentry-auth-ldap/publish.yaml)](https://github.com/PMExtra/sentry-auth-ldap/actions)[![PyPI](https://img.shields.io/pypi/v/sentry-auth-ldap)](https://pypi.org/project/sentry-auth-ldap/)[![License](https://img.shields.io/pypi/l/sentry-auth-ldap)](https://raw.githubusercontent.com/PMExtra/sentry-auth-ldap/master/LICENSE.txt)A Django custom authentication backend for [Sentry](https://github.com/getsentry/sentry). This module extends the functionality of [django-auth-ldap](https://github.com/django-auth-ldap/django-auth-ldap) with Sentry specific features.## Features* Users created by this backend are managed users. Managed fields are not editable through the Sentry account page.* Users may be auto-added to an Organization upon creation.## PrerequisitesPlugin 21.9.x support Sentry 21.9.0 or higher. For legacy Sentry support, you can use another project [sentry-ldap-auth](https://github.com/Banno/getsentry-ldap-auth)## InstallationTo install, simply add `sentry-auth-ldap` to your *requirements.txt* for your Sentry environment (or `pip install sentry-auth-ldap`).For container environment, because of the minimal base image, it may miss some dependencies.You can easily enhance the image by `sentry/enhance-image.sh` script (need [getsentry/self-hosted](https://github.com/getsentry/self-hosted) 22.6.0 or higher):```Shell#!/bin/bashrequirements=('sentry-auth-ldap&gt;=21.9.0'# You can add other packages here, just like requirements.txt)# Install the dependencies of ldapapt-get updateapt-get install -y --no-install-recommends build-essential libldap2-dev libsasl2-devpip install ${requirements[@]}# Clean up to shrink the image sizeapt-get purge -y --auto-remove build-essentialrm -rf /var/lib/apt/lists/*# Support ldap over tls (ldaps://) protocolmkdir -p /etc/ldap &amp;&amp; echo &quot;TLS_CACERT /etc/ssl/certs/ca-certificates.crt&quot; &gt; /etc/ldap/ldap.conf```## ConfigurationThis module extends the [django-auth-ldap](https://django-auth-ldap.readthedocs.io/en/latest/) and all the options it provides are supported (up to v1.2.x, at least). To configure Sentry to use this module, add `sentry_auth_ldap.backend.SentryLdapBackend` to your `AUTHENTICATION_BACKENDS` in your *sentry.conf.py*, like this:```pythonAUTHENTICATION_BACKENDS = AUTHENTICATION_BACKENDS + (    'sentry_auth_ldap.backend.SentryLdapBackend',)```Then, add any applicable configuration options. Depending on your environment, and especially if you are running Sentry in containers, you might consider using [python-decouple](https://pypi.python.org/pypi/python-decouple) so you can set these options via environment variables.### sentry-auth-ldap Specific Options```PythonAUTH_LDAP_DEFAULT_SENTRY_ORGANIZATION = u'My Organization Name'```Auto adds created user to the specified organization (matched by name) if it exists.```PythonAUTH_LDAP_SENTRY_ORGANIZATION_ROLE_TYPE = 'member'```Role type auto-added users are assigned. Valid values in a default installation of Sentry are 'member', 'admin', 'manager' &amp; 'owner'. However, custom roles can also be added to Sentry, in which case these are also valid.```PythonAUTH_LDAP_SENTRY_ORGANIZATION_GLOBAL_ACCESS = True```Whether auto-created users should be granted global access within the default organization.```PythonAUTH_LDAP_SENTRY_SUBSCRIBE_BY_DEFAULT = False```Whether new users should be subscribed to any new projects by default. Disablingthis is useful for large organizations where a subscription to each projectmight be spammy.```PythonAUTH_LDAP_DEFAULT_EMAIL_DOMAIN = 'example.com'```Default domain to append to username as the Sentry user's e-mail address when the LDAP user has no `mail` attribute.&gt; **WARNING**: There is an obsoleted setting named `AUTH_LDAP_SENTRY_USERNAME_FIELD`.  &gt; It could be replaced by `AUTH_LDAP_USER_QUERY_FIELD` and `AUTH_LDAP_USER_ATTR_MAP` which django-auth-ldap built-in.### Sentry Options```PythonSENTRY_MANAGED_USER_FIELDS = ('email', 'first_name', 'last_name', 'password', )```Fields which managed users may not modify through the Sentry accounts view. Applies to all managed accounts.### Example Configuration```Pythonimport ldapfrom django_auth_ldap.config import LDAPSearch, GroupOfUniqueNamesTypeAUTH_LDAP_SERVER_URI = 'ldap://my.ldapserver.com'AUTH_LDAP_BIND_DN = ''AUTH_LDAP_BIND_PASSWORD = ''AUTH_LDAP_USER_QUERY_FIELD = 'username'AUTH_LDAP_USER_SEARCH = LDAPSearch(    'dc=domain,dc=com',    ldap.SCOPE_SUBTREE,    '(mail=%(user)s)',)AUTH_LDAP_USER_ATTR_MAP = {    'username': 'uid',    'name': 'cn',    'email': 'mail'}AUTH_LDAP_MAIL_VERIFIED = TrueAUTH_LDAP_GROUP_SEARCH = LDAPSearch(    '',    ldap.SCOPE_SUBTREE,    '(objectClass=groupOfUniqueNames)')AUTH_LDAP_GROUP_TYPE = GroupOfUniqueNamesType()AUTH_LDAP_REQUIRE_GROUP = NoneAUTH_LDAP_DENY_GROUP = NoneAUTH_LDAP_FIND_GROUP_PERMS = FalseAUTH_LDAP_CACHE_GROUPS = TrueAUTH_LDAP_GROUP_CACHE_TIMEOUT = 3600AUTH_LDAP_SENTRY_DEFAULT_ORGANIZATION = 'organization-slug'AUTH_LDAP_SENTRY_ORGANIZATION_ROLE_TYPE = 'member'AUTH_LDAP_SENTRY_GROUP_ROLE_MAPPING = {    'owner': ['sysadmins'],    'admin': ['devleads'],    'member': ['developers', 'seniordevelopers']}AUTH_LDAP_SENTRY_ORGANIZATION_GLOBAL_ACCESS = TrueAUTHENTICATION_BACKENDS = AUTHENTICATION_BACKENDS + (    'sentry_auth_ldap.backend.SentryLdapBackend',)# Optional logging for diagnostics.LOGGING['disable_existing_loggers'] = Falseimport logginglogger = logging.getLogger('django_auth_ldap')logger.setLevel(logging.DEBUG)```### Troubleshooting#### Work with LDAPS protocol (SSL/TLS)Put the below content into /etc/ldap/ldap.conf, otherwise the certificate won't be trusted.```plainTLS_CACERT /etc/ssl/certs/ca-certificates.crt```If your certificate was issued by a private CA, you should change the path.#### Don't use OCSP-Must-Staple certificate (SSL/TLS)Please don't use [OCSP-Must-Staple](https://oid-info.com/get/1.3.6.1.5.5.7.1.24) certificate with LDAPS.Some ldap servers (eg. OpenLDAP) don't support stapling OCSP response. So it will cause the handshake failed.</longdescription>
</pkgmetadata>