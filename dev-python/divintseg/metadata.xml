<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># divintseg`divintseg` is a simple package for computing diversity,integration, and segregation statistics on data sets.Typically, it is used with demographic data such as census data.[![Hippocratic License HL3-CL-ECO-EXTR-FFD-LAW-MIL-SV](https://img.shields.io/static/v1?label=Hippocratic%20License&amp;message=HL3-CL-ECO-EXTR-FFD-LAW-MIL-SV&amp;labelColor=5e2751&amp;color=bc8c3d)](https://firstdonoharm.dev/version/3/0/cl-eco-extr-ffd-law-mil-sv.html)[![Documentation Status](https://readthedocs.org/projects/divintseg/badge/?version=latest)](https://divintseg.readthedocs.io/en/latest/?badge=latest)![Tests Badge](reports/junit/tests-badge.svg)![Coverage Badge](reports/coverage/coverage-badge.svg)![PyPI - Downloads](https://img.shields.io/pypi/dm/divintseg)## Methodology`divintseg` uses a straightforward methodology tocompute its metrics. It is designed to makemathematical sense and have nice mathematical properties, while at the same time remaining simple enough that it makes sense to non-technicalpeople as well.### Visualizing Diversity, Integration, and SegregationIn order to build up some intuition on what ourmetrics are trying to model, it's useful to startwith some visual illustrations of the conceptsthe metrics try to capture.The most basic notion in our methodology is that of acommunity that consists of members of differentnon-overlapping groups. In order to build a basicintuition for communities, groups, and the metricswe will compute on them, we will begin with some visualrepresentations.We'll start with a community that, intuitively, looksboth diverse and integrated.![a community](docs/_static/d-and-i.png?raw=true)Each small circle represents an individual. The colorof the circle represents which one of three groups they belong to. There are equal numbers of blue,green, and orange circles, so we would tend toconsider this group to be diverse. Furthermore, themembers of the different groups are spread outthroughout the community so that every individualhas nearby neighbors that are in different groupsthan they are. This community looks integrated.In contrast, here is a community that looks diversebut not integrated.![a community](docs/_static/d-and-s.png?raw=true)Just like the previous community, this communityis diverse. It has an equal number of members ofeach group. But it is not integrated. Instead, itis segregated. Each of the three groups is concentrated and most individuals do not havenearby neighbors of a different group.Now let's look at some communities that are less diverse.Here is a non-diverse community. Almost all the individuals are in the blue group. ![a community](docs/_static/nd-and-ni.png?raw=true)This is also a segregated community. The few members ofthe orange and green groups are all together in onecorner of the community.Let's look at another community that is also not diverse,but looks like it might be at least a little more integrated than the last one.![a community](docs/_static/nd-and-mi.png?raw=true)How integrated really is this community? The few individualsin the orange and green groups are scattered around,but there aren't really enough of them to say that thecommunity is integrated. As we will see when we developthe math behind our methodology, a community that isnot that diverse cannot really be that integrated either,no matter how the individuals are distributed.### From Visuals to MathematicsWe will introduce our metrics oneby one, starting with diversity, then integration,and finally segregation. Informed by the visualsabove, we'll try to come up with definitions thatmake sense and can be translated into mathematicalequations and then into code.#### DiversityLet's begin with a working definition of diversity.We say a community is diverse if an average member of the community is likely to encounter people who are not members of their group as they navigate the community. This idea has been proposed multiple times across different fields.It is known as the [Gini-Simpson index](https://en.wikipedia.org//wiki/Diversity_index#Gini%E2%80%93Simpson_index),the Gibbs-Martin index,the Blau index, andexpected heterozygosity in different fields.Now let's turn that into math. In order tocompute the average chance a member of the community encounters someone of a differentgroup, we will first compute, for each group,what the chance that a random person fromthe entire population comes from a differentgroup. We will then compute the overall averageacross all groups.Let's start with the population shown here:![a community](docs/_static/d-and-s2.png?raw=true)All three groups are the same size. Let's startwith the blue group. The chance that a randomlychosen member of the population is a member ofthe blue group is thus $1/3$, or approximately $0.333$. We'll call this number $p$. The probability that a member ofthe blue group encounters someone of one of theother two groups when they encounter a randomperson from the entire population is $1 - p = 2/3$, or approximately $0.667$.Since all three groups are of the same size,they all have the same value of $p$. We cansummarize this in a table as follows:| Group                                   | Representation $p$ | Chance of Encountering a Member of Another Group $= 1 - p$ ||-----------------------------------------|:--------------------:|:------------------------------------------------------------:|| &lt;span style=&quot;color:blue;&quot;&gt;Blue&lt;/span&gt;   |       $0.333$        |                           $0.667$                            || &lt;span style=&quot;color:blue;&quot;&gt;Orange&lt;/span&gt; |       $0.333$        |                           $0.667$                            ||  &lt;span style=&quot;color:blue;&quot;&gt;Green&lt;/span&gt; |       $0.333$        |                           $0.667$                            |If we define the diversity of the population $D$ to be the average chanceof any member of the population encountering a member of another group, then in this example it is$$D = 0.333(0.667) + 0.333(0.667) + 0.333(0.667) = 0.667.$$Each of the three terms is for one of the three groups, and for each of them the fraction of the population in the group is$0.333$ and the chance of encountering a member of another groupis $0.667$.&gt; ### Some additional strictly optional mathematical details&gt;&gt; (Feel free to skip this section if you like.)&gt;  &gt; More formally, what we computed is &gt;&gt; $$D = \sum p(1 - p)$$&gt;&gt; The [Gini-Simpson index](https://en.wikipedia.org//wiki/Diversity_index#Gini%E2%80%93Simpson_index)&gt; formulation of diversity is normally written as the equivalent expression&gt;&gt; $$D = 1 - \sum p^2.$$&gt;&gt; The two are equivalent because &gt; &gt; $$D = \sum p(1 - p) = \sum p - \sum p^2 = 1 - \sum p^2$$&gt; &gt; The last step works because the $p$ values are probabilities for each group, so they add up to $1$, i.e. $\sum p = 1$.&gt;&gt; But in our discussion we stick to the earlier formulation because we think&gt; it more clearly expresses what we are computing and why, especially for&gt; small examples like the ones we are considering here.Now let's look at another example. It is one of the communities welooked at above.![a community](docs/_static/d-and-i.png?raw=true)In this example, each of the groups is also exactly one third ofthe population of the community, so we have the exact same numbers as before:| Group                                   | Representation $p$ | Chance of Encountering a Member of Another Group $= 1 - p$ ||-----------------------------------------|:--------------------:|:------------------------------------------------------------:|| &lt;span style=&quot;color:blue;&quot;&gt;Blue&lt;/span&gt;   |       $0.333$        |                           $0.667$                            || &lt;span style=&quot;color:blue;&quot;&gt;Orange&lt;/span&gt; |       $0.333$        |                           $0.667$                            || &lt;span style=&quot;color:blue;&quot;&gt;Green&lt;/span&gt;  |       $0.333$        |                           $0.667$                            |And again, $$D = 0.333(0.667) + 0.333(0.667) + 0.333(0.667) = 0.667.$$So this community has the same exact diversity as the last one,though it is clearly more integrated. We'll return to that later.Finally, let's look at a less diverse community. Again, this isone we looked at before.![a community](docs/_static/nd-and-ni.png?raw=true)Let's compute the $p$ for each of the three groups, and thencompute $D$. We'll add a column to our tablewhere we will compute $p(1-p)$ for each group, and then we will sum these up at the bottom of the table to get $D$.| Group                                   |   $p$   | $1 - p$ | Weighted Representation $p(1-p)$ ||-----------------------------------------|:---------:|:---------:|:----------------------------------:|| &lt;span style=&quot;color:blue;&quot;&gt;Blue&lt;/span&gt;   | $0.963$ | $0.037$ |             $0.036$              || &lt;span style=&quot;color:blue;&quot;&gt;Orange&lt;/span&gt; | $0.022$ | $0.978$ |             $0.022$              || &lt;span style=&quot;color:blue;&quot;&gt;Green&lt;/span&gt;  | $0.015$ | $0.985$ |             $0.015$              || Weighted Sum                            ||| $0.073$ |So this community's diversity is $0.073$. As we would expectfrom visual inspection, it is much lower than the diversity of theprevious two communities ($0.667$).#### IntegrationAs we saw above, two communities can have the exact same diversity,but to the eye appear to be very different when it comes to integration.Integration is all about whether the members of a diverse communityactually do interact, as the definition of diversity assumes theydo, by randomly encountering one another, or if, on the contrary,they live in segregated neighborhoods within the community in whichthey rarely encounter members of other groups.In order to make this notion of integration a little more formal,in a way that we can then write math and code to compute it, we willsay that a community is integrated if the average member of the community is likely to encounter people who are not members of their group as they navigate their local neighborhood within the community.Another way of putting this is that if the neighborhoods within a community are diverse, then the community is integrated. If the communityas a whole is diverse, but none of the neighborhoods in the communityare themselves diverse, then the community is not integrated.Mathematically speaking, integration is the population-weighted average of neighborhood diversity in the community.Let's look at an example of a community consisting of three neighborhoodsof equal population.![a community of neighborhoods](docs/_static/n-d-and-i.png?raw=true)We can compute the diversity withing each of the three neighborhoods.Since each neighborhood has exactly equal numbers of members of eachgroup, each neighborhood has diversity $D = 0.667$. We get this number by doing the exact same kind of calculation we did for the diversity of the community with equal members of each group above. We just repeat it three times, once for each neighborhood.Now, let's define $r$ for each neighborhood to be the fraction ofthe total population of the community that lives in the neighborhood.For our current example, $r = 1/3$ for each of the three neighborhoods since they are of equal size. Knowing $r$ and $D$ for each neighborhood, we can compute theintegration of the community by multiplying the $r$ and $D$ valuestogether for each neighborhood and summing them up. We do this in thefollowing table.| Neighborhood |   $r$   |   $D$   | Weighted Diversity $rD$ ||--------------|:---------:|:---------:|:-------------------------:|| A            | $0.333$ | $0.667$ |         $0.222$         || B            | $0.333$ | $0.667$ |         $0.222$         || C            | $0.333$ | $0.667$ |         $0.222$         || Weighted Sum ||| $0.667$ |So the integration of our community is $I = 0.667$. This is exactly the same as the overall diversity of the community.We won't go into the details here, but one of the consequencesof the way we set up our mathematical definitions of diversityand integration is that the value of $I$ for a community cannever be more that the value of $D$. That is, $I \le D$ inall cases. More generally, $I$ and $D$ are also both between$0$ and $1$, so $0 \le I \le D \le 1$ no matter how ourcommunity and the neighborhoods within it are constructed. No matter how big the community is, how big the neighborhoods are,whether the neighborhoods are all the same size or not, or howmany groups there are, the fundamental relationship $$0 \le I \le D \le 1$$will always hold true.Now let's look at a community where $I &lt; D$, meaning that integration is less than diversity in the community.![a community of neighborhoods](docs/_static/n-d-and-i2.png?raw=true)If we repeat our calculation of $D$ for each neighborhood anduse that to calculate $I$ again, we get| Neighborhood |   $r$   |   $D$   | Weighted Diversity $rD$ ||--------------|:---------:|:---------:|:-------------------------:|| A            | $0.333$ | $0.667$ |         $0.222$         || B            | $0.333$ | $0.444$ |         $0.148$         || C            | $0.333$ | $0.444$ |         $0.148$         || Weighted Sum ||| $0.519$ |So $I = 0.519$ for this community. Looking at this community vs. theprevious one, it does appear to be less integrated. Neighborhood Ais diverse, with equal numbers of each of the three groups, but the othertwo neighborhoods are less diverse. Each of them is completely lackingone of the three groups and has unequal numbers of the other two.So, as far as out math working out to produce $I = 0.519 &lt; D = 0.667$for this community, things make sense. The way the people in the community are divided up into neighborhoods results in integrationbeing less than the diversity of the community as a whole. This is incontrast to the previous example where each neighborhood was as diverseas the whole community, and as a result, $I$ was equal to $D$.Now let's look at a third example, one in which the diversity of the community as a whole was already low, and even the limited diversitythat exists is not shared among the neighborhoods. This should resultin a value of $I$ even lower than the already low value of $D$.![a community of neighborhoods](docs/_static/n-nd-and-s.png?raw=true)If we do our calculation of $D$ as we did above when we looked at this community without the neighborhood boundaries, $D = 0.073$.Now let's calculate $I$.| Neighborhood |   $r$   |   $D$   | Weighted Diversity $rD$ ||--------------|:---------:|:---------:|:-------------------------:|| A            | $0.333$ | $0.000$ |         $0.000$         || B            | $0.333$ | $0.000$ |         $0.000$         || C            | $0.333$ | $0.204$ |         $0.068$         || Weighted Sum ||| $0.068$ |Two of the neighborhoods (A and B) have no diversity at all. NeighborhoodC has a little bit. The overall integration of the community is $I = 0.068$,which is less than the diversity of $D = 0.073$ as we expected.Finally, just to drive home the point that diversity and integration aredifferent concepts, let's look at a community with high diversity butno integration at all.![a community of neighborhoods](docs/_static/n-d-and-s.png?raw=true)Overall diversity of the community is $D = 0.667$, but if we calculate$I$ we get| Neighborhood |   $r$   |   $D$   | Weighted Diversity $rD$ ||--------------|:---------:|:---------:|:-------------------------:|| A            | $0.333$ | $0.000$ |         $0.000$         || B            | $0.333$ | $0.000$ |         $0.000$         || C            | $0.333$ | $0.000$ |         $0.000$         || Weighted Sum ||| $0.000$ |$I = 0$. Despite the community being diverse, it is not integrated at all.#### SegregationSegregation is the opposite of integration. Since we know that forall communities, $0 \le I \le 1$ we simply define segregation as $S = 1 - I$.We don't generally use $S$ as often as we use $D$ and $I$, since it isso related to $I$, but for completeness, the `divintseg` library can compute it.## Code ExamplesNow that we have gone through the methodology behind `divintseg` at length, let's look at some examples of how to use the code itself.In most cases, data we will want to analyze with `divintseg` willexist in Pandas DataFrames, or in some other format that is easyto convert to a DataFrame. We'll use them in our examples.### DiversityWe begin with some diversity computations.First, let's start with a very simple example consisting of a single-rowDataFrame with a column for each group. The numbers in the columns representthe number of people in the community that belong to each group.The first community we looked at had 108 members of each group. So we couldconstruct it in code and compute its diversity as follows:```pythonimport pandas as pdfrom divintseg import diversitydf = pd.DataFrame(    [[108, 108, 108]],    columns=['blue', 'green', 'orange'])print(diversity(df))```This will print ```text0    0.666667Name: diversity, dtype: float64```The return value of the call to `diversity(df)` is a pandas Series with a single element, the diversity of the single row of `df`. And as we would expect, it got the same number we calculated manually above.Now let's try something a little more advanced, with three neighborhoodsin a community like in our examples above.```pythonimport pandas as pdfrom divintseg import diversitydf = pd.DataFrame(    [        ['A', 36, 36, 36],        ['B', 36, 36, 36],        ['C', 36, 36, 36],    ],    columns=['neighborhood', 'blue', 'green', 'orange'])df.set_index('neighborhood', inplace=True)print(diversity(df))```This time the output is ```textneighborhoodA    0.666667B    0.666667C    0.666667Name: diversity, dtype: float64````diversity(df)` calculated the diversity of each row independently.Again we reproduced some of the same results as we got manually above.Now let's try another example with some different diversity indifferent neighborhoods.```pythonimport pandas as pdfrom divintseg import diversitydf = pd.DataFrame(    [        ['A', 36, 36, 36],        ['B', 72, 0, 36],        ['C', 0, 72, 36],    ],    columns=['neighborhood', 'blue', 'green', 'orange'],)df.set_index('neighborhood', inplace=True)print(diversity(df))```Now the output is ```textneighborhoodA    0.666667B    0.444444C    0.444444Name: diversity, dtype: float64```just as we would expect.### IntegrationNow let's move on to integration. The API is almost as simpleas for diversity, but we have to specify what column or indexrepresents the neighborhood. More generally, since we mightnot actually be working with neighborhoods, but with variousother kinds of nested geographic areas. For example, if we are working with US Census data, we might be interested inintegration at the block group level computed over the diversityof the different blocks in the block group. But we mightalso want to skip a level in the census hierarchy as computethe integration of census tracts (groups of multiple block groups)over diversity down at the block level. The `integration` APIgives us the flexibility to choose how we do this.Here is an example where we put two communities in the sameDataFrame. The first, community `&quot;X&quot;` has equally diverseneighborhoods. The second, community `&quot;Y&quot;` has unequallydiverse neighborhoods.```pythonimport pandas as pdfrom divintseg import integrationdf = pd.DataFrame(    [        ['X', 'A', 36, 36, 36],        ['X', 'B', 36, 36, 36],        ['X', 'C', 36, 36, 36],                ['Y', 'A', 36, 36, 36],        ['Y', 'B', 72, 0, 36],        ['Y', 'C', 0, 72, 36],    ],    columns=['community', 'neighborhood', 'blue', 'green', 'orange'],)print(integration(df, by='community', over='neighborhood'))```The two keyword arguments are important. The first `by=&quot;community`, tellsthe API that we want our results by community. There are two unique communitiesin the data, `&quot;X&quot;`, and `&quot;Y&quot;`, so we should get two results. The second keyword,`over='neigborhood'` tells us what column to use to represent the inner levelof geography at which to compute the diversity numbers that we then aggregateup to the level specified by the `by=` argument.The result is ```text           integrationcommunity             X             0.666667Y             0.518519```This again matches the results we computed manually for these example communitiesand neighborhoods.### Diversity, Integration (and Segregation) All at OnceMore often than not, we want to compute diversity and integrationfor the same communities at the same time. We can do that with a singleAPI `divintseg.di`. It can also optionally tell us segregation too.Here is how to use it.```pythonimport pandas as pdfrom divintseg import didf = pd.DataFrame(    [        ['W', 'A', 108, 0, 0],        ['W', 'B', 0, 108, 0],        ['W', 'C', 0, 0, 108],                ['X', 'A', 36, 36, 36],        ['X', 'B', 36, 36, 36],        ['X', 'C', 36, 36, 36],                ['Y', 'A', 36, 36, 36],        ['Y', 'B', 72, 0, 36],        ['Y', 'C', 0, 72, 36],                ['Z', 'A', 108, 0, 0],        ['Z', 'B', 108, 0, 0],        ['Z', 'C', 96, 5, 7],    ],    columns=['community', 'neighborhood', 'blue', 'green', 'orange'],)print(di(df, by='community', over='neighborhood', add_segregation=True))```This gives us everything we would want to know about diversity, integration, and segregation in these communities in one outputDataFrame.```text           diversity  integration  segregationcommunity      W           0.666667     0.000000     1.000000                               X           0.666667     0.666667     0.333333Y           0.666667     0.518519     0.481481Z           0.071997     0.067844     0.932156```</longdescription>
</pkgmetadata>