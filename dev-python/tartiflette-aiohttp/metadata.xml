<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>![Tartiflette aiohttp](github-landing.png)**tartiflette-aiohttp** is a wrapper of `aiohttp` which includes the Tartiflette GraphQL Engine. You can take a look at the [Tartiflette API documentation](https://tartiflette.io/docs/welcome/what-is-tartiflette).## Usage```python# main.pyfrom aiohttp import webfrom tartiflette import Resolverfrom tartiflette_aiohttp import register_graphql_handlers@Resolver(&quot;Query.hello&quot;)async def resolver_hello(parent, args, ctx, info):    return &quot;hello &quot; + args[&quot;name&quot;]sdl = &quot;&quot;&quot;    type Query {        hello(name: String): String    }&quot;&quot;&quot;web.run_app(    register_graphql_handlers(        web.Application(),        engine_sdl=sdl    ))```Save the file and start the server.```bash$ python main.py======== Running on http://0.0.0.0:8080 ========(Press CTRL+C to quit)```&gt; Note: The server will be listening on the `/graphql` path by default.Send a request to your server```curl -v -d '{&quot;query&quot;: &quot;query { hello(name: &quot;Chuck&quot;) }&quot;}' -H &quot;Content-Type: application/json&quot; http://localhost:8080/graphql```## Installation`tartiflette-aiohttp` is available on [pypi.org](https://pypi.org/project/tartiflette-aiohttp/).**WARNING**: Do not forget to install the [tartiflette dependencies beforehand as explained in the tutorial](https://tartiflette.io/docs/tutorial/install-tartiflette/).```bashpip install tartiflette-aiohttp```## How to use### Use with built-in Tartiflette EngineThe basic and common way to use Tartiflette with `aiohttp`, is to create an `aiohttp` `web.Application` and use the `register_graphql_handlers` helper to bind Tartiflette and `aiohttp` together. `engine_*` parameters will be forwarded to the built-in [tartiflette](https://github.com/tartiflette/tartiflette) engine instance.```pythonfrom aiohttp import webfrom tartiflette_aiohttp import register_graphql_handlerssdl = &quot;&quot;&quot;    type Query {        hello(name: String): String    }&quot;&quot;&quot;ctx = {    'user_service': user_service}web.run_app(    register_graphql_handlers(        app=web.Application(),        engine_sdl=sdl,        engine_schema_name=&quot;default&quot;,        executor_context=ctx,        executor_http_endpoint='/graphql',        executor_http_methods=['POST', 'GET']    ))```**Parameters**:* **engine_sdl**: Contains the [Schema Definition Language](https://graphql.org/learn/schema/)  - Can be a string which contains the SDL  - Can be an array of strings, which contain the SDLs  - Can be a path to an SDL  - Can be an array of paths which contain the SDLs* **engine_schema_name**: Name of the schema used by the built-in engine. Useful for advanced use-cases, see [Schema Registry API](https://tartiflette.io/docs/api/schema-registry).* **executor_context**: Context which will be passed to each resolver (as a dict). Very useful for passing handlers to services, functions or data that you want to use in your resolvers. The context reference is **unique** per request, a shallow copy is created based on the context passed.  - **req**: Request object from `aiohttp`  - **app**: Application object from `aiohttp`* **executor_http_endpoint**: Endpoint where the GraphQL Engine will be attached, by default on `/graphql`* **executor_http_methods**: HTTP Methods where the GraphQL Engine will be attached, by default on **POST** and **GET**.### Use with custom Tartiflette engineIn the case you already have a Tartiflette Engine instance, or, you do not want to use the built-in instance. You can pass an existing instance to the `register_graphql_handlers` helper.```python# main.pyfrom aiohttp import webfrom tartiflette import Resolver, Enginefrom tartiflette_aiohttp import register_graphql_handlers@Resolver(&quot;Query.hello&quot;)async def resolver_hello(parent, args, ctx, info):    return &quot;hello &quot; + args[&quot;name&quot;]sdl = &quot;&quot;&quot;    type Query {        hello(name: String): String    }&quot;&quot;&quot;engine = Engine(sdl)ctx = {    'user_service': user_service}web.run_app(    register_graphql_handlers(        app=web.Application(),        engine=engine,        executor_context=ctx,        executor_http_endpoint='/graphql',        executor_http_methods=['POST', 'GET']    ))```**Parameters**:* **engine**: an instance of the Tartiflette Engine* **executor_context**: Context which will be passed to each resolver (as a dict). Very useful for passing handlers to services, functions or data that you want to use in your resolvers.  - **req**: Request object from `aiohttp`  - **app**: Application object from `aiohttp`* **executor_http_endpoint**: Endpoint where the GraphQL Engine will be attached, by default on `/graphql`* **executor_http_methods**: HTTP Methods where the GraphQL Engine will be attached, by default on **POST** and **GET**### Tartiflette with subscriptionsTartiflette embeds an easy way to deal with subscriptions. The only thing to do isto fill in the `subscription_ws_endpoint` parameter and everything will work outof the box with `aiohttp` WebSockets. You can see a full example[here](examples/aiohttp/dogs).### Enable GraphiQL handlerTartiflette allows you to set up an instance of GraphiQL easily to quickly testyour queries. The easiest way to do that is to set the `graphiql_enabled`parameter to `True`. Then, you can customize your GraphiQL instance by fillingthe `graphiql_options` parameter as bellow:```pythonfrom aiohttp import webfrom tartiflette_aiohttp import register_graphql_handlers_SDL = &quot;&quot;&quot;    type Query {        hello(name: String): String    }&quot;&quot;&quot;web.run_app(    register_graphql_handlers(        app=web.Application(),        engine_sdl=_SDL,        graphiql_enabled=True,        graphiql_options={  # This is optional            &quot;endpoint&quot;: &quot;/explorer&quot;,  # Default: `/graphiql`,            &quot;default_query&quot;: &quot;&quot;&quot;                query Hello($name: String) {                  hello(name: $name)                }            &quot;&quot;&quot;,            &quot;default_variables&quot;: {                &quot;name&quot;: &quot;Bob&quot;,            },            &quot;default_headers&quot;: {                &quot;Authorization&quot;: &quot;Bearer &lt;default_token&gt;&quot;,            },        },    ))```**Parameters**:* **engine_sdl**: Contains the [Schema Definition Language](https://graphql.org/learn/schema/)  - Can be a string which contains the SDL  - Can be an array of strings, which contain the SDLs  - Can be a path to an SDL  - Can be an array of paths which contain the SDLs* **graphiql_enabled** *(Optional[bool] = False)*: Determines whether or not we should include a GraphiQL interface* **graphiql_options** *(Optional[dict] = None)*: Customization options for the GraphiQL instance:  - **endpoint** *(Optional[str] = &quot;/graphiql&quot;)*: allows to customize the GraphiQL interface endpoint path  - **default_query** *(Optional[str] = None)*: allows you to pre-fill the GraphiQL interface with a default query  - **default_variables** *(Optional[dict] = None)*: allows you to pre-fill the GraphiQL interface with default variables  - **default_headers** *(Optional[dict] = None)*: allows you to add default headers to each request sent through the GraphiQL instance## Advance Use Case### Response header manipulation from resolverIt is possible to set header to the response directly from the resolver using `set_response_headers`Â method like:```pythonfrom tartiflette_aiohttp import set_response_headers@Resolver(&quot;Query.X&quot;)async def resolver_x(parent_result, args, ctx, info):    # do things    set_response_headers({&quot;Header&quot;: &quot;Value&quot;, &quot;AnotherHeader&quot;: &quot;AnotherValue&quot;})    return result```&gt; Note that this feature uses ContextVar and will only works for python 3.7.1 and later.OR it is also possible to do, if you do not have ContextVar, or don't want to use them:```pythonfrom aiohttp import webdef a_callable(req, data, ctx):    return web.json_response(data, headers=ctx[&quot;_any_custom_key&quot;])web.run_app(    register_graphql_handlers(        app=web.Application(),        engine_sdl=_SDL,        response_formatter=a_callable    ))@Resolver(&quot;Type.field_name&quot;)async def fiel_name_resolver(pr, args, ctx, info):    ctx[&quot;_any_custom_key&quot;] = {&quot;X-Header&quot;: &quot;What a wonderfull value&quot;}    return something```</longdescription>
</pkgmetadata>