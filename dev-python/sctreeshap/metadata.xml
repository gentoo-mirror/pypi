<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># sctreeshapWhen doing single-cell RNA sequencing work, we firstly do clustering by community detection. Then we match the clusters to major cell types, which forms a cluster tree.![clustertree.png](https://i.loli.net/2021/07/19/2bBatvnr45WczpK.png)We usually need to select a branch for analysis, which helps us investigate on gene differential expressions on cell subtypes. sctreeshap constructs a data structure, which helps us quickly filter data whose clusters are under a specific branch (or in a specific cluster set). Moreover, it can run shap automatically to indicate marker genes.Github repo:https://github.com/ForwardStar/sctreeshap# v0.7.6 &amp;&amp; v0.7.6.1 UpdateResolve dependency error: replace pathlib with pathlib2 since pathlib has no longer been supported in Python 3.10.# v0.7.5 Update- Custom model supported.In v0.7.0--v0.7.4, we mainly worked for supporting probability output for shap values. This is not stable and could not deal with a large feature set. Therefore, try using 'geneFiltering()' before setting output as 'probability'.A sample code is as follows:```pythonfrom sctreeshap import sctreeshapsample = sctreeshap()sample_dataset = sample.loadDefault()print(sample_dataset)## Select non-neuron branchsample_dataset = sample.selectBranch(sample_dataset, 'n70')sample_dataset = sample.geneFiltering(sample_dataset, 0.3)## Run explainersample.explainBinary(sample_dataset, 'Micro L1-3 TYROBP', shap_params = {    &quot;model_output&quot;: 'probability', # set output mode as 'probability'    &quot;bar_plot&quot; : True,    &quot;beeswarm&quot; : True,    &quot;decision_plot&quot; : True})sample.explainMulti(sample_dataset, shap_params = {    &quot;model_output&quot; : 'probability', # set output mode as 'probability'    &quot;bar_plot&quot; : True,    &quot;beeswarm&quot; : True,    &quot;decision_plot&quot; : True})```While in v0.7.5, we supported custom models in 'explainBinary()' and 'explainMulti()'. Currently, there is a new parameter 'model' in the two function. You can set model='XGBClassifier', model='RandomForestClassifier' or model='DecisionTreeClassifier'. However, in the most cases the default XGBClassifier has the best accuracy. You can also set the model as one you defined, like some neuron networks, which may even outperform xgboost models. We do not ensure that shap explainer supports your custom model.# Documentations## Installing sctreeshapDirectly install by pip:```shellpip install sctreeshap```Or by conda:```pythonconda create -n sctreeshap python=3.8conda activate sctreeshappip install sctreeshap```## ExampleAn example dataset, human brain MTG cell type, can be analyzed as default:```python# Run in Jupyter Notebookfrom sctreeshap import sctreeshapsample = sctreeshap()sample_dataset = sample.loadDefault()print(sample_dataset)## Select non-neuron branchsample_dataset = sample.selectBranch(sample_dataset, 'n70')## Run explainersample.explainMulti(sample_dataset)```The further details in the process are discussed in the following documents.## Data Input and FilteringA sctreeshap object construction needs a python dict reflecting the tree structure. Here is an example of the cluster tree above.```pythonfrom sctreeshap import sctreeshaptree_arr = {    &quot;n1&quot;: ('n2', 'n70'),    &quot;n2&quot;: ('n26', 'n3'),    &quot;n3&quot;: ('n4', 'n21'),    &quot;n4&quot;: ('n7', 'n5'),    &quot;n5&quot;: ('Exc L5-6 THEMIS DCSTAMP', 'n6'),    &quot;n6&quot;: ('Exc L5-6 THEMIS CRABP1', 'Exc L5-6 THEMIS FGF10'),    &quot;n7&quot;: ('n8', 'Exc L4-5 FEZF2 SCN4B'),    &quot;n8&quot;: ('n9', 'n12'),    &quot;n9&quot;: ('n10', 'Exc L5-6 THEMIS C1QL3'),    &quot;n10&quot;: ('n11', 'Exc L2-3 LINC00507 FREM3'),    &quot;n11&quot;: ('Exc L2 LAMP5 LTK', 'Exc L2-4 LINC00507 GLP2R'),    &quot;n12&quot;: ('n13', 'n17'),    &quot;n13&quot;: ('Exc L3-4 RORB CARM1P1', 'n14'),    &quot;n14&quot;: ('Exc L3-5 RORB ESR1', 'n15'),    &quot;n15&quot;: ('Exc L3-5 RORB COL22A1', 'n16'),    &quot;n16&quot;: ('Exc L3-5 RORB FILIP1L', 'Exc L3-5 RORB TWIST2'),    &quot;n17&quot;: ('n19', 'n18'),    &quot;n18&quot;: ('Exc L5-6 RORB TTC12', 'Exc L4-6 RORB C1R'),    &quot;n19&quot;: ('Exc L4-5 RORB FOLH1B', 'n20'),    &quot;n20&quot;: ('Exc L4-6 RORB SEMA3E', 'Exc L4-5 RORB DAPK2'),    &quot;n21&quot;: ('Exc L4-6 FEZF2 IL26', 'n22'),    &quot;n22&quot;: ('Exc L5-6 FEZF2 ABO', 'n23'),    &quot;n23&quot;: ('n24', 'Exc L5-6 FEZF2 EFTUD1P1'),    &quot;n24&quot;: ('n25', 'Exc L6 FEZF2 OR2T8'),    &quot;n25&quot;: ('Exc L6 FEZF2 SCUBE1', 'Exc L5-6 SLC17A7 IL15'),    &quot;n26&quot;: ('n27', 'n53'),    &quot;n27&quot;: ('n48', 'n28'),    &quot;n28&quot;: ('n41', 'n29'),    &quot;n29&quot;: ('n37', 'n30'),    &quot;n30&quot;: ('n31', 'n34'),    &quot;n31&quot;: ('n32', 'Inh L1-3 VIP GGH'),    &quot;n32&quot;: ('n33', 'Inh L1-3 VIP CCDC184'),    &quot;n33&quot;: ('Inh L1-3 VIP CHRM2', 'Inh L2-4 VIP CBLN1'),    &quot;n34&quot;: ('n36', 'n35'),    &quot;n35&quot;: ('Inh L2-4 VIP SPAG17', 'Inh L1-4 VIP OPRM1'),    &quot;n36&quot;: ('Inh L1-2 VIP LBH', 'Inh L2-3 VIP CASC6'),    &quot;n37&quot;: ('n39', 'n38'),    &quot;n38&quot;: ('Inh L2-5 VIP SERPINF1', 'Inh L2-5 VIP TYR'),    &quot;n39&quot;: ('n40', 'Inh L1-2 VIP PCDH20'),    &quot;n40&quot;: ('Inh L2-6 VIP QPCT', 'Inh L3-6 VIP HS3ST3A1'),    &quot;n41&quot;: ('n43', 'n42'),    &quot;n42&quot;: ('Inh L1-3 VIP ADAMTSL1', 'Inh L1-4 VIP PENK'),    &quot;n43&quot;: ('n44', 'n46'),    &quot;n44&quot;: ('n45', 'Inh L1-2 SST BAGE2'),    &quot;n45&quot;: ('Inh L1 SST CHRNA4', 'Inh L1âˆ’2 GAD1 MC4R'),    &quot;n46&quot;: ('Inh L1-3 PAX6 SYT6', 'n47'),    &quot;n47&quot;: ('Inh L1-2 VIP TSPAN12', 'Inh L1-4 VIP CHRNA6'),    &quot;n48&quot;: ('n49', 'n50'),    &quot;n49&quot;: ('Inh L1-2 PAX6 CDH12', 'Inh L1-2 PAX6 TNFAIP8L3'),    &quot;n50&quot;: ('Inh L1 SST NMBR', 'n51'),    &quot;n51&quot;: ('n52', 'Inh L2-6 LAMP5 CA1'),    &quot;n52&quot;: ('Inh L1-4 LAMP5 LCP2', 'Inh L1-2 LAMP5 DBP'),    &quot;n53&quot;: ('n54', 'Inh L2-5 PVALB SCUBE3'),    &quot;n54&quot;: ('Inh L3-6 SST NPY', 'n55'),    &quot;n55&quot;: ('n61', 'n56'),    &quot;n56&quot;: ('Inh L5-6 GAD1 GLP1R', 'n57'),    &quot;n57&quot;: ('Inh L5-6 PVALB LGR5', 'n58'),    &quot;n58&quot;: ('n59', 'Inh L5-6 SST MIR548F2'),    &quot;n59&quot;: ('Inh L4-5 PVALB MEPE', 'n60'),    &quot;n60&quot;: ('Inh L2-4 PVALB WFDC2', 'Inh L4-6 PVALB SULF1'),    &quot;n61&quot;: ('n62', 'Inh L5-6 SST TH'),    &quot;n62&quot;: ('n65', 'n63'),    &quot;n63&quot;: ('n64', 'Inh L2-4 SST FRZB'),    &quot;n64&quot;: ('Inh L1-3 SST CALB1', 'Inh L3-5 SST ADGRG6'),    &quot;n65&quot;: ('Inh L3-6 SST HPGD', 'n66'),    &quot;n66&quot;: ('n67', 'Inh L4-5 SST STK32A'),    &quot;n67&quot;: ('n69', 'n68'),    &quot;n68&quot;: ('Inh L5-6 SST NPM1P10', 'Inh L4-6 SST GXYLT2'),    &quot;n69&quot;: ('Inh L4-6 SST B3GAT2', 'Inh L5-6 SST KLHDC8A'),    &quot;n70&quot;: ('n71', 'Micro L1-3 TYROBP'),    &quot;n71&quot;: ('n72', 'Endo L2-6 NOSTRIN'),    &quot;n72&quot;: ('n73', 'Oligo L1-6 OPALIN'),    &quot;n73&quot;: ('OPC L1-6 PDGFRA', 'n74'),    &quot;n74&quot;: ('Astro L1-6 FGFR3 SLC14A1', 'Astro L1-2 FGFR3 GFAP')}Sample = sctreeshap(tree_arr)```The keys of the dict represent the name of each tree node, while the values represent the children of each node (the tree can be either binary or multi-children). Note that clusters do not need to be assigned as a key, since they are the leaf nodes in the tree and do not have children.Then you can read in data by:```pythondata = Sample.readData('samplefile.csv', output='DataFrame')```which can recognize .csv, .pkl, .h5ad, .loom, and .xlsx file, and will return an AnnData or DataFrame object.For the cluster tree in the beginning of this documentation, the corresponding dataset can be loaded by:```pythondata = Sample.loadDefault()```After reading in data, you can select a branch in the cluster tree. Cells with clusters not under the branch will be filtered:```python# Select non-neuron branch: n70data = Sample.selectBranch(data, 'n70')```You can also filter low-expressed genes, housekeeping genes and general genes by:```pythonprefix = [&quot;MT&quot;, &quot;RPS&quot;, &quot;RPL&quot;, &quot;HSP&quot;, &quot;HLA&quot;]housekeeping = Sample.loadHousekeeping('human')data = Sample.geneFiltering(data, min_partial=0.3, gene_set=housekeeping, gene_prefix=prefix, use_PCA=False)print(data)```Then genes expressed in &lt;30% cells will be filtered. Genes in gene_set or with prefix in gene_prefix will also be filtered.You can merge clusters under a branch if needed:```pythondata = Sample.mergeBranch(data, 'n73')```This relabels cells with cluster ['OPC L1-6 PDGFRA', 'Astro L1-6 FGFR3 SLC14A1', 'Astro L1-2 FGFR3 GFAP'] as 'n73'.## Displaying Shap FiguresNote: this part is recommended to run in jupyter notebook.After reading in the data and filtering, you can build multi-classification model and generate shap figures:```pythonSample.explainMulti(    data,    use_SMOTE=False,    nthread=48, # multi-thread    shap_params={        &quot;max_display&quot;: 10,        &quot;bar_plot&quot;: True,        &quot;beeswarm&quot;: False,        &quot;decision_plot&quot;: False    })```or build binary-classification model and generate shap figures:```pythonSample.explainBinary(    data,    cluster_name='Micro L1-3 TYROBP',    use_SMOTE=False,    nthread=48, # multi-thread    shap_params={        &quot;max_display&quot;: 10,        &quot;bar_plot&quot;: True,        &quot;beeswarm&quot;: True,        &quot;force_plot&quot;: False,        &quot;heat_map&quot;: False,        &quot;decision_plot&quot;: False    })```## Get Shap Values and Marker GenesAfter running explainBinary() or explainMulti(), you can run:```pythonshap_values = Sample.getShapValues()marker_genes = Sample.getTopGenes()```to get shapley values and marker genes (with top absolute mean shap values).## API ReferencesFor more functions, you can refer to the documentations by printing the help function out:```pythonprint(Sample.help('documentations'))```and query the details of a function by:```pythonfunction_name = 'readData' # Can be whatever the function in the classprint(Sample.help(function_name))```</longdescription>
</pkgmetadata>