<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># Netchecks&lt;p align=&quot;center&quot;&gt;  &lt;img alt=&quot;Netchecks Logo&quot; src=&quot;https://raw.githubusercontent.com/hardbyte/netchecks/main/.github/logo.png&quot; width=&quot;150&quot; /&gt;&lt;/p&gt;&lt;div align=&quot;center&quot;&gt;[![PyPI](https://img.shields.io/pypi/v/netcheck.svg)](https://pypi.org/project/netcheck/)![PyPI - Python Version](https://img.shields.io/pypi/pyversions/netcheck)[![ArtifactHub - Netchecks](https://img.shields.io/badge/ArtifactHub-Netchecks-informational)](https://artifacthub.io/packages/helm/netchecks/netchecks)[![Coverage Status](https://coveralls.io/repos/github/hardbyte/netcheck/badge.svg?branch=main)](https://coveralls.io/github/hardbyte/netcheck?branch=main)[![CI status](https://github.com/hardbyte/netchecks/workflows/CI/badge.svg?branch=main)](https://github.com/hardbyte/netchecks/actions?query=branch%3Amain)[![PyPI Downloads](https://static.pepy.tech/badge/netcheck)](https://pypi.org/project/netcheck/)&lt;/div&gt;**Netchecks** is a set of tools for testing network conditions and asserting that they are as expected.There are two main components:- **Netchecks Operator** - Kubernetes Operator that runs network checks and reports results as `PolicyReport` resources. See the [operator README](https://github.com/hardbyte/netchecks/blob/main/operator/README.md) for more details and the full documentation can be found at [https://docs.netchecks.io](https://docs.netchecks.io)- **Netcheck CLI and Python Library** - Command line tool for running network checks and asserting that they are as expected. Keep reading for the quickstart.# Netcheck Command Line Tool`netcheck` is a configurable command line application for testing network conditions are as expected. It can be used to validate DNS and HTTP connectivity and can be configured to assert that the results are as expected, for example:```shellnetcheck http --url=https://github.com/status --validation-rule &quot;data.body.contains('GitHub lives!') &amp;&amp; data['status-code'] in [200, 201]&quot;```## InstallationInstall the Python package from PyPi:```pip install netcheck```The cli can also be run via Docker:```shelldocker run -it ghcr.io/hardbyte/netchecks:main```### Individual AssertionsBy default `netcheck` outputs a JSON result to stdout including response details: ```shell$ netcheck dns``````json{  &quot;spec&quot;: {    &quot;type&quot;: &quot;dns&quot;,    &quot;nameserver&quot;: null,    &quot;host&quot;: &quot;github.com&quot;,    &quot;timeout&quot;: 30.0  },  &quot;data&quot;: {    &quot;canonical_name&quot;: &quot;github.com.&quot;,    &quot;expiration&quot;: 1675825244.2986872,    &quot;response&quot;: &quot;id 6176\nopcode QUERY\nrcode NOERROR\nflags QR RD RA\nedns 0\npayload 65494\n;QUESTION\ngithub.com. IN A\n;ANSWER\ngithub.com. 60 IN A 20.248.137.48\n;AUTHORITY\n;ADDITIONAL&quot;,    &quot;A&quot;: [      &quot;20.248.137.48&quot;    ],    &quot;startTimestamp&quot;: &quot;2023-02-08T02:59:44.248174&quot;,    &quot;endTimestamp&quot;: &quot;2023-02-08T02:59:44.298773&quot;  },  &quot;status&quot;: &quot;pass&quot;}```Pass the `-v` flag to see log messages.Each check can be configured, e.g. you can specify the `server` and `host` for a `dns` check, andtell `netcheck` whether a particular configuration is expected to pass or fail:```shellnetcheck dns --server 1.1.1.1 --host hardbyte.nz --should-pass``````json{  &quot;spec&quot;: {    &quot;type&quot;: &quot;dns&quot;,    &quot;nameserver&quot;: &quot;1.1.1.1&quot;,    &quot;host&quot;: &quot;hardbyte.nz&quot;,    &quot;timeout&quot;: 30.0,    &quot;pattern&quot;: &quot;\ndata['response-code'] == 'NOERROR' &amp;&amp;\nsize(data['A']) &gt;= 1 &amp;&amp; \n(timestamp(data['endTimestamp']) - timestamp(data['startTimestamp']) &lt; duration('10s'))\n&quot;  },  &quot;data&quot;: {    &quot;canonical_name&quot;: &quot;hardbyte.nz.&quot;,    &quot;expiration&quot;: 1683241225.5542665,    &quot;response&quot;: &quot;id 53196\nopcode QUERY\nrcode NOERROR\nflags QR RD RA\n;QUESTION\nhardbyte.nz. IN A\n;ANSWER\nhardbyte.nz. 3600 IN A 209.58.165.79\n;AUTHORITY\n;ADDITIONAL&quot;,    &quot;A&quot;: [      &quot;209.58.165.79&quot;    ],    &quot;response-code&quot;: &quot;NOERROR&quot;,    &quot;startTimestamp&quot;: &quot;2023-05-04T22:00:24.491750&quot;,    &quot;endTimestamp&quot;: &quot;2023-05-04T22:00:25.554344&quot;  },  &quot;status&quot;: &quot;pass&quot;}```Netcheck can handle checks that are expected to fail:```shell$ netcheck dns --server=1.1.1.1 --host=made.updomain --should-fail```Note the resulting status will show **pass** if the check fails as expected, and **fail** if the check passes unexpectedly!netcheck has built in default validation for each check type. For example, the `dns` check will pass if the DNS response code is `NOERROR`, there is at least one `A` record, and resolver responds in under 10 seconds. Custom validation is also possible, see the [Custom Validation](#custom-validation) section below.## Custom ValidationCustom validation can be added to checks by providing a `validation-rule` option on the command line, or a `validation` key in the rules of a test spec when configuring via json. For example to override the default validation for the `dns` check to check that the A record resolves to a particular IP:```shellnetcheck dns --host github.com --validation-rule &quot;data['A'].contains('20.248.137.48')&quot;```The validation rule is a CEL expression that is evaluated with the `data` returned by the check and `spec` objects in scope. For an introduction to CEL see https://github.com/google/cel-spec/blob/master/doc/intro.md## http checks`http` checks are also available:Assert that GitHub's status page includes the text &quot;GitHub lives!&quot; and that the response code is 200:```shellnetcheck http --url=https://github.com/status --validation-rule &quot;data.body.contains('GitHub lives!') &amp;&amp; data['status-code'] in [200, 201]&quot;```Provide a header with a request:```shellnetcheck http --url https://pie.dev/headers --header &quot;X-Header:special&quot;```Validate that the response body is valid JSON and includes a `headers` object containing the `X-Header` key with the value `special`:```shellnetcheck http --url https://pie.dev/headers \  --header &quot;X-Header:special&quot; \  --validation-rule &quot;parse_json(data.body).headers['X-Header'] == 'special'&quot;```Ensure that a POST request fails:```shell$ netcheck http --method=post --url=https://s3.ap-southeast-2.amazonaws.com --should-fail```## Configuration via fileThe main way to run `netcheck` is passing in a list of assertions. A json file can be provided with a list of assertions to be checked:```json{  &quot;assertions&quot;: [    {      &quot;name&quot;:  &quot;deny-cloudflare-dns&quot;,       &quot;rules&quot;: [        {&quot;type&quot;: &quot;dns&quot;, &quot;server&quot;:  &quot;1.1.1.1&quot;, &quot;host&quot;: &quot;github.com&quot;}      ]    }  ]}```And the `run` command can be called:```shell$ netcheck run --config tests/testdata/dns-config.json```The output should be valid JSON containing results for each assertion.Multiple assertions with multiple rules can be specified in the config file,configuration can be provided to each rule such as headers and custom validation:```json{  &quot;assertions&quot;: [    {&quot;name&quot;:  &quot;get-with-header&quot;, &quot;rules&quot;: [      {&quot;type&quot;: &quot;http&quot;, &quot;url&quot;: &quot;https://pie.dev/headers&quot;, &quot;headers&quot;: {&quot;X-Test-Header&quot;:  &quot;value&quot;}},      {&quot;type&quot;: &quot;http&quot;, &quot;url&quot;: &quot;https://pie.dev/headers&quot;, &quot;headers&quot;: {&quot;X-Header&quot;: &quot;secret&quot;}, &quot;validation&quot;: &quot;parse_json(data.body).headers['X-Header'] == 'secret'&quot; }    ]}  ]}```## External DataFinally, external context can be referenced to inject data. The following example is a valid config file, if a bit contrived:```json{  &quot;assertions&quot;: [    {      &quot;name&quot;: &quot;example-assertion&quot;,      &quot;rules&quot;: [        {          &quot;type&quot;: &quot;http&quot;,          &quot;url&quot;: &quot;{{customdata.url}}&quot;,          &quot;headers&quot;: {&quot;{{customdata.header}}&quot;: &quot;{{ b64decode(token) }}&quot;},          &quot;validation&quot;: &quot;parse_json(data.body).headers['X-Header'] == 'secret'&quot;        }      ]    }  ],  &quot;contexts&quot;: [    {&quot;name&quot;: &quot;customdata&quot;, &quot;type&quot;: &quot;inline&quot;, &quot;data&quot;: {&quot;url&quot;: &quot;https://pie.dev/headers&quot;, &quot;header&quot;: &quot;X-Header&quot;}},    {&quot;name&quot;: &quot;token&quot;, &quot;type&quot;: &quot;inline&quot;, &quot;data&quot;: &quot;c2VjcmV0==&quot;},    {&quot;name&quot;: &quot;selfref&quot;, &quot;type&quot;: &quot;file&quot;, &quot;path&quot;: &quot;example-config.json&quot;}  ]}```In the above example the `customdata` and `token` contexts are injected into the rule.The `customdata.url` is used as the URL for the request, `customdata.header` is used as the name of the header.The `token` is base64 decoded and used as the value of the header.The `selfref` context is unused but shows how to load data an external JSON file which is used extensively by theKubernetes operator to inject data.## DevelopmentUpdate version in pyproject.toml, push to `main` and create a release on GitHub. Pypi release will be carriedout by GitHub actions. Install dev dependencies with Poetry:```shellpoetry install --with dev```### Manual Release To release manually, use Poetry:```shellpoetry version patchpoetry buildpoetry publish```### TestingPytest is used for testing. ```shellpoetry run pytest```</longdescription>
</pkgmetadata>