<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>&lt;div align=&quot;center&quot;&gt;&lt;img alt=&quot;Logo&quot; src=&quot;https://github.com/salesforce/Merlion/raw/main/merlion_logo.svg&quot; width=&quot;80%&quot;/&gt;&lt;/div&gt;&lt;div align=&quot;center&quot;&gt;  &lt;a href=&quot;https://github.com/salesforce/Merlion/actions&quot;&gt;  &lt;img alt=&quot;Tests&quot; src=&quot;https://github.com/salesforce/Merlion/actions/workflows/tests.yml/badge.svg?branch=main&quot;/&gt;  &lt;/a&gt;  &lt;a href=&quot;https://github.com/salesforce/Merlion/actions&quot;&gt;  &lt;img alt=&quot;Coverage&quot; src=&quot;https://github.com/salesforce/Merlion/raw/badges/coverage.svg&quot;/&gt;  &lt;/a&gt;  &lt;a href=&quot;https://pypi.python.org/pypi/salesforce-merlion&quot;&gt;  &lt;img alt=&quot;PyPI Version&quot; src=&quot;https://img.shields.io/pypi/v/salesforce-merlion.svg&quot;/&gt;  &lt;/a&gt;  &lt;a href=&quot;https://opensource.salesforce.com/Merlion/index.html&quot;&gt;  &lt;img alt=&quot;docs&quot; src=&quot;https://github.com/salesforce/Merlion/actions/workflows/docs.yml/badge.svg&quot;/&gt;  &lt;/a&gt;&lt;/div&gt;# Merlion: A Machine Learning Library for Time Series## Table of Contents1. [Introduction](#introduction)1. [Comparison with Related Libraries](#comparison-with-related-libraries)1. [Installation](#installation)1. [Documentation](#documentation)1. [Getting Started](#getting-started)    1. [Anomaly Detection](#anomaly-detection)    1. [Forecasting](#forecasting)1. [Evaluation and Benchmarking](#evaluation-and-benchmarking)1. [Technical Report and Citing Merlion](#technical-report-and-citing-merlion)## IntroductionMerlion is a Python library for time series intelligence. It provides an end-to-end machine learning framework thatincludes loading and transforming data, building and training models, post-processing model outputs, and evaluatingmodel performance. It supports various time series learning tasks, including forecasting, anomaly detection,and change point detection for both univariate and multivariate time series. This library aims to provide engineers andresearchers a one-stop solution to rapidly develop models for their specific time series needs, and benchmark themacross multiple time series datasets.Merlion's key features are-  Standardized and easily extensible data loading &amp; benchmarking for a wide range of forecasting and anomaly   detection datasets. This includes transparent support for custom datasets.-  A library of diverse models for anomaly detection, forecasting, and change point detection, all   unified under a shared interface. Models include classic statistical methods, tree ensembles, and deep   learning approaches. Advanced users may fully configure each model as desired.-  Abstract `DefaultDetector` and `DefaultForecaster` models that are efficient, robustly achieve good performance,   and provide a starting point for new users.-  AutoML for automated hyperaparameter tuning and model selection.-  Unified API for using a wide range of models to forecast with   [exogenous regressors](https://opensource.salesforce.com/Merlion/tutorials/forecast/3_ForecastExogenous.html).-  Practical, industry-inspired post-processing rules for anomaly detectors that make anomaly scores more interpretable,   while also reducing the number of false positives.-  Easy-to-use ensembles that combine the outputs of multiple models to achieve more robust performance. -  Flexible evaluation pipelines that simulate the live deployment &amp; re-training of a model in production,   and evaluate performance on both forecasting and anomaly detection.-  Native support for visualizing model predictions, including with a clickable visual UI.-  Distributed computation [backend](https://opensource.salesforce.com/Merlion/merlion.spark.html) using PySpark,   which can be used to serve time series applications at industrial scale.## Comparison with Related LibrariesThe table below provides a visual overview of how Merlion's key features compare to other libraries for time seriesanomaly detection and/or forecasting.|                     | Merlion | Prophet | Alibi Detect | Kats | darts | statsmodels | nixtla | GluonTS | RRCF | STUMPY | Greykite |pmdarima :---                  | :---:     | :---:|  :---:  | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :----: | :---:| Univariate Forecasting | ✅ | ✅| | ✅ | ✅ | ✅ | ✅ | ✅ | | |✅| ✅ | Multivariate Forecasting | ✅ | | | ✅ | ✅ | ✅| ✅ | ✅ | | | | || Univariate Anomaly Detection | ✅ | ✅ | ✅ | ✅ | ✅ | | | | ✅ | ✅ | ✅ | ✅ | | Multivariate Anomaly Detection | ✅ | | ✅ | ✅ | ✅ | | | | ✅ | ✅ | | | || Pre Processing | ✅ | | ✅ | ✅ | ✅ | | ✅ | ✅ | | | ✅ | ✅| Post Processing | ✅ | | ✅ | | | | | | | | | || AutoML | ✅ | | | ✅ | | | | | | | | ✅ | | ✅ | Ensembles | ✅ | | | ✅ | ✅ | | | | | ✅ | | | | | Benchmarking | ✅ | | | | ✅ | ✅ | ✅ | | | | ✅ | | Visualization | ✅ | ✅ | | ✅ | ✅ | | | | | | ✅ | The following features are new in Merlion 2.0:|                     | Merlion | Prophet | Alibi Detect | Kats | darts | statsmodels | nixtla | GluonTS | RRCF | STUMPY | Greykite |pmdarima :---                  | :---:     | :---:|  :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :----: | :---:| Exogenous Regressors   | ✅ | ✅ | | |✅ | ✅ |  | | | | ✅ | ✅| Change Point Detection | ✅ | ✅ | ✅ | ✅ | | | | | | | ✅ || Clickable Visual UI    | ✅ | | | | | | | | | | || Distributed Backend    | ✅ | | | | | | ✅ | | | | | ## InstallationMerlion consists of two sub-repos: `merlion` implements the library's core time series intelligence features,and `ts_datasets` provides standardized data loaders for multiple time series datasets. These loaders loadtime series as ``pandas.DataFrame`` s with accompanying metadata.You can install `merlion` from PyPI by calling ``pip install salesforce-merlion``. You may install from source bycloning this repoand calling ``pip install Merlion/``, or ``pip install -e Merlion/`` to install in editable mode.You may install additional dependencies via ``pip install salesforce-merlion[all]``,  or by calling``pip install &quot;Merlion/[all]&quot;`` if installing from source. Individually, the optional dependencies include ``dashboard`` for a GUI dashboard,``spark`` for a distributed computation backend with PySpark, and ``deep-learning`` for all deep learning models.To install the data loading package `ts_datasets`, clone this repo and call ``pip install -e Merlion/ts_datasets/``.This package must be installed in editable mode (i.e. with the ``-e`` flag) if you don't want to manually specify theroot directory of every dataset when initializing its data loader.Note the following external dependencies:1. Some of our forecasting models depend on OpenMP. If using ``conda``, please ``conda install -c conda-forge lightgbm``   before installing our package. This will ensure that OpenMP is configured to work with the ``lightgbm`` package   (one of our dependencies) in your ``conda`` environment. If using Mac, please install [Homebrew](https://brew.sh/)   and call ``brew install libomp`` so that the OpenMP libary is available for the model.2. Some of our anomaly detection models depend on the Java Development Kit (JDK). For Ubuntu, call   ``sudo apt-get install openjdk-11-jdk``. For Mac OS, install [Homebrew](&lt;https://brew.sh/&gt;) and call   ``brew tap adoptopenjdk/openjdk &amp;&amp; brew install --cask adoptopenjdk11``. Also ensure that ``java`` can be found   on your ``PATH``, and that the ``JAVA_HOME`` environment variable is set.## DocumentationFor example code and an introduction to Merlion, see the Jupyter notebooks in[`examples`](https://github.com/salesforce/Merlion/tree/main/examples), and the guided walkthrough[here](https://opensource.salesforce.com/Merlion/tutorials.html). You may find detailed API documentation (including theexample code) [here](https://opensource.salesforce.com/Merlion/index.html). The[technical report](https://arxiv.org/abs/2109.09265) outlines Merlion's overall architectureand presents experimental results on time series anomaly detection &amp; forecasting for both univariate and multivariatetime series.## Getting StartedThe easiest way to get started is to use the GUI web-based[dashboard](https://opensource.salesforce.com/Merlion/merlion.dashboard.html).This dashboard provides a great way to quickly experiment with many models on your own custom datasets.To use it, install Merlion with the optional ``dashboard`` dependency (i.e.``pip install salesforce-merlion[dashboard]``), and call ``python -m merlion.dashboard`` from the command line.You can view the dashboard at http://localhost:8050.Below, we show some screenshots of the dashboard for both anomaly detection and forecasting.![anomaly dashboard](https://github.com/salesforce/Merlion/raw/main/figures/dashboard_anomaly.png)![forecast dashboard](https://github.com/salesforce/Merlion/raw/main/figures/dashboard_forecast.png)To help you get started with using Merlion in your own code, we provide below some minimal examples using Merliondefault models for both anomaly detection and forecasting.### Anomaly DetectionHere, we show the code to replicate the results from the anomaly detection dashboard above.We begin by importing Merlion’s `TimeSeries` class and the data loader for the Numenta Anomaly Benchmark `NAB`.We can then divide a specific time series from this dataset into training and testing splits.```pythonfrom merlion.utils import TimeSeriesfrom ts_datasets.anomaly import NAB# Data loader returns pandas DataFrames, which we convert to Merlion TimeSeriestime_series, metadata = NAB(subset=&quot;realKnownCause&quot;)[3]train_data = TimeSeries.from_pd(time_series[metadata.trainval])test_data = TimeSeries.from_pd(time_series[~metadata.trainval])test_labels = TimeSeries.from_pd(metadata.anomaly[~metadata.trainval])```We can then initialize and train Merlion’s `DefaultDetector`, which is an anomaly detection model thatbalances performance with efficiency. We also obtain its predictions on the test split.```pythonfrom merlion.models.defaults import DefaultDetectorConfig, DefaultDetectormodel = DefaultDetector(DefaultDetectorConfig())model.train(train_data=train_data)test_pred = model.get_anomaly_label(time_series=test_data)```Next, we visualize the model's predictions.```pythonfrom merlion.plot import plot_anomsimport matplotlib.pyplot as pltfig, ax = model.plot_anomaly(time_series=test_data)plot_anoms(ax=ax, anomaly_labels=test_labels)plt.show()```![anomaly figure](https://github.com/salesforce/Merlion/raw/main/figures/anom_example.png)Finally, we can quantitatively evaluate the model. The precision and recall come from the fact that the modelfired 3 alarms, with 2 true positives, 1 false negative, and 1 false positive. We also evaluate the mean timethe model took to detect each anomaly that it correctly detected.```pythonfrom merlion.evaluate.anomaly import TSADMetricp = TSADMetric.Precision.value(ground_truth=test_labels, predict=test_pred)r = TSADMetric.Recall.value(ground_truth=test_labels, predict=test_pred)f1 = TSADMetric.F1.value(ground_truth=test_labels, predict=test_pred)mttd = TSADMetric.MeanTimeToDetect.value(ground_truth=test_labels, predict=test_pred)print(f&quot;Precision: {p:.4f}, Recall: {r:.4f}, F1: {f1:.4f}\n&quot;      f&quot;Mean Time To Detect: {mttd}&quot;)``````Precision: 0.6667, Recall: 0.6667, F1: 0.6667Mean Time To Detect: 1 days 10:22:30```### ForecastingHere, we show the code to replicate the results from the forecasting dashboard above.We begin by importing Merlion’s `TimeSeries` class and the data loader for the `M4` dataset. We can then divide aspecific time series from this dataset into training and testing splits.```pythonfrom merlion.utils import TimeSeriesfrom ts_datasets.forecast import M4# Data loader returns pandas DataFrames, which we convert to Merlion TimeSeriestime_series, metadata = M4(subset=&quot;Hourly&quot;)[0]train_data = TimeSeries.from_pd(time_series[metadata.trainval])test_data = TimeSeries.from_pd(time_series[~metadata.trainval])```We can then initialize and train Merlion’s `DefaultForecaster`, which is an forecasting model that balancesperformance with efficiency. We also obtain its predictions on the test split.```pythonfrom merlion.models.defaults import DefaultForecasterConfig, DefaultForecastermodel = DefaultForecaster(DefaultForecasterConfig())model.train(train_data=train_data)test_pred, test_err = model.forecast(time_stamps=test_data.time_stamps)```Next, we visualize the model’s predictions.```pythonimport matplotlib.pyplot as pltfig, ax = model.plot_forecast(time_series=test_data, plot_forecast_uncertainty=True)plt.show()```![forecast figure](https://github.com/salesforce/Merlion/raw/main/figures/forecast_example.png)Finally, we quantitatively evaluate the model. sMAPE measures the error of the prediction on a scale of 0 to 100(lower is better), while MSIS evaluates the quality of the 95% confidence band on a scale of 0 to 100 (lower is better).```python# Evaluate the model's predictions quantitativelyfrom scipy.stats import normfrom merlion.evaluate.forecast import ForecastMetric# Compute the sMAPE of the predictions (0 to 100, smaller is better)smape = ForecastMetric.sMAPE.value(ground_truth=test_data, predict=test_pred)# Compute the MSIS of the model's 95% confidence interval (0 to 100, smaller is better)lb = TimeSeries.from_pd(test_pred.to_pd() + norm.ppf(0.025) * test_err.to_pd().values)ub = TimeSeries.from_pd(test_pred.to_pd() + norm.ppf(0.975) * test_err.to_pd().values)msis = ForecastMetric.MSIS.value(ground_truth=test_data, predict=test_pred,                                 insample=train_data, lb=lb, ub=ub)print(f&quot;sMAPE: {smape:.4f}, MSIS: {msis:.4f}&quot;)``````sMAPE: 4.1944, MSIS: 18.9331```## Evaluation and BenchmarkingOne of Merlion's key features is an evaluation pipeline that simulates the live deploymentof a model on historical data. This enables you to compare models on the datasets relevantto them, under the conditions that they may encounter in a production environment. Ourevaluation pipeline proceeds as follows:1. Train an initial model on recent historical training data (designated as the training split of the time series)1. At a regular interval (e.g. once per day), retrain the entire model on the most recent data. This can be either the   entire history of the time series, or a more limited window (e.g. 4 weeks).1. Obtain the model's predictions (anomaly scores or forecasts) for the time series values that occur between   re-trainings. You may customize whether this should be done in batch (predicting all values at once),   streaming (updating the model's internal state after each data point without fully re-training it),   or some intermediate cadence.1. Compare the model's predictions against the ground truth (labeled anomalies for anomaly detection, or the actual   time series values for forecasting), and report quantitative evaluation metrics.We provide scripts that allow you to use this pipeline to evaluate arbitrary models on arbitrary datasets.For example, invoking```shell scriptpython benchmark_anomaly.py --dataset NAB_realAWSCloudwatch --model IsolationForest --retrain_freq 1d``` will evaluate the anomaly detection performance of the `IsolationForest` (retrained once a day) on the&quot;realAWSCloudwatch&quot; subset of the NAB dataset.  Similarly, invoking```shell scriptpython benchmark_forecast.py --dataset M4_Hourly --model ETS```will evaluate the batch forecasting performance (i.e. no retraining) of `ETS` on the &quot;Hourly&quot; subset of the M4 dataset. You can find the results produced by running these scripts in the Experiments section of the[technical report](https://arxiv.org/abs/2109.09265).## Technical Report and Citing MerlionYou can find more details in our technical report: https://arxiv.org/abs/2109.09265If you're using Merlion in your research or applications, please cite using this BibTeX:```@article{bhatnagar2021merlion,      title={Merlion: A Machine Learning Library for Time Series},      author={Aadyot Bhatnagar and Paul Kassianik and Chenghao Liu and Tian Lan and Wenzhuo Yang              and Rowan Cassius and Doyen Sahoo and Devansh Arpit and Sri Subramanian and Gerald Woo              and Amrita Saha and Arun Kumar Jagota and Gokulakrishnan Gopalakrishnan and Manpreet Singh              and K C Krithika and Sukumar Maddineni and Daeki Cho and Bo Zong and Yingbo Zhou              and Caiming Xiong and Silvio Savarese and Steven Hoi and Huan Wang},      year={2021},      eprint={2109.09265},      archivePrefix={arXiv},      primaryClass={cs.LG}}```</longdescription>
</pkgmetadata>