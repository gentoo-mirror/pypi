<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># Django Okta Auth## OverviewDjango Okta Auth is a library that acts as a client for the Okta OpenID Connect provider.The library provides a set of views for login, logout and callback, an auth backend for authentication, a middleware for token verification in requests, and a decorator that can be selectively applied to individual views.It's heavily influenced by [okta-django-samples](https://github.com/zeekhoo-okta/okta-django-samples) but there's a few fundamental changes and further implementation of things like refresh tokens which weren't initially implemented.This project is in no way affiliated with Okta.## InstallationInstall from PyPI:    pip install django-okta-auth## Configuration### Install the AppAdd `okta_oauth2.apps.OktaOauth2Config` to `INSTALLED_APPS`:```pythonINSTALLED_APPS = (    &quot;...&quot;,    'okta_oauth2.apps.OktaOauth2Config',    &quot;...&quot;)```### Authentication BackendYou will need to install the authentication backend. This extends Django's default `ModelBackend` which uses the configured database for user storage, but overrides the `authenticate` method to accept the `auth_code` returned by Okta's `/authorize` API endpoint [as documented here](https://developer.okta.com/docs/reference/api/oidc/#authorize).The Authentication Backend should be configured as so:```pythonAUTHENTICATION_BACKENDS = (&quot;okta_oauth2.backend.OktaBackend&quot;,)```### Using the middlewareYou can use the middleware to check for valid tokens during ever refresh and automatically refresh tokens when they expire. By using the middleware you are defaulting to requiring authentication on all your views unless they have been marked as public in `PUBLIC_NAMED_URLS` or `PUBLIC_URLS`.The order of middleware is important and the `OktaMiddleware` must be below the `SessionMiddleware` and `AuthenticationMiddleware` to ensure that the session and the user are both on the request:```pythonMIDDLEWARE = (    'django.middleware.security.SecurityMiddleware',    'django.contrib.sessions.middleware.SessionMiddleware',    'django.middleware.common.CommonMiddleware',    'django.middleware.csrf.CsrfViewMiddleware',    'django.contrib.auth.middleware.AuthenticationMiddleware',    'django.contrib.messages.middleware.MessageMiddleware',    'django.middleware.clickjacking.XFrameOptionsMiddleware',    'okta_oauth2.middleware.OktaMiddleware')```### Using the decoratorThe alternative to using the middleware is to selectively apply the `okta_oauth2.decorators.okta_login_required` decorator to views you wish to protect. When the view is accessed the decorator will check that valid tokens exist on the session, and if they don't then it will redirect to the login.The decorator is applied to a view like so:```pythonfrom okta_oauth2.decorators import okta_login_required@okta_login_requireddef decorated_view(request):    return HttpResponse(&quot;i am a protected view&quot;)```### Update urls&lt;span&gt;&lt;/span&gt;.pyAdd the `django-okta-auth` views to your `urls.py`. This will provide the `login`, `logout` and `callback` views which are required by the login flows.```pythonfrom django.urls import include, pathurlpatterns = [    path('accounts/', include((&quot;okta_oauth2.urls&quot;, &quot;okta_oauth2&quot;), namespace=&quot;okta_oauth2&quot;)),]```### Setup your Okta ApplicationIn the Okta admin console create your application with the following steps:1. Click `Create New App`2. Choose the `Web` platform3. Choose the `OpenID Connect` Sign on method4. Click the `Create` button5. Give the application a name and choose a logo if desired6. Add the URL to the login view as defined in the previous section, eg. `http://localhost:8000/accounts/login/`7. Click the `Save` button8. In the General Settings of the application click edit and check `Authorization Code` and the `Refresh Token` under `Allowed grant types`.9. Save the settings10. Take note of the `Client ID` and the `Client secret` in the Client Credentials for use in the next section. It is important to note that the `Client secret` is confidential and under no circumstances should be exposed publicly.### Django Okta SettingsDjango Okta Auth settings should be specified in your django `settings.py` as follows:```pythonOKTA_AUTH = {    &quot;ORG_URL&quot;: &quot;https://your-org.okta.com/&quot;,    &quot;ISSUER&quot;: &quot;https://your-org.okta.com/oauth2/default&quot;,    &quot;CLIENT_ID&quot;: &quot;yourclientid&quot;,    &quot;CLIENT_SECRET&quot;: &quot;yourclientsecret&quot;,    &quot;SCOPES&quot;: &quot;openid profile email offline_access&quot;, # this is the default and can be omitted    &quot;REDIRECT_URI&quot;: &quot;http://localhost:8000/accounts/oauth2/callback&quot;,    &quot;LOGIN_REDIRECT_URL&quot;: &quot;/&quot;, # default    &quot;CACHE_PREFIX&quot;: &quot;okta&quot;, # default    &quot;CACHE_ALIAS&quot;: &quot;default&quot;, # default    &quot;PUBLIC_NAMED_URLS&quot;: (), # default    &quot;PUBLIC_URLS&quot;: (), # default    &quot;USE_USERNAME&quot;: False, # default}```### Login TemplateThe login view will render the `okta_oauth2/login.html` template. It will be passed the following information in the `config` template context variable:```python{    &quot;clientId&quot;: settings.OKTA_AUTH[&quot;CLIENT_ID&quot;],    &quot;url&quot;: settings.OKTA_AUTH[&quot;ORG_URL&quot;],    &quot;redirectUri&quot;: settings.OKTA_AUTH[&quot;REDIRECT_URI&quot;],    &quot;scope&quot;: settings.OKTA_AUTH[&quot;SCOPES&quot;],    &quot;issuer&quot;: settings.OKTA_AUTH[&quot;ISSUER&quot;]}```The easiest way to use this is to implement the [Okta Sign-In Widget](https://developer.okta.com/code/javascript/okta_sign-in_widget/) in your template.A minimal template for the login could be:```html&lt;!DOCTYPE html&gt;&lt;html&gt;  &lt;head&gt;    &lt;meta charset=&quot;utf-8&quot; /&gt;    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot; /&gt;    &lt;script      src=&quot;https://global.oktacdn.com/okta-signin-widget/5.0.1/js/okta-sign-in.min.js&quot;      type=&quot;text/javascript&quot;    &gt;&lt;/script&gt;    &lt;link      href=&quot;https://global.oktacdn.com/okta-signin-widget/5.0.1/css/okta-sign-in.min.css&quot;      type=&quot;text/css&quot;      rel=&quot;stylesheet&quot;    /&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;div id=&quot;okta-login-container&quot;&gt;&lt;/div&gt;    &lt;script type=&quot;text/javascript&quot;&gt;      var oktaSignIn = new OktaSignIn({          baseUrl: '{{config.url}}',          clientId: '{{config.clientId}}',          redirectUri: '{{config.redirectUri}}',          authParams: {              issuer: '{{config.issuer}}',              responseType: ['code'],              scopes: &quot;{{config.scope}}&quot;.split(&quot; &quot;),              pkce: false,          },      });      oktaSignIn.renderEl(          {el: '#okta-login-container'},          function (res) {              console.log(res);          }    &lt;/script&gt;  &lt;/body&gt;&lt;/html&gt;```## Settings Reference**_ORG_URL_**:_str_. URL Okta provides for your organization account. This is the URL that you log in to for the admin panel, minus the `-admin`. eg, if your admin URL is https://myorg-admin.okta.com/ then your `ORG_URL` should be: https://myorg.okta.com/**_ISSUER_**_str_. This is the URL for your Authorization Server. If you're using the default authorization server then this will be: `https://{ORG_URL}/oauth2/default`**_CLIENT_ID_**_str_. The Client ID provided by your Okta Application.**_CLIENT_SECRET_**_str_. The Client Secret provided by your Okta Application.**_SCOPES_**_str_. The scopes requested from the OpenID Authorization server. At the very least this needs to be `&quot;openid profile email&quot;` but if you want to use refresh tokens you will need `&quot;openid profile email offline_access&quot;`. This is the default.If you want Okta to manage your groups then you should also include `groups` in your scopes.**_REDIRECT_URI_**_str_. This is the URL to the `callback` view that the okta Sign-In Widget will redirect the browser to after the username and password have been authorized. If the directions in the `urls.py` section of the documentation were followed and your django server is running on `localhost:8000` then this will be: http://localhost:8000/accounts/callback/**_LOGIN_REDIRECT_URL_**_str_. This is the URL to redirect to from the `callback` after a successful login. Defaults to `/`.**_CACHE_PREFIX_**_str_. The application will utilise the django cache to store public keys requested from Okta in an effort to minimise network round-trips and speed up authorization. This setting will control the prefix for the cache keys. Defaults to `okta`.**_CACHE_ALIAS_**_str_. Specify which django cache should be utilised for storing public keys. Defaults to `default`.**_PUBLIC_NAMED_URLS_**_List[str]_. A list or tuple of URL names that should be accessible without tokens. If you add a URL in this setting the middleware won't check for tokens. Default is: `[]`**_PUBLIC_URLS_**_List[str]_. A list or tuple of URL regular expressions that should be accessible without tokens. If you add a regex in this setting the middleware won't check matching paths for tokens. Default is `[]`.**_SUPERUSER_GROUP_**_str_. Members of this group will have the django `is_superuser` user flags set.**_STAFF_GROUP_**_str_. Members of this group will have the django `is_staff` user flags set.**_MANAGE_GROUPS_**_bool_. If true the authentication backend will manage django groups for you.***USE_USERNAME****bool*. If true the authentication backend will lookup django users by username rather than email.## LicenseMIT LicenseCopyright (c) 2020 Matt MaginPermission is hereby granted, free of charge, to any person obtaining a copyof this software and associated documentation files (the &quot;Software&quot;), to dealin the Software without restriction, including without limitation the rightsto use, copy, modify, merge, publish, distribute, sublicense, and/or sellcopies of the Software, and to permit persons to whom the Software isfurnished to do so, subject to the following conditions:The above copyright notice and this permission notice shall be included in allcopies or substantial portions of the Software.THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS ORIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THEAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHERLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THESOFTWARE.</longdescription>
</pkgmetadata>