<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>&lt;div align=&quot;center&quot;&gt;&lt;img alt=&quot;logo&quot; width=&quot;400&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/Logos/main/logos/falocalrepo-server-transparent.png&quot;&gt;# FALocalRepo-ServerWeb interface for [falocalrepo](https://pypi.org/project/falocalrepo/).[![](https://img.shields.io/github/v/tag/FurryCoders/falocalrepo-server?label=github&amp;sort=date&amp;logo=github&amp;color=blue)](https://github.com/FurryCoders/falocalrepo-server)[![](https://img.shields.io/pypi/v/falocalrepo-server?logo=pypi)](https://pypi.org/project/falocalrepo-server/)[![](https://img.shields.io/pypi/pyversions/falocalrepo-server?logo=Python)](https://www.python.org)[![](https://img.shields.io/badge/Bootstrap-5.2.0-7952B3?logo=bootstrap&amp;logoColor=white)](https://getbootstrap.com)&lt;/div&gt;## Installation &amp; RequirementsTo install the program it is sufficient to use Python pip and get the package `falocalrepo-server`.```shellpip install falocalrepo-server```Python 3.10 or above is needed to run this program, all other dependencies are handled by pip during installation. Forinformation on how to install Python on your computer, refer to the officialwebsite [Python.org](https://www.python.org/).For the program to run, a properly formatted database created by falocalrepo needs to be present in the same folder.The styling is based on the [Boostrap CSS framework](https://getbootstrap.com).## Usage```falocalrepo-server &lt;database&gt; [--host HOST] [--port PORT] [--ssl-cert SSL_CERT] [--ssl-key SSL_KEY]                    [--redirect-http REDIRECT_PORT] [--auth &lt;username&gt;:&lt;password&gt;] [--precache] [--no-browser]```The server needs one argument pointing at the location of a valid [falocalrepo](https://pypi.org/project/falocalrepo/)database and accepts optional arguments to manually set host, port, and an SSL certificate with key. By default, theserver is run on 0.0.0.0:80 for HTTP (without certificate) and 0.0.0.0:443 for HTTPS (with certificate).The `--precache` options can be used to prepare an initial cache of results from the database to speed up searches.When the app has finished loading, it automatically opens a browser window. To avoid this, use the `--no-browser`option.### Redirect ModeThe optional `--redirect-http` argument changes the app mode to redirection. In this mode the app runs a tiny serverthat redirects all HTTP requests it receives on `http://HOST:PORT` to `https://HOST:REDIRECT_PORT`._Note:_ In redirect mode the `database` argument is not checked, so a simple `.` is sufficient.&lt;br/&gt;_Note:_ In redirect mode the app does not operate the database portion of the server. To run in redirect and servermode, two separate instances of the program are needed.Once the server is running the web app can be accessed at the address shown in the terminal.### AuthenticationThe `--auth` option allows setting up a username and password to access the server using the HTTP Basic authenticationprotocol.### Arguments| Argument          | Default                                          ||-------------------|--------------------------------------------------|| `database`        | None, mandatory argument                         || `--host`          | 0.0.0.0                                          || `--port`          | 80 if no SSL certificate is given, 443 otherwise || `--ssl-cert`      | None                                             || `--ssl-key`       | None                                             || `--redirect-http` | None                                             || `--auth`          | None                                             || `--precache`      | False                                            || `--no-browser`    | True                                             |### Examples```shell# Launch an HTTP server reachable from other machines using the server's hostname/IPfalocalrepo-server ~/FA.db``````shell# Launch a localhost-only server on port 8080falocalrepo-server ~/FA.db --host 127.0.0.1 --port 8080``````shell# Launch a redirect server that listens to port 80 and redirects to port 443 on host 0.0.0.0falocalrepo-server . --host 0.0.0.0 --port 80 --redirect-htpp 443``````shell# Launch a server with basic authentication using 'mickey' as username and 'mouse' as passwordfalocalrepo-server ~/FA.db --auth mickey:mouse``````shell# Launch an HTTPS server reachable from other machines using the server's hostname/IPfalocalrepo-server ~/FA.db --ssl-cert ~/FA.certificates/certificate.crt --ssl-key ~/FA.certificates/private.key ``````shell# Launch a localhost-only HTTPS server on port 8443falocalrepo-server ~/FA.db --host 127.0.0.1 --port 8443 --ssl-cert ~/FA.certificates/certificate.crt --ssl-key ~/FA.certificates/private.key ```## Routes_Note:_ All the following paths are meant as paths from `&lt;host&gt;:&lt;port&gt;`.| Route                                          | Destination                                                                             ||------------------------------------------------|-----------------------------------------------------------------------------------------|| `/`                                            | Show home page with general information regarding the database                          || `/search/`                                     | Redirects to `/search/submissions/`                                                     || `/search/submissions/`                         | Search &amp; browse submissions                                                             || `/search/journals/`                            | Search &amp; browse journals                                                                || `/search/users/`                               | Search &amp; browse users                                                                   || `/settings/`                                   | Change default search settings                                                          || `/user/&lt;username&gt;/`                            | Show information regarding a specific user                                              || `/user/&lt;username&gt;/icon/`                       | Redirect to username's icon on Fur Affinity                                             || `/user/&lt;username&gt;/thumbnail/`                  | Redirect to username's icon on Fur Affinity                                             || `/gallery/&lt;username&gt;/`                         | Browse &amp; search a user's gallery submissions                                            || `/scraps/&lt;username&gt;/`                          | Browse &amp; search a user's scraps submissions                                             || `/submissions/&lt;username&gt;/`                     | Browse &amp; search a user's gallery &amp; scraps submissions                                   | | `/favorites/&lt;username&gt;/`                       | Browse &amp; search a user's favorite submissions                                           || `/mentions/&lt;username&gt;/`                        | Browse &amp; search the submissions where the user is mentioned                             || `/journals/&lt;username&gt;/`                        | Browse &amp; search a user's journals                                                       || `/full/&lt;submission id&gt;/`                       | Redirect to `/submission/&lt;submission id&gt;/`                                              || `/view/&lt;submission id&gt;/`                       | Redirect to `/submission/&lt;submission id&gt;/`                                              || `/submission/&lt;submission id&gt;/`                 | View a submission                                                                       || `/submission/&lt;submission id&gt;/file/`            | Open the first submission file                                                          || `/submission/&lt;submission id&gt;/file/&lt;n&gt;/`        | Open the nth first submission file                                                      || `/submission/&lt;submission id&gt;/files/`           | Download all the submission files as a zip                                              || `/submission/&lt;submission id&gt;/files/&lt;n1&gt;-&lt;n2&gt;/` | Download submissions files from index n1 to index n2 (0 indexed inclusive)              || `/submission/&lt;submission id&gt;/thumbnail/`       | Open a submission thumbnail (generated for image submissions if no thumbnail is stored) || `/submission/&lt;submission id&gt;/zip/`             | Download a submission's file, description, and metadata as a ZIP archive                || `/journal/&lt;journal id&gt;/`                       | View a journal                                                                          || `/journal/&lt;journal id&gt;/zip/`                   | Download a journal's content and metadata as a ZIP archive                              |### JSON API RoutesThe following routes return information as JSON responses. They can be reached with `GET` and `POST` requests, theformer supports sending body fields as URL parameters.| Route                              | Destination                                                                                                                                                     | Body                                                                                 ||------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|| `/json/search/&lt;table&gt;/`            | Perform a search on the database. The query field in the body uses the same [syntax](#query-language) as the query field in the [search page](#browse--search). | `{query?: str, offset?: int, limit?: int, sort?: str, order?: Union[&quot;asc&quot;, &quot;desc&quot;]}` || `/json/user/&lt;username&gt;`            | Get user metadata and total submissions/journals                                                                                                                | None                                                                                 || `/json/submission/&lt;submission id&gt;` | Get submission metadata and comments                                                                                                                            | None                                                                                 || `/json/journal/&lt;journal id&gt;`       | Get journal metadata and comments                                                                                                                               | None                                                                                 |## Pages_Note:_ the images used in the following sections were taken using light mode, but all pages also support dark mode.### HomeThe home page displays general information about the database and contains links to browse and search pages for thevarious tables.The information table displays the total number of submissions, journals, and users together with the version of thedatabase. Clicking on any of the counters open the relevant search &amp; browse page.### Browse &amp; SearchThe browse and search pages allow to explore the submissions/journals contained in the database. Searches are performedcase-insensitively using a simple syntax in the form `@field term [[| &amp;] term ...]` which allows logic operators,parentheses and start/end of field matching, see [Query Language](#query-language) for details.Search terms for submissions and journals default to the `any` field if none is used, while the `username` field is usedfor users searches.The controls at the top of the page allow to query the database and control the visualisation of the results.&lt;div align=&quot;center&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/search-form.png&quot; width=&quot;600&quot;&gt;&lt;/div&gt;The _Search_ input allows to insert the search query.The _Field_ menu allows to insert a specific search field using a simple dropdown menu.The _Sort_ and adjacent order menus change the sorting field and order of the search results. Submissions and journalsdefault to descending ID, while users default to ascending username.The _View_ menu allows changing between the (default) grid view to a list (table) viewThe _Search_ button submits the search request using the current query and sorting settings.The _Browse_ button resets the current search query and reverts to browse mode (all entries).The _FA_ button opens the current search on Fur Affinity, translating the shared search and sorting fields (tags,author, description, and fileurl/fileext). The button is only available when searching submissions.The gear button opens the search settings, the question mark button shows a quick help about the query language.Under the search controls are the number of results and current page.&lt;div align=&quot;center&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/search-nav.png&quot; width=&quot;400&quot;&gt;&lt;/div&gt;Under the results numbers are the page controls. _First_ leads to page 1, _Prev_ leads to the previous page, _Next_leads to the next page, and _Last_ leads to the last page. These controls are also available at the bottom of the page.In grid view, the results are presented using cards containing the same information as the list view, with the additionof thumbnails for submissions. When searching for submissions or journals, clicking on the card footer (containing thedate and author) will open the author's page. Submissions with more than one file will display a small counter with thenumber of files in the upper right corner of the card.&lt;div align=&quot;center&quot;&gt;&lt;img src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/search-card.png&quot; width=&quot;200&quot;&gt;&lt;/div&gt;In list view, the results are presented in a table with the most important columns: ID, AUTHOR, DATE, and TITLE (submissions and journals); USERNAME, FOLDERS, and ACTIVE (users). On small screens some of these columns are shortenedor removed.&lt;div align=&quot;center&quot;&gt;&lt;img src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/search-list.png&quot; width=&quot;800&quot;&gt;&lt;/div&gt;#### Compatibility with Fur Affinity SearchMost Fur Affinity search queries (and links) are fully compatible with the program.Except for the _NOT_ (!) operator, which follows different syntax rules, all Fur Affinity search fields are fullysupported: `@lower` (treated as `@author`), `@keywords` (treated as `@tags`), `@message` (treated as `@description`), `@title` (treated as `@title`), `@filename` (treated as `@fileurl`).#### Query LanguageThe query language used for this server is based on and improves the search syntax currently used by the Fur Affinitywebsite. Its basic elements are:* `@&lt;field&gt;` field specifier (e.g. `@title`), all database columns are available as search fields.  See [falocalrepo-database](https://pypi.org/project/falocalrepo-database/) for details on the available columns.* `()` parentheses, they can be used for better logic operations* `&amp;` _AND_ logic operator, used between search terms* `|` _OR_ logic operator, used between search terms* `!` _NOT_ logic operator, used as prefix of search terms* `&quot;&quot;` quotes, allow searching for literal strings without needing to escape* `%` match 0 or more characters* `_` match exactly 1 character* `^` start of field, when used at the start of a search term, it matches the beginning of the field* `$` end of field, when used at the end of a search term, it matches the end of the fieldAll other strings are considered search terms.The search uses the `@any` field by default for submissions and journals, allowing to do general searches withoutspecifying a field. The `@any` field does not include the `FAVORITE`, `FILESAVED`, `USERUPDATE`, and `ACTIVE` fields andmust be searched manually using the respective query fields. When searching users, `@username` is the default field.Search terms that are not separated by a logic operator are considered _AND_ terms (i.e. `a b c` -&gt; `a &amp; b &amp; c`).Except for the `ID`, `FILESAVED`, `USERUPDATE`, and `ACTIVE` fields, all search terms are searched through thewhole content of the various fields: i.e. `@description cat` will match any item whose description field contains &quot;cat&quot;.To match items that contain only &quot;cat&quot; (or start with, end with, etc.), the `%`, `_`, `^`, and `$` operators need to beused (e.g. `@description ^cat`).Search terms for `ID`, `FILESAVED`, `USERUPDATE`, and `ACTIVE` are matched exactly as they are: i.e. `@id 1` will matchonly items whose ID field is exactly equal to &quot;1&quot;, to match items that contain &quot;1&quot; the `%`, `_`, `^`, or `$` operatorsneed to be used (e.g. `@id %1%`).##### ExamplesSearch for journals/submissions containing water and either otter, lutrine, or mustelid, or water and either cat orfeline:`water ((otter | lutrine | mustelid) | (cat | feline))``@any water &amp; ((otter | lutrine | mustelid) | (cat | feline))`Search for journals/submissions containing &quot;cat&quot; or &quot;feline&quot; but neither &quot;mouse&quot; nor &quot;rodent&quot;:`(cat | feline) !mouse !rodent`Search for general-rated submissions uploaded by a user whose name starts with &quot;tom&quot; that contain either &quot;volleyball&quot;or &quot;volley&quot; and &quot;ball&quot; separated by one character (e.g. &quot;volley-ball&quot;) in any field:`@rating general @author tom% @any (volleyball | volley_ball)``(volleyball | volley_ball) @rating general @author tom%`Search for journals/submissions uploaded in 2020 except for March:`@date ^2020 !^2020-03`Search for submissions uploaded in March 2021 (meaning the date has to start with `2021-03`) whose tags contain theexact tag &quot;ball&quot;:`@date ^2021-03 @tags &quot;|ball|&quot;``@date ^2021-03 @tags \|ball\|`Search for journals/submissions where a specific user named &quot;tom&quot; is mentioned:`@mentions &quot;|tom|&quot;``@mentions \|tom\|`Search for submissions whose only favorite is a user named &quot;alex&quot;:`@favorite ^\|alex\|$`Search for users whose names contain &quot;mark&quot;:`@username %mark%`Search for journals/submissions whose title ends with &quot;100%&quot;:`@title 100\%$`Search for journals/submissions whose title is exactly &quot;cat&quot;:`@title ^cat$`Search for text submissions with PDF files:`@type text @fileext pdf`### Search SettingsThe search settings page allows modifying the sorting, ordering, and viewing option that are applied by default to thevarious searches. Settings can be saved to the database if it is writable, otherwise they are simply saved for thecurrent session and reset when the program stops.Settings values are saved in the `SETTINGS` table with the `SERVER.SEARCH` setting name.### UserThe user page shows information about submissions and journals related to a user (gallery, scraps, favorites, mentions,and journals) and what folders have been set for download. See [falocalrepo](https://pypi.org/project/falocalrepo/) formore details on this. The user's profile will be displayed if present in the database.Clicking on any of the counters opens the relevant results via the search interface, allowing to refine the searchfurther.The _Next_ and _Prev_ buttons move to the respective users in ascending alphabetical order.### SubmissionThe submission page shows the submission file(s) (if present), the submission metadata, and the description.Image, audio, video, and plain text submission files are displayed directly in the page, others (e.g. PDF files) willdisplay a link to open them. Clicking on image files will enlarge them to fill the width of the screen for easierviewing. Video files can be enlarged by using the zoom button under them.When a submission has two or more files, a toolbar appears below the file section with buttons to switch between thedifferent files, show the files in a grid view, and enlarge non-image files (text, video, etc.).&lt;div align=&quot;center&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/buttons-file-switcher.png&quot; width=&quot;200&quot;&gt;&lt;/div&gt;The metadata table contains clickable links to the user's page (see [User](#user) for details), tags, category, species,gender, rating, folder (gallery/scraps), and to user pages of favouring and mentioned users.The description is displayed as-is except for user icons, which are replaced by `@username` styled links to avoiddisplay errors caused by expired icon links.Under the metadata table are a number of buttons that allow to access the submission file, open its Fur Affinitycounterpart, and navigate the other submissions from the author.&lt;div align=&quot;center&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/buttons-submission.png&quot; width=&quot;400&quot;&gt;&lt;/div&gt;The download _File_ button downloads the submission file (if present). If more than one file is present, then the buttondownloads a zip file containing all submission files.The download _ZIP_ button generates a ZIP file containing the submission file, submission thumbnail, description HTML,and metadata and comments in JSON format.The _FA_ button opens the submission on Fur AffinityThe _Next_ and _Prev_ buttons lead to the next more recent and the previous less recent submissions respectively.The _Gallery_, _All_, and _Scraps_ buttons open a search page with the user's gallery submissions, scraps and gallerysubmissions together, and scraps submissions respectively.To view the currently selected submission file when scrolling down the page, the button in the lower right corner can beused to open the image in a floating overlay that will remain at the top of the page view.&lt;img alt=&quot;&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/buttons-submission-overlay.png&quot; width=&quot;50&quot;&gt;The comments to the submission can be found below the description, and can be reached quickly by clicking on thefloating comments button that appears in the lower right corner of the screen if the submission has comments.&lt;img alt=&quot;&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/buttons-comments-link.png&quot; width=&quot;50&quot;&gt;Each comment contains the author (with a link to their user page), post date, and links to the comment itself and, ifthe comment is a reply, its parent comments.&lt;div align=&quot;center&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/comment-card.png&quot; width=&quot;400&quot;&gt;&lt;/div&gt;The button furthest to the left (arrow pointing up and to the left) links to the first comment in a reply chain. Themiddle button (bent arrow pointing to the left) links to the previous comment in the reply chain. The link buttonfurthest to the right is a link to that specific comment.### JournalThe journal page shows the journal metadata and content.The metadata table contains clickable links to the user's page (see [User](#user) for details) and to user pages ofmentioned users.Under the metadata table are a number of buttons that allow to download the journal, open its Fur Affinity counterpart,and navigate the other journals from the same user.&lt;div align=&quot;center&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/buttons-journal.png&quot; width=&quot;400&quot;&gt;&lt;/div&gt;The download _ZIP_ button generates a ZIP file containing the journal content HTML and metadata and comments in JSONformat.The _FA_ button opens the journal on Fur AffinityThe _Next_ and _Prev_ buttons lead to the next more recent, and the previous less recent journals respectively.The _All_ button opens a search page with all the user's journals.The comments to the journal can be found below the journal text, and can be reached quickly by clicking on the floatingcomments button that appears in the lower right corner of the screen if the journal has comments.&lt;img alt=&quot;&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/buttons-comments-link.png&quot; width=&quot;50&quot;&gt;Each comment contains the author (with a link to their user page), post date, and links to the comment itself and, ifthe comment is a reply, its parent comments.&lt;div align=&quot;center&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/comment-card.png&quot; width=&quot;400&quot;&gt;&lt;/div&gt;The button furthest to the left (arrow pointing up and to the left) links to the first comment in a reply chain. Themiddle button (bent arrow pointing to the left) links to the previous comment in the reply chain. The link buttonfurthest to the right is a link to that specific comment.### BBCodeWhen the database is in BBCode mode a new buttons appears along submission descriptions, journal contents, and userprofiles to switch between the rendered HTML and the BBCode stored in the database.&lt;div align=&quot;center&quot;&gt;&lt;img alt=&quot;&quot; src=&quot;https://raw.githubusercontent.com/FurryCoders/falocalrepo-server/master/doc/buttons-bbcode.png&quot; width=&quot;120&quot;&gt;&lt;/div&gt;_Note:_ the BBCode to HTML conversion is still a work in progress and some content may be rendered incorrectly; pleaseopenan [issue](https://github.com/FurryCoders/falocalrepo-server/issues) if you encounter any error :)</longdescription>
</pkgmetadata>