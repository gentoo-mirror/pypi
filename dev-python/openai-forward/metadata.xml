<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>**English** | [**简体中文**](./README_ZH.md)&lt;h1 align=&quot;center&quot;&gt;    &lt;br&gt;    OpenAI Forward    &lt;br&gt;&lt;/h1&gt;&lt;div align=center&gt;&lt;img src=https://github.com/KenyonY/openai-forward/blob/main/.github/data/logo.png?raw=true width=&quot;240px&quot;&gt;&lt;/div&gt;&lt;p align=&quot;center&quot;&gt;    &lt;a href=&quot;https://pypi.org/project/openai-forward/&quot;&gt;        &lt;img src=&quot;https://img.shields.io/pypi/v/openai-forward?color=brightgreen&amp;style=flat-square&quot; alt=&quot;PyPI version&quot; &gt;    &lt;/a&gt;    &lt;a href=&quot;https://github.com/KenyonY/openai-forward/blob/main/LICENSE&quot;&gt;        &lt;img alt=&quot;License&quot; src=&quot;https://img.shields.io/github/license/KenyonY/openai-forward.svg?color=blue&amp;style=flat-square&quot;&gt;    &lt;/a&gt;    &lt;a href=&quot;https://github.com/KenyonY/openai-forward/releases&quot;&gt;        &lt;img alt=&quot;Release (latest by date)&quot; src=&quot;https://img.shields.io/github/v/release/KenyonY/openai-forward?&amp;style=flat-square&quot;&gt;    &lt;/a&gt;    &lt;a href=&quot;https://hub.docker.com/r/beidongjiedeguang/openai-forward&quot;&gt;        &lt;img alt=&quot;docker image size&quot; src=&quot;https://img.shields.io/docker/image-size/beidongjiedeguang/openai-forward?style=flat-square&amp;label=docker image&quot;&gt;    &lt;/a&gt;    &lt;a href=&quot;https://github.com/KenyonY/openai-forward/actions/workflows/ci.yml&quot;&gt;        &lt;img alt=&quot;tests&quot; src=&quot;https://img.shields.io/github/actions/workflow/status/KenyonY/openai-forward/ci.yml?style=flat-square&amp;label=tests&quot;&gt;    &lt;/a&gt;    &lt;a href=&quot;https://pypistats.org/packages/openai-forward&quot;&gt;        &lt;img alt=&quot;pypi downloads&quot; src=&quot;https://img.shields.io/pypi/dm/openai_forward?style=flat-square&quot;&gt;    &lt;/a&gt;&lt;/p&gt;&lt;div align=&quot;center&quot;&gt;[![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy?repo=https://github.com/KenyonY/openai-forward)[Features](#Key-Features) |[Deployment Guide](deploy_en.md) |[User Guide](#User-Guide) |[Configuration](#Configuration) |[Conversation Logs](#Conversation-Logs)&lt;/div&gt;---**OpenAI-Forward** is an efficient forwarding service designed for large language models. Its core features include user request rate control, Token rate limits, intelligent prediction caching, log management, and API key management, aiming to provide a fast and convenient model forwarding service. Whether proxying local language models or cloud-based language models,such as [LocalAI](https://github.com/go-skynet/LocalAI) or [OpenAI](https://api.openai.com),OpenAI Forward facilitates easy implementation. With the support of libraries like [uvicorn](https://github.com/encode/uvicorn), [aiohttp](https://github.com/aio-libs/aiohttp), and [asyncio](https://docs.python.org/3/library/asyncio.html), OpenAI-Forward achieves impressive asynchronous performance.&lt;a&gt;   &lt;img src=&quot;https://raw.githubusercontent.com/KenyonY/openai-forward/main/.github/images/separators/aqua.png&quot; height=8px width=&quot;100%&quot;&gt;&lt;/a&gt;## Key FeaturesOpenAI-Forward offers the following capabilities:- **Universal Forwarding**: Supports forwarding of almost all types of requests.- **Performance First**: Boasts outstanding asynchronous performance.- **Cache AI Predictions**: Caches AI predictions, accelerating service access and saving costs.- **User Traffic Control**: Customize request and Token rates.- **Real-time Response Logs**: Enhances observability of the call chain.- **Custom Secret Keys**: Replaces the original API keys.- **Multi-target Routing**: Forwards to multiple service addresses under a single service to different routes.- **Automatic Retries**: Ensures service stability; will automatically retry on failed requests.- **Quick Deployment**: Supports fast deployment locally or on the cloud via pip and docker.**Proxy services set up by this project include**:- Original OpenAI Service Address:  &gt; https://api.openai-forward.com    &gt; https://render.openai-forward.com- Cached Service Address (User request results will be saved for some time):  &gt; https://smart.openai-forward.com&lt;sub&gt;Note: The proxy services deployed here are for personal learning and research purposes only and should not be used for any commercial purposes.&lt;/sub&gt;---## Deployment Guide👉 [Deployment Documentation](deploy_en.md)&lt;a&gt;&lt;img src=&quot;https://raw.githubusercontent.com/KenyonY/openai-forward/main/.github/images/separators/aqua.png&quot; height=8px width=&quot;100%&quot;&gt;&lt;/a&gt;## User Guide### Quick Start**Installation**```bashpip install openai-forward```**Starting the Service**```bashaifd run```If the configuration from the `.env` file at the root path is read, you will see the following startup information.```bash❯ aifd run╭────── 🤗 openai-forward is ready to serve!  ───────╮│                                                    ││  base url         https://api.openai.com           ││  route prefix     /                                ││  api keys         False                            ││  forward keys     False                            ││  cache_backend    MEMORY                           │╰────────────────────────────────────────────────────╯╭──────────── ⏱️ Rate Limit configuration ───────────╮│                                                    ││  backend                memory                     ││  strategy               moving-window              ││  global rate limit      100/minute (req)           ││  /v1/chat/completions   100/2minutes (req)         ││  /v1/completions        60/minute;600/hour (req)   ││  /v1/chat/completions   60/second (token)          ││  /v1/completions        60/second (token)          │╰────────────────────────────────────────────────────╯INFO:     Started server process [191471]INFO:     Waiting for application startup.INFO:     Application startup complete.INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)```---### Proxy OpenAI Model:The default option for `aifd run` is to proxy `https://api.openai.com`.The following uses the set up service address `https://api.openai-forward.com` as an example.&lt;details&gt;   &lt;summary&gt;Click to expand&lt;/summary&gt;#### Use in Third-party ApplicationsIntegrate within the open-source project [ChatGPT-Next-Web](https://github.com/Yidadaa/ChatGPT-Next-Web):Replace the `BASE_URL` in the Docker startup command with the address of your self-hosted proxy service.```bash docker run -d \    -p 3000:3000 \    -e OPENAI_API_KEY=&quot;sk-******&quot; \    -e BASE_URL=&quot;https://api.openai-forward.com&quot; \    -e CODE=&quot;******&quot; \    yidadaa/chatgpt-next-web ``` #### Integrate within Code---**Python**```diff  import openai+ openai.api_base = &quot;https://api.openai-forward.com/v1&quot;  openai.api_key = &quot;sk-******&quot;```**JS/TS**```diff  import { Configuration } from &quot;openai&quot;;    const configuration = new Configuration({+ basePath: &quot;https://api.openai-forward.com/v1&quot;,  apiKey: &quot;sk-******&quot;,  });```**gpt-3.5-turbo**```bashcurl https://api.openai-forward.com/v1/chat/completions \  -H &quot;Content-Type: application/json&quot; \  -H &quot;Authorization: Bearer sk-******&quot; \  -d '{    &quot;model&quot;: &quot;gpt-3.5-turbo&quot;,    &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Hello!&quot;}]  }'```**Image Generation (DALL-E)**```bashcurl --location 'https://api.openai-forward.com/v1/images/generations' \--header 'Authorization: Bearer sk-******' \--header 'Content-Type: application/json' \--data '{    &quot;prompt&quot;: &quot;A photo of a cat&quot;,    &quot;n&quot;: 1,    &quot;size&quot;: &quot;512x512&quot;}'```&lt;/details&gt;---### Proxy Local Model- **Applicable scenarios:** To be used in conjunction with projects such as [LocalAI](https://github.com/go-skynet/LocalAI) and [api-for-open-llm](https://github.com/xusenlinzy/api-for-open-llm).- **How to operate:**   Using LocalAI as an example, if the LocalAI service has been deployed at http://localhost:8080, you only need to set `OPENAI_BASE_URL=http://localhost:8080` in the environment variable or in the .env file.  After that, you can access LocalAI through http://localhost:8000.(More)### Proxy Other Cloud Models- **Applicable scenarios:**   For instance, through [LiteLLM](https://github.com/BerriAI/litellm), you can convert the API format of many cloud models to the OpenAI API format and then use this service as a proxy.(More)&lt;a&gt;   &lt;img src=&quot;https://raw.githubusercontent.com/KenyonY/openai-forward/main/.github/images/separators/aqua.png&quot; height=8px width=&quot;100%&quot;&gt;&lt;/a&gt;## Configuration### Command Line ArgumentsExecute `aifd run --help` to get details on arguments.&lt;details open&gt;  &lt;summary&gt;Click for more details&lt;/summary&gt;| Configuration | Description | Default Value ||---------------|-------------|:-------------:|| --port       | Service port | 8000         || --workers    | Number of working processes | 1 |&lt;/details&gt;### Environment Variable DetailsYou can create a .env file in the project's run directory to customize configurations. For a reference configuration, see the [.env.example](.env.example) file in the root directory.| Environment Variable  | Description                                                                                      | Default Value                 ||-----------------------|-------------------------------------------------------------------------------------------------|:-----------------------------:|| OPENAI_BASE_URL       | Set base address for OpenAI-style API                                                            | https://api.openai.com        || OPENAI_ROUTE_PREFIX   | Define a route prefix for the OPENAI_BASE_URL interface address                                 | /                             || OPENAI_API_KEY        | Configure API key in OpenAI style, supports using multiple keys separated by commas              | None                          || FORWARD_KEY           | Set a custom key for proxying, multiple keys can be separated by commas. If not set (not recommended), it will directly use `OPENAI_API_KEY` | None || EXTRA_BASE_URL        | Configure the base URL for additional proxy services                                             | None                          || EXTRA_ROUTE_PREFIX    | Define the route prefix for additional proxy services                                           | None                          || REQ_RATE_LIMIT        | Set the user request rate limit for specific routes (user distinguished)                         | None                          || GLOBAL_RATE_LIMIT     | Configure a global request rate limit applicable to routes not specified in `REQ_RATE_LIMIT`    | None                          || RATE_LIMIT_STRATEGY   | Choose a rate limit strategy, options include: fixed-window, fixed-window-elastic-expiry, moving-window | None || TOKEN_RATE_LIMIT      | Limit the output rate of each token (or SSE chunk) in a streaming response                      | None                          || PROXY                 | Set HTTP proxy address                                                                           | None                          || LOG_CHAT              | Toggle chat content logging for debugging and monitoring                                        | `false`                       || CACHE_BACKEND         | Cache backend, supports memory backend and database backend. By default, it's memory backend, optional database backends are lmdb, rocksdb, and leveldb | `MEMORY` || CACHE_CHAT_COMPLETION | Whether to cache /v1/chat/completions results                                                    | `false`                       |Detailed configuration descriptions can be seen in the [.env.example](.env.example) file. (To be completed)&gt; Note: If you set OPENAI_API_KEY but did not set FORWARD_KEY, clients will not need to provide a key when calling. As this may pose a security risk, it's not recommended to leave FORWARD_KEY unset unless there's a specific need.### CachingBy default, caching uses a memory backend. You can choose a database backend but need to install the corresponding environment:```bashpip install openai-forward[lmdb] # lmdb backendpip install openai-forward[leveldb] # leveldb backendpip install openai-forward[rocksdb] # rocksdb backend```- Configure `CACHE_BACKEND` in the environment variable to use the respective database backend for storage. Options are `MEMORY`, `LMDB`, `ROCKSDB`, and `LEVELDB`.- Set `CACHE_CHAT_COMPLETION` to `true` to cache /v1/chat/completions results.```diff  import openai  openai.api_base = &quot;https://smart.openai-forward.com/v1&quot;  openai.api_key = &quot;sk-******&quot;  completion = openai.ChatCompletion.create(+   caching=False, # Cache by default, can be set to not cache    model=&quot;gpt-3.5-turbo&quot;,    messages=[      {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Hello!&quot;}    ])```### Custom Keys&lt;details open&gt;  &lt;summary&gt;Click for more details&lt;/summary&gt;Configure OPENAI_API_KEY and FORWARD_KEY, for example:```bashOPENAI_API_KEY=sk-*******FORWARD_KEY=fk-****** # Here, the fk-token is customized```**Use case:**```diff  import openai+ openai.api_base = &quot;https://api.openai-forward.com/v1&quot;- openai.api_key = &quot;sk-******&quot;+ openai.api_key = &quot;fk-******&quot;```&lt;/details&gt;### Multi-Target Service ForwardingSupports forwarding services from different addresses to different routes under the same port. Refer to the `.env.example` for examples.### Conversation LogsChat logs are not recorded by default. If you wish to enable it, set the `LOG_CHAT=true` environment variable.&lt;details open&gt;  &lt;summary&gt;Click for more details&lt;/summary&gt;Logs are saved in the current directory under `Log/openai/chat/chat.log`. The recording format is:```text{'messages': [{'role': 'user', 'content': 'hi'}], 'model': 'gpt-3.5-turbo', 'stream': True, 'max_tokens': None, 'n': 1, 'temperature': 1, 'top_p': 1, 'logit_bias': None, 'frequency_penalty': 0, 'presence_penalty': 0, 'stop': None, 'user': None, 'ip': '127.0.0.1', 'uid': '2155fe1580e6aed626aa1ad74c1ce54e', 'datetime': '2023-10-17 15:27:12'}{'assistant': 'Hello! How can I assist you today?', 'is_function_call': False, 'uid': '2155fe1580e6aed626aa1ad74c1ce54e'}```To convert to `json` format:```bashaifd convert```You'll get `chat_openai.json`:```json[  {    &quot;datetime&quot;: &quot;2023-10-17 15:27:12&quot;,    &quot;ip&quot;: &quot;127.0.0.1&quot;,    &quot;model&quot;: &quot;gpt-3.5-turbo&quot;,    &quot;temperature&quot;: 1,    &quot;messages&quot;: [      {        &quot;user&quot;: &quot;hi&quot;      }    ],    &quot;functions&quot;: null,    &quot;is_function_call&quot;: false,    &quot;assistant&quot;: &quot;Hello! How can I assist you today?&quot;  }]```&lt;/details&gt;## Backer and Sponsor&lt;a href=&quot;https://www.jetbrains.com/?from=KenyonY/openai-forward&quot; target=&quot;_blank&quot;&gt;&lt;img src=&quot;https://raw.githubusercontent.com/KenyonY/openai-forward/e7da8de4a48611b84430ca3ea44d355578134b85/.github/images/jetbrains.svg&quot; width=&quot;100px&quot; height=&quot;100px&quot;&gt;&lt;/a&gt;## LicenseOpenAI-Forward is licensed under the [MIT](https://opensource.org/license/mit/) license.</longdescription>
</pkgmetadata>