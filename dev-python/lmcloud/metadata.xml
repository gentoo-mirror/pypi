<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># La Marzocco REST APIThis is a library to interface with La Marzocco's Home machine REST APIs.It's in experimentals stages and meant mainly to connect to the Micra, as for the other IoT enabled machines you can use the [lmdirect](https://github.com/rccoleman/lmdirect) library.# Libraries in this project- `lmlocalapi` calls the new local API the Micra exposes, using the Bearer token from the customer cloud endpoint. However, this API currently only supports getting the config, and some status objects (like shottimer) over websockets, but does not support setting anything (to my knowledge). Local settings appear to only happen through Bluetooth connections. If La Marzocco updates the firmware or more endpoints are found this library will be updated to reflect those additional endpoints.- `lmcloud` interacts with `gw.lamarzocco.com` to send commands. lmcloud can be initialized to only issue remote commands, or to initialize an instance of `lmlocalapi` for getting the current machine settings. This helps to avoid flooding the cloud API and is faster overall.Because of that reason the config object `self._config` in the lmcloud instance without utilizing the local API will always at least be 10 seconds old. This is to avoid automatic property checks (e.g. from HomeAssistant) to spam the cloud API. If you really require a most recent config you can call the method `get_config()`.# Setup## lmcloudTo run `lmcloud` you will first need to create a dict, containing `clientId`, `clientSecret`, `username` and `password`.`username` and `password` are easy to get because those are the credentials you're using to sign into the La Marzocco Home app.`clientId` and `clientSecret` are harder to get. The &quot;easiest&quot; way is to configure `mitmproxy` on a PC, configure your WiFi settings on your phone to use that proxy. Then log out of your La Marzocco App, sign in again and watch for a call to `https://cms.lamarzocco.io/oauth/v2/token`. The  credentials you're looking for will be in that call.More of the calls are documented in [remote_rest](docs/remote_rest.md).You then need to create a file called `config.json` looking like this:```json{    &quot;client_id&quot;: &quot;long_string&quot;,    &quot;client_secret&quot;: &quot;long_string&quot;,    &quot;username&quot;: &quot;email&quot;,    &quot;password&quot;: &quot;password&quot;,    &quot;host&quot;: &quot;192.168.1.123&quot; # optional, only if you want the local API}```Which then needs to be passed into a dictionary:```pythonwith open(&quot;config.json&quot;) as f:    data = json.load(f)creds = {    &quot;client_id&quot;: data[&quot;client_id&quot;],    &quot;client_secret&quot;: data[&quot;client_secret&quot;],    &quot;username&quot;: data[&quot;username&quot;],    &quot;password&quot;: data[&quot;password&quot;]}````lmcloud` exposes two classmethods: One to build an instance with the local API, and one to build an instance relying entirely on cloud functions. It is initialized like this```pythonlm_cloud = await LMCloud.create(creds) # cloud onlylm_cloud = await LMCloud.create_with_local_api(creds, ip=ip) # with local API```## lmlocalapiIf you just want to run the local API you need the IP of your machine, the Port it is listening on (8081 by default), the Bearer token (`communicationKey`) used for local communication. You can obtain that key by inspecting a call to `https://cms.lamarzocco.io/api/customer`, while connected to `mitmproxy` (process above), or making a new (authenticated) call to that endpoint. `lmcloud` will also connect to this endpoint so you could also used a breakpoint there to get this key, which is stored in a key called `communicationKey`.Then you can init the class with ```pythonlm_local_api = LMLocalAPI(ip, bearer)```### WebsocketsThe local API initiates a websocket connection to```http://{IP}:8081/api/v1/streaming```The packets which are received on that WebSocket are documented in [websockets](docs/websockets.md)</longdescription>
</pkgmetadata>