<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># PYSCEMU## Install```bashpip install --upgrade pippip3 install --upgrade pipcurl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | shpip install pyscemupip3 install pyscemu```## Mac Installsame procedure, if there is a problem with !tapi-tbd the solution is:```bashsudo xcode-select --switch /Library/Developer/CommandLineTools```## Download mapsdownload maps32 from releases or maps64 better from git:https://github.com/sha0coder/scemureleases:https://github.com/sha0coder/scemu/releases/download/maps/maps32.ziphttps://github.com/sha0coder/scemu/releases/download/maps/maps64.zip## Exampleshttps://github.com/sha0coder/pyscemu/tree/main/examples## Documentationhttps://github.com/sha0coder/pyscemu/blob/main/DOCUMENTATION.md## Usage### Fully emulation of a shellcode```python~ ❯❯❯ python3Python 3.9.2 (default, Feb 28 2021, 17:03:44) [GCC 10.2.1 20210110] on linuxType &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.&gt;&gt;&gt; import pyscemu&gt;&gt;&gt; emu = pyscemu.init32()&gt;&gt;&gt; emu.load_maps('/home/sha0/src/scemu/maps32/')initializing regsloading memory mapsLoaded nsi.dll4 sections  base addr 0x776c0000created pe32 map for section `.text` at 0x776c1000 size: 5624created pe32 map for section `.data` at 0x776c3000 size: 16created pe32 map for section `.rsrc` at 0x776c4000 size: 1008/!\ warning: raw sz:8704 off:8192 sz:512  off+sz:8704created pe32 map for section `.reloc` at 0x776c5000 size: 88&gt;&gt;&gt; &gt;&gt;&gt; emu.load_binary('/home/sha0/src/scemu/shellcodes32/shikata.bin')shellcode detected.&gt;&gt;&gt; emu.set_verbose(0)   # by default already 0&gt;&gt;&gt; emu.disable_console() # by default already disabled&gt;&gt;&gt; emu.run()   #  ----- emulation -----** 333368 kernel32!LoadLibraryA  'ws2_32' =0x77480000 ** 1618021 ws2_32!WsaStartup ** 2902832 ws2_32!WsaSocketA ** 4180546 ws2_32!connect  family: 2 192.168.1.38:1337 ** 5456468 ws2_32!recv   buff: 0x22de64 sz: 4 ** 5736281 kernel32!VirtualAlloc sz: 256 addr: 0x164 ** 7012203 ws2_32!recv   buff: 0x164 sz: 256 redirecting code flow to non maped address 0x264&gt;&gt;&gt; help(emu.run)Help on built-in function run:run(end_addr) method of builtins.Emu instance    start emulating the binary until reach the provided end_addr.     Use run() with no param for emulating forever.```### Loading Danabot PE```python&gt;&gt;&gt; emu.load_binary('/home/sha0/samples/danabot/2023-04-03-MainModule/unpacked2/dbmm_unpacked.dll')PE32 header detected.IAT binding started ...Loaded /home/sha0/src/scemu/maps32/version.dll5 sections  base addr 0x52180000created pe32 map for section `.text` at 0x52181000 size: 10431created pe32 map for section `.data` at 0x52184000 size: 872created pe32 map for section `.idata` at 0x52185000 size: 3176created pe32 map for section `.rsrc` at 0x52186000 size: 1064created pe32 map for section `.reloc` at 0x52187000 size: 820Loaded /home/sha0/src/scemu/maps32/mpr.dll6 sections  base addr 0x4b680000created pe32 map for section `.text` at 0x4b681000 size: 71344created pe32 map for section `.data` at 0x4b693000 size: 1260created pe32 map for section `.idata` at 0x4b694000 size: 4228created pe32 map for section `.didat` at 0x4b696000 size: 80created pe32 map for section `.rsrc` at 0x4b697000 size: 1296created pe32 map for section `.reloc` at 0x4b698000 size: 3856Loaded /home/sha0/src/scemu/maps32/netapi32.dll4 sections  base addr 0x40ac0000created pe32 map for section `.text` at 0x40ac1000 size: 51905created pe32 map for section `.data` at 0x40ace000 size: 992created pe32 map for section `.rsrc` at 0x40acf000 size: 1016/!\ warning: raw sz:56832 off:55808 sz:1024  off+sz:56832created pe32 map for section `.reloc` at 0x40ad0000 size: 908Loaded /home/sha0/src/scemu/maps32/shell32.dll4 sections  base addr 0x73800000created pe32 map for section `.text` at 0x73801000 size: 3966180created pe32 map for section `.data` at 0x73bca000 size: 26872created pe32 map for section `.rsrc` at 0x73bd1000 size: 8670296/!\ warning: raw sz:12872192 off:12660736 sz:211456  off+sz:12872192created pe32 map for section `.reloc` at 0x74416000 size: 211060Loaded /home/sha0/src/scemu/maps32/esent.dll7 sections  base addr 0x10000000created pe32 map for section `.text` at 0x10001000 size: 2573914created pe32 map for section `.data` at 0x10276000 size: 22056created pe32 map for section `.idata` at 0x1027c000 size: 7442created pe32 map for section `.didat` at 0x1027e000 size: 44created pe32 map for section `cachelin` at 0x1027f000 size: 1824created pe32 map for section `.rsrc` at 0x10280000 size: 1360/!\ warning: raw sz:2712064 off:2597376 sz:114688  off+sz:2712064created pe32 map for section `.reloc` at 0x10281000 size: 114200Loaded /home/sha0/src/scemu/maps32/iphlpapi.dll4 sections  base addr 0x40c90000created pe32 map for section `.text` at 0x40c91000 size: 96173created pe32 map for section `.data` at 0x40ca9000 size: 1936created pe32 map for section `.rsrc` at 0x40caa000 size: 1288/!\ warning: raw sz:103936 off:101376 sz:2560  off+sz:103936created pe32 map for section `.reloc` at 0x40cab000 size: 2372Loaded /home/sha0/src/scemu/maps32/winspool.drv.dll6 sections  base addr 0x4cc80000created pe32 map for section `.text` at 0x4cc81000 size: 328345created pe32 map for section `.data` at 0x4ccd2000 size: 4972created pe32 map for section `.idata` at 0x4ccd4000 size: 8628created pe32 map for section `.didat` at 0x4ccd7000 size: 548created pe32 map for section `.rsrc` at 0x4ccd8000 size: 88632/!\ warning: raw sz:449536 off:430080 sz:19456  off+sz:449536created pe32 map for section `.reloc` at 0x4ccee000 size: 19448Loaded /home/sha0/src/scemu/maps32/netapi32.dll4 sections  base addr 0x40ac0000created pe32 map for section `.text` at 0x40ac1000 size: 51905created pe32 map for section `.data` at 0x40ace000 size: 992created pe32 map for section `.rsrc` at 0x40acf000 size: 1016/!\ warning: raw sz:56832 off:55808 sz:1024  off+sz:56832created pe32 map for section `.reloc` at 0x40ad0000 size: 908Loaded /home/sha0/src/scemu/maps32/rasapi32.dll6 sections  base addr 0x10000000created pe32 map for section `.text` at 0x10001000 size: 812208created pe32 map for section `.data` at 0x100c8000 size: 5692created pe32 map for section `.idata` at 0x100ca000 size: 9484created pe32 map for section `.didat` at 0x100cd000 size: 524created pe32 map for section `.rsrc` at 0x100ce000 size: 1296/!\ warning: raw sz:875008 off:826880 sz:48128  off+sz:875008created pe32 map for section `.reloc` at 0x100cf000 size: 47656Loaded /home/sha0/src/scemu/maps32/shell32.dll4 sections  base addr 0x73800000created pe32 map for section `.text` at 0x73801000 size: 3966180created pe32 map for section `.data` at 0x73bca000 size: 26872created pe32 map for section `.rsrc` at 0x73bd1000 size: 8670296/!\ warning: raw sz:12872192 off:12660736 sz:211456  off+sz:12872192created pe32 map for section `.reloc` at 0x74416000 size: 211060Loaded /home/sha0/src/scemu/maps32/pstorec.dll5 sections  base addr 0x5a800000created pe32 map for section `.text` at 0x5a801000 size: 1105created pe32 map for section `.data` at 0x5a802000 size: 804created pe32 map for section `.idata` at 0x5a803000 size: 480created pe32 map for section `.rsrc` at 0x5a804000 size: 9936/!\ warning: raw sz:14336 off:13824 sz:512  off+sz:14336created pe32 map for section `.reloc` at 0x5a807000 size: 44Loaded /home/sha0/src/scemu/maps32/rasapi32.dll6 sections  base addr 0x10000000created pe32 map for section `.text` at 0x10001000 size: 812208created pe32 map for section `.data` at 0x100c8000 size: 5692created pe32 map for section `.idata` at 0x100ca000 size: 9484created pe32 map for section `.didat` at 0x100cd000 size: 524created pe32 map for section `.rsrc` at 0x100ce000 size: 1296/!\ warning: raw sz:875008 off:826880 sz:48128  off+sz:875008created pe32 map for section `.reloc` at 0x100cf000 size: 47656IAT Bound.Loaded /home/sha0/samples/danabot/2023-04-03-MainModule/unpacked2/dbmm_unpacked.dll10 sections  base addr 0x1e70000created pe32 map for section `.text` at 0x1e71000 size: 31920128entry point at 0x22f7968  0x487968 created pe32 map for section `.itext` at 0x22f6000 size: 36659200created pe32 map for section `.data` at 0x22f8000 size: 36667392created pe32 map for section `.bss` at 0x236f000 size: 37154816created pe32 map for section `.idata` at 0x2489000 size: 38309888created pe32 map for section `.didata` at 0x248e000 size: 38330368created pe32 map for section `.edata` at 0x248f000 size: 38334464created pe32 map for section `.rdata` at 0x2490000 size: 38338560created pe32 map for section `.reloc` at 0x2491000 size: 38342656/!\ warning: raw sz:372658176 off:334061568 sz:38596608  off+sz:372658176created pe32 map for section `.rsrc` at 0x24cd000 size: 38596608```### calling xloader keygen function with 1 params.```python&gt;&gt;&gt; hex(emu.get_reg('eip'))'0x22f7968'&gt;&gt;&gt; struct_ptr = 0x03DB000   # somewhere, evrithing is writable.&gt;&gt;&gt; xloader_key1_keygen = 0x03DB687&gt;&gt;&gt; eax = emu.call32(xloader_key1_keygen, [struct_ptr])&gt;&gt;&gt; rc4_key = emu.read_string_of_bytes(struct_ptr+1980, 20)&gt;&gt;&gt; rc4_key'03 00 00 6a 02 51 ff d2 80 3b 00 74 4e 8b 4d 14 6a 08 89 8e '```other way to do the call:```python&gt;&gt;&gt; struct_ptr = 0x03DB000&gt;&gt;&gt; xloader_key1_keygen = 0x03DB687&gt;&gt;&gt; old_eip = emu.set_reg('eip', xloader_key1_keygen)&gt;&gt;&gt; ret_addr = old_eip&gt;&gt;&gt; emu.stack_push32(struct_ptr)True&gt;&gt;&gt; emu.stack_push32(ret_addr)True&gt;&gt;&gt; emu.run(ret_addr)  # point ret_addr to some mapped place and run until ret_addr```### Spawn console by address or by position.```python&gt;&gt;&gt; emu.spawn_console_at_pos(6)&gt;&gt;&gt; emu.set_verbose(3)&gt;&gt;&gt; emu.run(0)shellcode detected.1 0x3c8b97: push  ebp ;0x22f000 2 0x3c8b97: push  ebp ;0x22f000 3 0x3c8b98: mov   ebp,esp4 0x3c8b9a: mov   ecx,[ebp+0Ch]5 0x3c8b9d: mov   eax,[ebp+8]-------6 0x3c8ba0: xor   [eax],ecx--- console ---=&gt;r eaxeax: 0x3c0000 3932160 (code)=&gt;r ecxecx: 0x464 1124 'AAAABBBB' (struct_buff)=&gt;```</longdescription>
</pkgmetadata>