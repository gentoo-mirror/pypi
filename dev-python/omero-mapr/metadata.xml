<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>.. image:: https://github.com/ome/omero-mapr/workflows/OMERO/badge.svg    :target: https://github.com/ome/omero-mapr/actions.. image:: https://badge.fury.io/py/omero-mapr.svg    :target: https://badge.fury.io/py/omero-maprMAPR====OMERO.mapr is an OMERO.web app that enables browsing of data through attributes linked to imagesin the form of Map Annotations.It is used extensively by the `Image Data Resource &lt;https://idr.openmicroscopy.org/&gt;`_,allowing users to find data by various categories such as Genes, Phenotypes, Organism etc.In OMERO, Map Annotations are lists of named attributes or &quot;Key-Value Pairs&quot; that can be used toannotate many types of data. Annotations can be assigned a ``namespace``to indicate the origin and purpose of the annotation.Map Annotations created by users via the Insight client or webclient all have thenamespace ``openmicroscopy.org/omero/client/mapAnnotation``, whereas otherMap Annotations created via the OMERO API by other tools should have their own distinctnamespace.We can configure OMERO.mapr to search for Map Annotations of specified ``namespace``,looking for ``Values`` under specifed ``Keys``.For example, seach for values under key ``Gene Symbol`` or ``Gene Identifier``and namespace ``openmicroscopy.org/mapr/gene``... image:: https://user-images.githubusercontent.com/900055/36256919-d8a19fb6-124c-11e8-8628-d792ff29bd22.pngRequirements============* OMERO.web 5.6 or newer.Installing from Pypi====================This section assumes that an OMERO.web is already installed.NB: Configuration of the settings (see below) is not optionaland is required for the app to work.Install the app using `pip &lt;https://pip.pypa.io/en/stable/&gt;`_:::    $ pip install omero-maprAdd the app to the list of installed apps:::    $ omero config append omero.web.apps '&quot;omero_mapr&quot;'Config Settings===============You need to configure the namespaces and keys that you want users to be able to search for.User-edited Map Annotations---------------------------Map Annotations that are added using the webclient or Insight in the Key-Value paneluse a specific &quot;client&quot; namespace. We can therefore configure OMERO.mapr to searchfor these annotations using the namespace ``openmicroscopy.org/omero/client/mapAnnotation``.For example, to search for &quot;Primary Antibody&quot; or &quot;Secondary Antibody&quot; values, we can add:::    $ omero config append omero.web.mapr.config '{&quot;menu&quot;: &quot;antibody&quot;, &quot;config&quot;:{&quot;default&quot;:[&quot;Primary Antibody&quot;], &quot;all&quot;:[&quot;Primary Antibody&quot;, &quot;Secondary Antibody&quot;], &quot;ns&quot;:[&quot;openmicroscopy.org/omero/client/mapAnnotation&quot;], &quot;label&quot;:&quot;Antibody&quot;}}'We can add an &quot;Antibodies&quot; link to the top of the webclient page to take us to the Antibodies search page.The link tooltip is &quot;Find Antibody values&quot;.The ``viewname`` should be in the form ``maprindex_{menu}`` where ``{menu}`` is the the ``menu`` value in the previous config.::    $ omero config append omero.web.ui.top_links '[&quot;Antibodies&quot;, {&quot;viewname&quot;: &quot;maprindex_antibody&quot;}, {&quot;title&quot;: &quot;Find Antibody values&quot;}]'After restarting web, we can now search for Antibodies:.. image:: https://user-images.githubusercontent.com/900055/40605069-063ff29a-6259-11e8-9295-3887dde0441f.pngWe can also specify an empty list of keys to search for *any* value.::    $ omero config append omero.web.mapr.config '{&quot;menu&quot;: &quot;anyvalue&quot;, &quot;config&quot;:{&quot;default&quot;:[&quot;Any Value&quot;], &quot;all&quot;:[], &quot;ns&quot;:[&quot;openmicroscopy.org/omero/client/mapAnnotation&quot;], &quot;label&quot;:&quot;Any&quot;}}'    # Top link    $ omero config append omero.web.ui.top_links '[&quot;Any Value&quot;, {&quot;viewname&quot;: &quot;maprindex_anyvalue&quot;}, {&quot;title&quot;: &quot;Find Any Value&quot;}]'After restarting web, we can now search for any Value, such as &quot;INCENP&quot;:.. image:: https://user-images.githubusercontent.com/900055/40605101-1cd1925c-6259-11e8-93a8-e72af2e570d3.pngOther Map Annotations---------------------In this example we want to searchfor Map Annotations of namespace ``openmicroscopy.org/mapr/gene`` searching forattributes under the ``Gene Symbol`` and ``Gene Identifier`` keys.::    $ omero config append omero.web.mapr.config '{&quot;menu&quot;: &quot;gene&quot;,&quot;config&quot;: {&quot;default&quot;: [&quot;Gene Symbol&quot;],&quot;all&quot;: [&quot;Gene Symbol&quot;, &quot;Gene Identifier&quot;],&quot;ns&quot;: [&quot;openmicroscopy.org/mapr/gene&quot;],&quot;label&quot;: &quot;Gene&quot;}}'Now add a top link of ``Genes`` with tooltip ``Find Gene annotations`` that will take us to the ``gene`` search page. The ``query_string`` parameters are added to the URL, with ``&quot;experimenter&quot;: -1``specifying that we want to search across all users.::    $ omero config append omero.web.ui.top_links '[&quot;Genes&quot;, {&quot;viewname&quot;: &quot;maprindex_gene&quot;, &quot;query_string&quot;: {&quot;experimenter&quot;: -1}}, {&quot;title&quot;: &quot;Find Gene annotations&quot;}]'Finally, we can add a map annotation to an Image that is in a Screen -&gt; Plate -&gt; Wellor Project -&gt; Dataset -&gt; Image hierarchy.This code uses the OMERO `Python API &lt;https://docs.openmicroscopy.org/latest/omero/developers/Python.html&gt;`_ toadd a map annotation corresponding to the configuration above:::    key_value_data = [[&quot;Gene Identifier&quot;,&quot;ENSG00000117399&quot;],                      [&quot;Gene Identifier URL&quot;, &quot;http://www.ensembl.org/id/ENSG00000117399&quot;],                      [&quot;Gene Symbol&quot;,&quot;CDC20&quot;]]    map_ann = omero.gateway.MapAnnotationWrapper(conn)    map_ann.setValue(key_value_data)    map_ann.setNs(&quot;openmicroscopy.org/mapr/gene&quot;)    map_ann.save()    image = conn.getObject('Image', 2917)    image.linkAnnotation(map_ann)Now restart OMERO.web as normal for the configuration above to take effect.You should now be able to browse to a ``Genes`` page and search for``CDC20`` or ``ENSG00000117399``.External URL Favicons^^^^^^^^^^^^^^^^^^^^^Mapr can automatically convert URLs into favicon links.To use this feature the key such as `Gene Identifier` must be in the &quot;all&quot; list of a configas shown above and the `Gene Identifier` key-value pair must be followed by a key-value paircalled `Gene Identifier URL`.A favicon linked to the external URL will be appended to the `Gene Identifier` row, and the`Gene Identifier URL` key-value pair will be hidden.OMERO.web must be configured with the Django redis cachehttps://docs.openmicroscopy.org/omero/5/sysadmins/unix/install-web/walkthrough/omeroweb-install-centos7-ice3.6.html?highlight=redis#configuring-omero-webwhich is used to cache the favicons that are obtained using a Google service.Testing=======Testing MAPR requires OMERO.server running.Run tests (includes self-contained OMERO.server, requires docker)::    docker-compose -f docker/docker-compose.yml up --build --abort-on-container-exit    docker-compose -f docker/docker-compose.yml rm -fvLicense-------MAPR is released under the AGPL.Copyright---------2016-2021, The Open Microscopy Environment</longdescription>
</pkgmetadata>