<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># Table of contents- [About Rid-kit](#about-rid-kit)- [Use Rid-kit with Bohrium k8s](#use-rid-kit-with-bohrium-k8s)  - [Quick Start](#quick-start)- [Use Rid-kit with Local k8s](#use-rid-kit-with-local-k8s)- [Use Rid-kit without k8s environment](#use-rid-kit-without-k8s-environment)- [Main procedure of RiD](#main-procedure-of-rid)- [Preparing files in the input directory](#preparing-files-in-the-input-directory)- [Configure simulations](#configure-simulations)- [Configure machine resources](#configure-machine-resources)- [Download files](#download-files-from-the-workflow)- [Configure MCMC dimension reduction](#configure-mcmc)- [Installation of environment on Slurm](#installation-of-environment-on-slurm)- [Installation with DeepMD potential support](#installation-with-deepmd-potential-support)- [Troubleshooting](#troubleshooting)# About Rid-kitRid-kit is a package written in Python, designed to do enhanced sampling using reinforced dynamics. It aims to learn the free energy surface on the fly during MD run, and uses it as the bias potential during the next MD run. Its advantage is the ability to use a large number of CVs (100), thus can be used to simulate conformational changes of big molecules such as in the problem of protein folding.Rid-kit is based on [dflow](https://github.com/deepmodeling/dflow), one can decide whether to use a k8s environment to run a workflow. It is recommended to use k8s environment to run the workflow unless it is not doable anyway. For more information, check the [documentation](https://rid-kit-dflow.readthedocs.io/en/latest/).# Use Rid-kit with Bohrium k8s## Quick startThe dflow team provide a community version of k8s [deepmodeling k8s](https://workflows.deepmodeling.com/), making the use of Rid-kit very convenient. To use the community version of k8s, one first need to register a Bohrium account in [Bohrium](https://bohrium.dp.tech/login) and learn a few concepts (job, jobgroup, project id) in the Bohrium website documents. Then the use of rid-kit is very easy.### Set the environment variablesJust set the environment variables based on your personal Bohrium account information by```export DFLOW_HOST=https://workflows.deepmodeling.comexport DFLOW_K8S_API_SERVER=https://workflows.deepmodeling.comexport DFLOW_S3_REPO_KEY=oss-bohriumexport DFLOW_S3_STORAGE_CLIENT=dflow.plugins.bohrium.TiefblueClientexport BOHRIUM_USERNAME=&quot;&lt;bohrium-email&gt;&quot;export BOHRIUM_PASSWORD=&quot;&lt;bohrium-password&gt;&quot;export BOHRIUM_PROJECT_ID=&quot;&lt;bohrium-project-id&gt;&quot;```**Note** that the &quot;bohrium-project-id&quot; is the specific ID related to your own Bohrium account, which can be created in [Bohrium Project](https://bohrium.dp.tech/projects) after login into your own account. You can create multiple project IDs for your account.### Install Rid-kitInstall the latest rid-kit```bashpip install setuptools_scmpip install -U rid-kit```### Run an exampleChange to the rid-kit directory```bashcd rid-kit```Run a example of Ala-dipeptide on Bohrium using dihedral as CVs:In &quot;machine_bohrium_k8s.json&quot; file, set &quot;email&quot;, &quot;password&quot; and &quot;program_id&quot; to your own **Bohrium account** information. **Note** that the **program_id** information in machine.json file should be **int** type rather than **string** type.Then run this command to submit the jobs```bashrid submit -i ./tests/data/000 -c ./rid/template/rid_gmx_dih.json -m ./rid/template/machine_bohrium_k8s.json```After successful submission you can login into your Bohrium account at [deepmodeling k8s](https://workflows.deepmodeling.com/) to monitor your job status, where the workflow is displayed using the `Argo` UI.If you want to run Rid-kit using your own customized CVs, an example is given (see [configure simulations](docs/source/rid_configuration.md) for more details):**Note** that the length of **angular_mask**, **weights** and **kappas** keys in rid.json should all be equal to the length of your defined CV number.```bashrid submit -i ./tests/data/001 -c ./rid/template/rid_gmx_custom.json -m ./rid/template/machine_bohrium_k8s.json```You can also run the example on a Slurm machine (But you need to configure a conda environment on the slurm, see [Installation](docs/source/install.md))```bashrid submit -i ./tests/data/000 -c ./rid/template/rid_gmx_dih.json -m ./rid/template/machine_slurm_k8s.json```You can specify the workflow name by providing WORKFLOW_ID after &quot;-d&quot;, for example:```bashrid submit -i ./tests/data/000 -c ./rid/template/rid_gmx_dih.json -m ./rid/template/machine_bohrium_k8s.json -d ala-dipeptide-1```**Note that the defined workflow-id should only contain lower case alphanumeric character, and specifal character &quot;-&quot;.**You can also specify other types of CVs such as distance or any customized CVs, for detailed explanation you can check - [configure simulations](docs/source/rid_configuration.md)### Continue from an old workflowUsing `resubmit` to continue from an old workflow```bash# suppose the original workflow id is OLD_IDrid resubmit -i ./tests/data/000 -c ./rid/template/rid_gmx_dis.json -m ./rid/template/machine_bohrium_k8s.json OLD_ID -d NEW_ID ```If you want to resubmit from a particular `iteration` and `step`:```bashrid resubmit -i your_dir -c path_to_rid.json -m path_to_machine.json OLD_ID -t ITERATION-ID -p STEP-KEY -d NEW_ID``` The `ITERATION-ID`(start from 1) is just `n`th iteration the workflow has been executed. The `STEP-KEY` in rid includes the following steps: `prep-exploration`, `run-exploration`, `prep-select`, `run-select`, `prep-label`, `run-label`, `label-stats`, `collect-data`, `merge-data`, `train`, `model-devi`.### Download files from the workflow```bashrid download WORKFLOW_ID -p STEP-KEY -f FILE_NAME -a ITERATION_START -e ITERATION_END -o OUTPUT_DIR```typically we want the trajectories information from each exploration step, suppose we run a workflow for 20 iterations.```bashrid download WORKFLOW_ID -p run-exploration -f trajectory -a 1 -e 20 -o my_protein_out```Detained explanation for other files in the Rid run can be found as follows:- [Download files](docs/source/rid_download.md)### Reduce the dimension of free energy modelAfter the Rid-kit Run, the workflow will generate several numbers of free energy models (.pb). The Rid-kit currently support MCMC to reduce the dimension of the free energy model, for example:```bashrid redim -i ./test/data/models -c ./rid/template/rid_mcmc_cv_dih.json -m ./rid/template/machine_bohrium_k8s_mcmc.json```Then you will get the projected free energy surface for ala-dipeptide![image1](docs/pics/mcmc_ala_1cv.png) | ![image2](docs/pics/mcmc_ala_2cv.png)---|---You can also include .out file representing the CV output information inside the directory specified by `-i` parameter, this will plot the CV output upon the free energy surface.# Use Rid-kit with Local k8sA tutorial on using Rid-kit with k8s environment configured by your own can be found as follows:- [Tutorial](docs/source/tutorial.md)# Use Rid-kit without k8s environmentTo run the workflow without k8s environment, one can use the `Debug` mode of `Dflow`. In this mode however, one can not monitor the workflow in the `Argo` UI.## Install the computation environmentIf you want to run Rid-kit on a local machine or server, without `k8s` enviroment, you need to configure a conda environment on your machine, see [Installation](docs/source/install.md))## Install the latest rid-kit```bashpip install setuptools_scmpip install -U rid-kit```## Run an exampleIf one wants to run the workflow on the `Slurm` machine locally, change to the rid-kit directory and type (change to your slurm configuration)```bashDFLOW_DEBUG=1 rid submit -i ./tests/data/000 -c ./rid/template/rid_gmx_dih.json -m ./rid/template/machine_slurm_local.json -d ala-dipeptide-1```# Main procedure of RiDRiD will run in iterations. Every iteration contains tasks below:1. Biased MD;2. Restrained/Constrained MD;3. Training neural network.## Biased MDJust like Metadynamics, RiD will sample based on a bias potential given by NN models. An uncertainty indicator will direct the process of adding bias potential.## Restrained/Constrained MDThis procedure will calculate the mean force based on the sampling results of restrained MD or constrained MD, which can generate data set for training. ## Neural network trainingA fully connected NN will be trained via sampling data. This network will generate a map from selected CV to free energy.A more detailed description of RiD is published now, please see:&gt; [1]  Zhang, L., Wang, H., E, W.. Reinforced dynamics for enhanced sampling in large atomic and molecular systems[J]. The Journal of chemical physics, 2018, 148(12): 124113.&gt;  &gt; [2]  Wang, D., Wang, Y., Chang, J., Zhang, L., &amp; Wang, H. (2022). Efficient sampling of high-dimensional free energy landscapes using adaptive reinforced dynamics. Nature Computational Science, 2(1), 20-29.# Preparing files in the input directoryRules for preparing files in the input directory can be found in- [Preparing files](docs/source/prepare_files.md)# Configure simulations- [configure simulations](docs/source/rid_configuration.md)# Configure machine resources- [configure machines](docs/source/rid_machine.md)# Configure mcmc - [configure mcmc dimension reduction](docs/source/mcmc_configuration.md)# Installation of environment on SlurmIf you sumit the RiD workflow to Bohrium, you do not need to install the enviroment yourself, rather Bohrium will pull the docker images to do the computation. But if you submit the workflow to Slurm machine, you will have to install the computation environment, details of the installation can be found in- [Installation](docs/source/install.md)# Installation with DeepMD potential supportInstallation of the computation environment with DeepMD potential support on slurm machines can be found in- [Installation of dp](docs/source/install_dp.md)# Workflow Synopsis- ![image](docs/pics/rid_workflow.jpg)# Troubleshooting- [Installation](docs/source/troubleshooting/installation.md)- [Minikube](docs/source/troubleshooting/minikube.md)- [Submit](docs/source/troubleshooting/submit.md)</longdescription>
</pkgmetadata>