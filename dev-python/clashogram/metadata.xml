<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>.. contents::   :depth: 3..clashogram |Build Status| |Build status| |Pypi status|======================================================Clash of Clans war moniting for telegram channels.    NOTE: Clash of Clans API data is always 10 minutes behind the game    events. This is not a bug in this program.``clashogram`` monitors your clan's warlog and posts the followingmessages to a Telegram channel:1. Preparation started (with clans and players information)2. War started3. New attacks (with details)4. War overRequirements------------To run the program you need to have python 3.3 or higher. You will alsoneed ``pip`` to install python dependencies. Moreover, using a`virtualenv &lt;https://virtualenv.pypa.io/en/stable/&gt;`__ makesinstallation much easier, otherwise you have to install everythingsystem-wide. On Linux you would need to run commands with ``sudo``, onwindows with administrator account.Installation------------From pypi::    $ pip install clashogramFrom Github (for development)::    $ git clone https://github.com/mehdisadeghi/clashogram.git    $ cd clashogram    $ pip install flit    $ flit install --symlinkWith Docker-----------In order to run the latest docker version do the following::    $ docker run -it mehdisadeghi/clashogram:latestThis will prompt for the necessary parameters and start the app. Slighty better would be::    $ docker run --env-file=&lt;ENV_FILE&gt; --name clashogram --restart=always -d mehdisadeghi/clashogram:latestThis will run the container in the background and restart it if it fails. ``ENV_FILE`` should contain one ``key=value`` per line (the app params). In my experience this works good enought, however for some reason sometimes docker does not start the container after reboot. In that case a systemd unit or similar could be used to start the ``clashogram`` container above.Usage-----In order to use the program do the following:1. Open a Clash of Clans developer account at   https://developer.clashofclans.com/.2. Find your external IP address using a website like   `this &lt;https://whatismyipaddress.com/&gt;`__.3. Go to your CoC developer page and create an API token for the IP number you just found.4. Create a Telegram bot using BotFather and copy its token.5. [For Channels] Create a new Telegram channel and add the bot you just created as to that channel. As of May 2020, bots can only be added as administrators to channels. If you want to post to a group instead of a channel see the instructions below.6. [For Groups] Add the bot you just created to your Telegram group (create one if necessary).Obtaining The Chat ID~~~~~~~~~~~~~~~~~~~~~In order to send messages to a channel or a chat in Telegram we need the ID of that chat, i.e. ``chat_id``. This is how Telegram API works. For public channels it is possible to use the name of the channel prefixed with ``@`` as ``chat_id``, e.g. ``@mypublicchannel``. However, for private channels and group chats we need to obtain the ``chat_id``.Take the following steps to obtain the correct ``chat_id``:1. Add the bot to the group or channel2. Make sure to write something in the channel/chat3. Use the ``bot_token`` from the step 4 of the previous section and run one of these this command::    # For a group chat run this    $ curl --silent --request POST https://api.telegram.org/bot&lt;YOUR_BOT_TOKEN&gt;/getUpdates | jq '.result | map(select(.message.chat.type == &quot;group&quot;)) | .[0].message.chat.id'    # For a channel run this    $ curl --silent --request POST https://api.telegram.org/bot&lt;YOUR_BOT_TOKEN&gt;/getUpdates | jq '.result | map(select(.channel_post.chat.type == &quot;channel&quot;)) | .[0].channel_post.chat.id'You can omit the `jq &lt;https://stedolan.github.io/jq/&gt;`__ part and just search for a ``type=group`` or ``type=channel`` in the output and take note of its ``id``. This is what we will use in the rest of this document as ``chat_id`` for channels and groups. Remember that you can also use ``@yourpublicchannel`` form as ``chat_id`` for public channels.Now to make sure if the ``chat_id`` realy points to a chat, run the following command and see whether your bot can post to your channel or group chat::    $ curl --request POST --url https://api.telegram.org/bot&lt;YOUR_BOT_TOKEN&gt;/sendMessage\?chat_id\=&lt;CHAT_ID_FROM_THE_PREVIOUS_STEP&gt;\&amp;text\=hiIf it does not work, make sure you have done the previous steps correctly or open an issue on GitHub.Starting The Program~~~~~~~~~~~~~~~~~~~~Now we can proceed with starting the program. Run the following command to install and start the program::    $ pip install clashogram    $ clashogram.py --coc-token &lt;COC_API_TOKEN&gt; --clan-tag &lt;CLAN_TAG&gt; --bot-token &lt;TELEGRAM_BOT_TOKEN&gt; --chat-id &lt;CHAT_ID&gt; --forever    NOTE: Remember that channel names begin with ``@`` and chat_ids are numbers (often negative).If you don't want attack updates in your channel add ``--mute-attacks`` to the above command.In order to have messages in a different locale do the following andthen run the program::    $ export LANGUAGE=&lt;LANGUAGE_CODE&gt;    # This is for Persian    $ export LANGUAGE=faOr do it in one step::    $ LANGUAGE=fa clashogram.py --coc-token &lt;COC_API_TOKEN&gt; --clan-tag &lt;CLAN_TAG&gt; --bot-token &lt;TELEGRAM_BOT_TOKEN&gt; --chat-id &lt;CHAT_ID&gt;Setting Language on Windows~~~~~~~~~~~~~~~~~~~~~~~~~~~Make sure to run ``set LANGUAGE=&lt;your_lang_code_here&gt;`` on windows before running the program.Run as a service~~~~~~~~~~~~~~~~The simplest way to use Clashogram is leave it running in backgroundusing either `byobu &lt;byobu.org&gt;`__ or `GNUScreen &lt;https://www.gnu.org/software/screen/&gt;`__. Another solution is toinstall a systemd unit::    [Unit]    Description=Clashogram Daemon    After=network.target    [Service]    WorkingDirectory=/path/to/clashogram/    EnvironmentFile=/path/to/env/file    ExecStart=/path/to/python /path/to/clashogram.py    Restart=on-failure    User=someuser    [Install]    WantedBy=multi-user.targetSearch internet for more information on installing systemd units on yourOS.Contribution (PRs welcome!)---------------------------The Telegram notification is isolated from the rest of the program. Youcan replace it with anything else to have your messages sent tosomewhere else.Fork and clone the repository and send a PR. Make sure tests passbeforehand::    python -m unittest discoverOr with ``py.test``::    pip install pytest    py.test tests.pyI18N----In order toadd or update a new language catalog do the following::    pip install babel # Install the babel i18n tool first.::    pybable init -i clashogram/locales/messages.pot -d clashogram/locales -l &lt;LANGUAGE_CODE&gt;    pybable update -i clashogram/locales/messages.pot -d clashogram/locales -l &lt;LANGUAGE_CODE&gt;For example::    pybable init -i clashogram/locales/messages.pot -d clashogram/locales -l fa    pybable update -i clashogram/locales/messages.pot -d clashogram/locales -l faIn case of adding new messages extract them and compile again::    pybabel extract clashogram/ -o clashogram/locales/messages.pot --project Clashogram --version 0.6.0    pybabel update -i clashogram/locales/messages.pot -d clashogram/locales    pybabel compile -d clashogram/localesFor more information on internationalization see`Babel &lt;http://babel.pocoo.org/en/latest/setup.html&gt;`__.Credits-------Thanks Ali Ayatollahi and other members from IRAN clan (tag #YVL0C8UY) for the initial idea and testing.License-------MIT.. |Build Status| image:: https://travis-ci.org/mehdisadeghi/clashogram.svg?branch=master   :target: https://travis-ci.org/mehdisadeghi/clashogram.. |Build status| image:: https://ci.appveyor.com/api/projects/status/ovixrhmsp3og4nt4/branch/master?svg=true   :target: https://ci.appveyor.com/project/mehdisadeghi/clashogram/branch/master.. |Pypi status| image:: https://img.shields.io/pypi/v/clashogram.svg   :target: https://pypi.python.org/pypi/clashogramRussian Translations--------------------You can read this document in Russian thanks to Timur from Illuminati clan. Thanks Timur!`this document in Russian &lt;README_RU.rst&gt;`__راهنمای فارسی-------------برای مطالعه راهنمای فارسی به `این آدرس &lt;http://mehdix.ir/clashogram.html&gt;`__ سر بزنید.</longdescription>
</pkgmetadata>