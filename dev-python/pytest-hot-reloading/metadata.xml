<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># A PyTest Hot Reloading Plugin![versions](https://img.shields.io/pypi/pyversions/pytest-hot-reloading)A hot reloading pytest daemon, implemented as a plugin.## Features- Uses the [jurigged](https://github.com/breuleux/jurigged) library to watch and hot reload files- Caches test discovery in many situations- Improved performance by not having to import libraries again and again and skipping initializtion logic- System for registering workarounds in case something doesn't work out of the box## Trade-offs- First run is slower- May not work with some libraries- Sometimes gets in a bad state and needs to be restartedIf it takes less than 5 seconds to do all of the importsnecessary to run a unit test, then you probably don't need this.If you're using Django, recommended to use `--keep-db` to preserve the test database.The minimum Python version is 3.10## Demo### With hot reloadingSlower initial start time but faster subsequent runs![Hot reloading demo](docs/hot-reloading-demo.gif)### Without hot reloading![Not hot reloading demo](docs/not-hot-reloading-demo.gif)## InstallationDo not install in production code. This is exclusively for the developer environment.**pip**: Add `pytest-hot-reloading` to your `dev-requirements.txt` file and `pip install -r dev-requirements.txt`**poetry**: `poetry add --group=dev pytest-hot-reloading`## UsageAdd the plugin to the pytest arguments.Example using pyproject.toml:```toml[tool.pytest.ini_options]addopts = &quot;-p pytest_hot_reloading.plugin&quot;```When running pytest, the plugin will detect whether the daemon is running, and start it if is not.Note that a pid file is created to track the pid.Imports and in many cases initialization logic are not reran on subsequent runs, which can be a huge time saver.Currently, if you want to debug, you will want to run the daemon manually with debugging.### JetBrains (IDEA, PyCharm, etc)Create a REGULAR Python run configuration, with pytest as the *module*. For parameters, add `--daemon`. Strongly consider storingin the project so it is shared with other developers.![JetBrains Example](docs/jetbrains-hot-reloading-example.png)For more information on parameters, see the VS Code section below.### VS Code![Debugging demo](docs/hot-reloading-debug.gif)This can easily be done in VS Code with the following launch profile:```json        {            &quot;name&quot;: &quot;Pytest Daemon&quot;,            &quot;type&quot;: &quot;python&quot;,            &quot;request&quot;: &quot;launch&quot;,            &quot;module&quot;: &quot;pytest&quot;,            &quot;justMyCode&quot;: false,            &quot;args&quot;: [                &quot;--daemon&quot;,                //                // everything below this is optional                //                &quot;--daemon-port&quot;,                &quot;4852&quot;, // the default value                &quot;--daemon-watch-globs&quot;,                &quot;./*.py&quot; // the default value                // &quot;./my-project/*.py:./some-thing-else/*.py&quot;,  // example of colon separated globs                &quot;--daemon-ignore-watch-globs&quot;,                &quot;./.venv/*&quot; // this is the default value, also colon separated globs            ]        },```The only reason you would need to limit the watched files is because the jurigged libraryopens every file it watches, so it can exhaust the open file limit if you have a lot of files.If the daemon is already running and you run pytest with `--daemon`, then the old one will be stoppedand a new one will be started. Note that `pytest --daemon` is NOT how you run tests. It is only used to startthe daemon.The daemon can be stopped with `pytest --stop-daemon`. This can be used if it gets into a bad state.## Arguments and Env Variables- `PYTEST_DAEMON_PORT`    - The port the daemon listens on.    - Default: `4852`.    - Command line: `--daemon-port`- `PYTEST_DAEMON_PYTEST_NAME`    - The name of the pytest executable.    - Default: `pytest`.    - Command line: `--pytest-name`- `PYTEST_DAEMON_WATCH_GLOBS`    - The colon separated globs to watch.    - Default: `./**/*.py`.    - Command line: `--daemon-watch-globs`- `PYTEST_DAEMON_IGNORE_WATCH_GLOBS`    - The colon separated globs to ignore.    - Default: `./.venv/*`.    - Command line: `--daemon-ignore-watch-globs`## WorkaroundsLibraries that use mutated globals may need a workaround to work with this plugin. The preferredroute is to have the library update its code to not mutate globals in a test environment, or torestore them after a test suite has ran. In some cases, that isn't possible, usually becausethe person with the problem doesn't own the library and can't wait around for a fix.To register a workaround, create a function that is decorated by the`pytest_hot_reloading.workaround.register_workaround` decorator. It may optionally yield. If it does,then code after the yield is executed after the test suite has ran.Example:```pythonfrom pytest_hot_reloading.workaround import register_workaround@register_workaround(&quot;my_library&quot;)def my_library_workaround():    import my_library    yield    my_library.some_global = BackToOriginalValue()```If you are a library author, you can disable any workarounds for your library by creating an emptymodule `_clear_hot_reload_workarounds.py`. If this is successfully imported, then workarounds forthe given module will not be executed.## Known Issues- This is early alpha- The jurigged library is not perfect and sometimes it gets in a bad state- Some libraries were not written with hot reloading in mind, and will not work without some changes.## Notes- pytest-xdist will have its logic disabled, even if args are passed in to enable it- pytest-django will not create test database suffixes for multiworker runs such as tox.</longdescription>
</pkgmetadata>