<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>django-ai-kit-auth==================django-ai-kit-auth bundles everything authentication related and is meant towork seamlessly with the ai-kit-auth react component.It provides routes for login, password validation, password reset, registrationand account verification.It also handles email notifications on registration and password reset. Lookat the template section of the settings to configure the email templates.It works with the standard django and with a custom user model aslong as its provides an email address.Standard Django sessions are used for authentification.Index-----* `Quick Start`_* `Api Documentation`_    * `Login`_    * `Logout`_    * `Me`_    * `Registration`_    * `Initiate Password Reset`_    * `Password Reset`_    * `Validate Password`_    * `Activate User`_* `Error Codes`_* `Signals`_Quick Start-----------1.) Add ``ai_kit_auth`` to your ``INSTALLED_APPS`` like so:::    INSTALLED_APPS = (        # ...        &quot;rest_framework&quot;,        # ...        &quot;ai_kit_auth&quot;,        # ...        &quot;corsheaders&quot;,    )``rest_framework`` from the pip package ``djangorestframework`` and ``corsheaders``from the pip package ``django-cors-headers`` are dependencies and must beinstalled.The cors headers middleware has to be put into the middleware configurationlike so:::    MIDDLEWARE = (        &quot;corsheaders.middleware.CorsMiddleware&quot;,        # ...    )This middleware has to be put as high as possible in the middlware list.For more details see the`django-cors-headers &lt;https://github.com/adamchainz/django-cors-headers&gt;`__documentation.2.) Configuration is namespaced unter ``AI_KIT_AUTH`` like so:::    AI_KIT_AUTH = {        &quot;FRONTEND&quot;: {            &quot;URL&quot;: &quot;example.com&quot;,        },        # ...    }Note that ``FRONTEND.URL`` is a required configuration that does not have adefault. Default configurations are:::    AI_KIT_AUTH = {        # You can disable any or all of the endpoints created by ai-kit-auth        # by setting the respective entry in this section to False.        &quot;ENABLE_ENDPOINTS&quot;: {            &quot;LOGIN&quot;: True,            # Route to activate an email address after registration            &quot;ACTIVATE_EMAIL&quot;: True,            &quot;LOGOUT&quot;: True,            # Endpoint which checks whether the client making the request is            # logged in, and if so returns user information            &quot;ME&quot;: True,            # endpoint to check whether the backend will accept a certain password            &quot;VALIDATE_PASSWORD&quot;: True,            # Calling this endpoint triggers an email for password recovery to be sent            &quot;SEND_PW_RESET_MAIL&quot;: True,            # endpoint for actually changing the password            &quot;RESET_PASSWORD&quot;: True,            # registers a new user            &quot;REGISTER&quot;: True,        },        # Templates for all the email notifications to the user        &quot;EMAIL_TEMPLATES&quot;: {            # Here you can supply a function taking no arguments and returning            # a dictionary with entries, that you would like to pass to the            # email template in case you want to provide your own.            # By default it points to a function that returns an empty dictionary.            &quot;CUSTOM_DATA_FUNCTION&quot;: &quot;ai_kit_auth.services.custom_email_data&quot;,            # is send when the user is created by registration            &quot;USER_CREATED&quot;: {                &quot;TITLE&quot;: &quot;ai_kit_auth/user_created_title.txt&quot;,                &quot;BODY_PLAINTEXT&quot;: &quot;ai_kit_auth/user_created_body.txt&quot;,                &quot;BODY_HTML&quot;: &quot;ai_kit_auth/user_created_body.html&quot;,            },            # is send to the user after they triggered the forget password            # feature. Contains the time limited password reset link            &quot;RESET_PASSWORD&quot;: {                &quot;TITLE&quot;: &quot;ai_kit_auth/reset_password_title.txt&quot;,                &quot;BODY_PLAINTEXT&quot;: &quot;ai_kit_auth/reset_password_body.txt&quot;,                &quot;BODY_HTML&quot;: &quot;ai_kit_auth/reset_password_body.html&quot;,            },        },        # If you need complete control over how the activation email is sent,        # override this setting with your own function. Ai-kit-auth will pass        # two arguments: a user object and url as a string, which points to the        # frontend page which needs to be visited in order to activate the account        &quot;SEND_USER_ACTIVATION_MAIL&quot;: &quot;ai_kit_auth.services.default_send_user_activation_mail&quot;,        # If you need complete control over how the activation email is sent,        # override this setting with your own function. Ai-kit-auth will pass        # two arguments: a user object and url as a string, which points to the        # frontend page which needs to be visited in order to activate the account        &quot;SEND_ACTIVATION_BY_ADMIN_MAIL&quot;: &quot;ai_kit_auth.services.default_send_activation_by_admin_mail&quot;,        # If you need complete control over how the password reset email is sent,        # override this setting with your own function. Ai-kit-auth will pass        # two arguments: a user object and url as a string, which points to the        # frontend page which needs to be visited in order to reset the password        &quot;SEND_RESET_PW_MAIL&quot;: &quot;ai_kit_auth.services.default_send_reset_pw_mail&quot;,        # Set this to False to prevent ai-kit-auth to register its own admin forms        # with django admin. It will then use the default admin forms from        # django.contrib.auth.admin or your own forms.        &quot;USE_AI_KIT_AUTH_ADMIN&quot;: True,        # If you want to configure the layout of the admin form or you use a        # use model doesn't have all the fields you need, you can supply your        # own fieldsets.        &quot;ADMIN_FIELDSETS&quot;: (            (None, {&quot;fields&quot;: (&quot;username&quot;, &quot;email&quot;, &quot;password&quot;)}),            (_(&quot;Personal info&quot;), {&quot;fields&quot;: (&quot;first_name&quot;, &quot;last_name&quot;)}),            (                _(&quot;Permissions&quot;),                {                    &quot;fields&quot;: (                        &quot;is_active&quot;,                        &quot;is_staff&quot;,                        &quot;is_superuser&quot;,                        &quot;groups&quot;,                        &quot;user_permissions&quot;,                    ),                },            ),            (_(&quot;Important dates&quot;), {&quot;fields&quot;: (&quot;last_login&quot;, &quot;date_joined&quot;)}),        ),        &quot;ADMIN_ADD_FIELDSETS&quot;: (            (                None,                {                    &quot;classes&quot;: (&quot;wide&quot;,),                    &quot;fields&quot;: (&quot;username&quot;, &quot;email&quot;, &quot;password1&quot;, &quot;password2&quot;),                },            ),        ),        # If true, the user has to specify a username in addition to the        # mail address        &quot;USERNAME_REQUIRED&quot;: False,        # A serializer which is used by the ai-kit-auth endpoints for        # sending user information to the frontend. Override it if you need        # additional information about a user in the frontend, like e.g. avatar        # image, user role etc.        # The default USER_SERIALIZER contains id, email and username.        &quot;USER_SERIALIZER&quot;: &quot;ai_kit_auth.serializers.UserSerializer&quot;,        # A serializer which is used by the registration endpoint. Override if        # you need additional information about the user directly in the        # registration. The default serializer sets username, password and email        &quot;REGISTRATION_SERIALIZER&quot;: &quot;ai_kit_auth.serializers.RegistrationSerializer&quot;,        # The user model fields which are used to identify a user.        # They are iterated over in the given order to find a user from the &quot;ident&quot; parameter        # provided to the views.        &quot;USER_IDENTITY_FIELDS&quot;: (&quot;email&quot;, &quot;username&quot;),        # information about the frontend, mostly the used routes. In most cases        # the defaults are fine, but can be changed for localisation of the        # urls.        # Only the actual frontend url is unset and you will get an        # configuration error if you don't specify it.        &quot;FRONTEND&quot;: {            &quot;URL&quot;: &quot;&quot;,            &quot;ACTIVATION_ROUTE&quot;: &quot;/auth/activation/&quot;,            &quot;RESET_PW_ROUTE&quot;: &quot;/auth/reset_password/&quot;,        },    }In addition to that some general configuration is required:::    CORS_ORIGIN_WHITELIST = [        &quot;http://localhost:8000&quot;,        &quot;http://localhost:3000&quot;,        # add other front-end backend urls    ]    CORS_ALLOW_CREDENTIALS = True    CSRF_USE_SESSIONS = True    CSRF_TRUSTED_ORIGINS = [        &quot;http://localhost:8000&quot;,        &quot;http://localhost:3000&quot;,        # add other front-end backend urls    ]The ``CSRF_USE_SESSIONS`` configuration doesn't need to be set to enableAi-Kit-Auth, but in prevents problems with double logins, for exampleif a user is logged into the Admin interface and also logged in thefrontend. Django saves CSRF tokens in cookies by default.Please note that ``CORS_ORIGIN_WHITELIST`` takes the whole URL including the scheme (e.g. 'http://'), whereas ``CSRF_TRUSTED_ORIGINS`` takes**only** the domain, for example: &quot;example.org&quot;.3.) Include the routes in your ``urls.py``:::    urlpatterns = [        # ...        path(&quot;api/v1/auth/&quot;, include(&quot;ai_kit_auth.urls&quot;))        # ...    ]4.) Run ``python manage.py migrate``. Only required if you add thedependenciesto your project since this package does not define models on its own.Api Documentation=================Of course you don't have to use the front and backend components in tandem.But if you start to mix and match, you have to speak to the Rest-API directly.To do that, here are the endpoints:Login------POST ``../login/``visibility: everyoneexpects::    {        ident: &lt;username or email&gt;,        password: &lt;the password&gt;    }both fields are required.In addition a csrf-token returned from the `/me` call is needed in the request header as X-CSRFTOKEN.The endpoint answers with the status code 200and::    {        user: {            username: &lt;the username&gt;,            email: &lt;the email address&gt;,            id: &lt;the internal id&gt;,        },        csrf: &lt;csrf token&gt;    }Error cases:Field specific errors are given back like so:::    {        &lt;field name&gt;: &lt;error code&gt;    }fields are ``ident`` or ``password`` and the only possible error code is ``blank``.Errors that are not field specific are mapped to the key ``non_field_errors``.Currently, the only error code that can be returned here is ``invalid_credentials``.Logout------POST ``../logout/``visibility: authenticated usersexpects::    {}and answers with status code 200 and::    {        csrf: &lt;csrf token&gt;    }At least when the csrf token is stored via session storage, it changesat logout and you have to update it in the frontend.Me-----------GET ``../me/``visibility: everyoneThe answer is very similar to login: status code 200 and::    {        user: null | {            username: &lt;the username&gt;,            email: &lt;the email address&gt;,            id: &lt;the internal id&gt;,        },        csrf: &lt;csrf token&gt;    }The only difference is that me is reachable for anonymous users thatare not (yet) logged in. In that case, the user property is set to``null``.Registration============POST ``register``visibility: everyoneexpects::    {        &quot;username&quot;: &lt;username, only if the USERNAME_REQUIRED option is set&gt;,        &quot;email&quot;: &lt;email&gt;,        &quot;password&quot;: &lt;password&gt;,    }and answers with status code 201 and::    {}or errors out with status code 400 because fields is missing or the passwordvalidation fails.Initiate Password Reset=======================POST ``send_pw_reset_email``visibility: everyoneexpects::    {        &quot;email&quot;: &lt;email&gt;,    }and answers with status code 200::    {}This endpoint never gives back errors to not give out unnecessary information.Password Reset==============POST ``reset_password``visibility: everyoneexpects::    {        &quot;ident&quot;: &lt;identifer for the user, from the reset link&gt;,        &quot;token&quot;: &lt;reset token, from the reset link&gt;,        &quot;password&quot;: &lt;password&gt;,    }and answers with status code 200 and::    {}On error, status code 400 is given back and the errors can be missing fields,``reset_password_link_invalid`` for invalid identifiers or token or the standardinvalid password errors.Validate Password=================POST ``validate_password``visibility: everyoneexpects::    {        &quot;ident&quot;: &lt;identifier&gt;,        &quot;username&quot;: &lt;username&gt;,        &quot;email&quot;: &lt;email&gt;,        &quot;password&quot;: &lt;password&gt;,    }you have to supply either ident or both username and email if``USERNAME_REQUIRED`` is configured. Otherwise you have to supply either identor email.and answers with status code 200 and::    {}if the password respects all the configured password validators or it errors outon status code 400 and gives back the respective error code to indicate whatrule was violated.Activate User=============POST ``activate_email``expects::    {        &quot;ident&quot;: &lt;identifer for the user, from the reset link&gt;,        &quot;token&quot;: &lt;reset token, from the reset link&gt;,    }and answers with status code 200 and::    {}or errors out on status code 400 with the ``activation_link_invalid`` errorcode.Error Codes-----------The backend never sends user facing error messages, but general error codes.Internationalisation happens in the frontend.+-------------------------------+-------------------------------------------------------+| error code                    | possible user facing message                          |+===============================+=======================================================+| `blank`                       | This field may not be blank.                          |+-------------------------------+-------------------------------------------------------+| `username_unique`             | This username has already been taken.                 |+-------------------------------+-------------------------------------------------------+| `password_too_short`          | Password too short, it should contain at least 8      ||                               | characters.                                           |+-------------------------------+-------------------------------------------------------+| `password_too_similar`        | Password too similar to your username or email        ||                               | address.                                              |+-------------------------------+-------------------------------------------------------+| `password_too_common`         | The password you've entered is too common and         ||                               | thus unsafe. Please try to think of something         ||                               | else.                                                 |+-------------------------------+-------------------------------------------------------+| `passwords_not_identical`     | Both passwords entered are not identical.             |+-------------------------------+-------------------------------------------------------+| `invalid_credentials`         | The combination of username (or email, depending      ||                               | on configuration) and password is invalid. Please     ||                               | try again.                                            |+-------------------------------+-------------------------------------------------------+| `activation_link_invalid`     | The activation link you tried to use is invalid.      ||                               | This may be due to a typo, or because it has          ||                               | been used already.                                    |+-------------------------------+-------------------------------------------------------+| `password_reset_link_invalid` | The password reset link you tried to use is invalid.  ||                               | This may be due to a typo, or because it has          ||                               | been used already.                                    |+-------------------------------+-------------------------------------------------------+Another reason for getting `password_reset_link_invalid` might be that you are logged ininto the django admin view with the same user you are trying to reset the password for.Signals-------You can use the Signals AI-Kit Authentication emits when states are changed. The following Signals are available:* `user_pre_login` is emitted before a login  request is handled* `user_post_login` is emitted after a login  request is handled* `user_pre_logout` is emitted before a logout request is handled* `user_post_logout` is emitted after a logout request is handled* `user_pre_registered` is emitted before a request to register is handled* `user_post_registered` is emitted after a request to register is handled* `user_pre_activated` is emitted before a request to activate a user is handled* `user_post_activated` is emitted after a request to activate a user is handled* `user_pre_forgot_password` is emitted before a forgot_password request is handled* `user_post_forgot_password` is emitted after a forgot_password request is handled* `user_pre_reset_password` is emitted before a reset_password request is handled* `user_post_reset_password` is emitted after a reset_password request is handled</longdescription>
</pkgmetadata>