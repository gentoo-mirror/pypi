<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription>### Сбор данных с сайта объявлений об аренде и продаже недвижимости ЦианCianparser - это библиотека Python 3 (версии 3.8 и выше) для парсинга сайта  [Циан](http://cian.ru).С его помощью можно получить достаточно подробные и структурированные данные по краткосрочной и долгосрочной аренде, продаже квартир, домов, танхаусов итд.### Установка```bashpip install cianparser```### Использование```pythonimport cianparser    data = cianparser.parse(    deal_type=&quot;rent_long&quot;,    accommodation_type=&quot;flat&quot;,    location=&quot;Москва&quot;,    rooms=(2, 3),    start_page=1,    end_page=2,    is_saving_csv=True,)print(data[0])``````                              Preparing to collect information from pages..The absolute path to the file:  /Users/macbook/some_project/cian_parsing_result_rent_long_1_2_moskva_04_Feb_2023_06_58_21_765479.csv The page from which the collection of information begins:  https://cian.ru/cat.php?engine_version=2&amp;p=1&amp;region=1&amp;offer_type=flat&amp;deal_type=rent&amp;room2=1&amp;room3=1&amp;with_neighbors=0&amp;type=4 Collecting information from pages with list of announcements1 | 1 page with list: [=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;] 100% | Count of parsed: 28. Progress ratio  50 %. Average price: 204 642 rub2 | 2 page with list: [=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;=&gt;] 100% | Count of parsed: 56. Progress ratio 100 %. Average price: 236 426 rub{  'accommodation_type': 'flat',   'deal_type': 'rent',   'city': 'Москва',   'district': 'Замоскворечье',   'underground': 'Новокузнецкая',   'street': 'Космодамианская набережная',   'house_number': 25,   'floor': 5,   'floors_count': 12,   'total_meters': 85.0,   'living_meters': 55.0,   'kitchen_meters': 11.0,   'rooms_count': 3,   'year_of_construction': '1954',   'price_per_month': 93000,   'price_per_m2': 1094,   'commissions': 50,   'author': 'Apple Real Estate',   'author_type': 'real_estate_agent',   'phone': '+79057145354',   'link': 'https://www.cian.ru/rent/flat/282487326/',}The collection of information from the pages with list of announcements is completedTotal number of parced announcements: 56. Average price per month: 236 426 rub```### КонфигурацияФункция __*parse*__ имеет следующий аргументы:* __deal_type__ - тип объявления, к примеру, долгосрочная, краткосрочная аренда, продажа _(&quot;rent_long&quot;, &quot;rent_short&quot;, &quot;sale&quot;)_* __accommodation_type__ - вид жилья, к примеру, квартира, комната, дом, часть дома, таунхаус _(&quot;flat&quot;, &quot;room&quot;, &quot;house&quot;, &quot;house-part&quot;, &quot;townhouse&quot;)_* __location__ - локация объявления, к примеру, Казань (для просмотра доступных мест используйте _cianparser.list_cities())_* __rooms__ - количество комнат, к примеру, _1, (1,3, &quot;studio&quot;), &quot;studio, &quot;all&quot;_; по умолчанию любое _(&quot;all&quot;)_* __start_page__ - страница, с которого начинается сбор данных, по умолчанию, _1_* __end_page__ - страница, с которого заканчивается сбор данных, по умолчанию, _100_* __is_saving_csv__ - необходимо ли сохранение собираемых данных (в реальном времени в процессе сбора данных) или нет, по умолчанию _False_* __is_latin__ - необходимо ли преобразывание любой встрещающейся __кириллицы__ в __латиницу__, по умолчанию _False_* __is_express_mode__ - необходимо ли &lt;ins&gt;ускорение&lt;/ins&gt; (___в 5-10 раз___) сбор данных (&lt;ins&gt;__но без трех полей__&lt;/ins&gt;, см примечание), по умолчанию _True_* __additional_settings__ - дополнительные фильтры поиска (см. ниже в __Дополнительные фильтры поиска__), по умолчанию _None_* __proxies__ - прокси (см раздел __Cloudflare, CloudScraper, Proxy__), по умолчанию _None_Если имеется желание __собрать данные со всех страниц__, то можно пропустить аргументы __start_page__ и __end_page__.В проекте предусмотрен функционал корректного завершения в случае окончания страниц. По данному моменту, следует изучить раздел __Ограничения___**В настоящее время функционал доступен только по продажам (sale) и долгосрочном арендам (rent_long) квартир и студий (flat).**_#### Дополнительные фильтры поискаПример:```pythonadditional_settings = {    &quot;is_by_homeowner&quot;: True,    &quot;min_price&quot;: 1000000,    &quot;max_price&quot;: 10000000,    &quot;have_balconies&quot;: True,    &quot;have_loggia&quot;: True,    &quot;min_house_year&quot;: 1990,    &quot;max_house_year&quot;: 2023,    &quot;min_floor&quot;: 3,    &quot;max_floor&quot;: 4,    &quot;min_total_floor&quot;: 5,    &quot;max_total_floor&quot;: 10,    &quot;house_material_type&quot;: 1,    &quot;metro&quot;: &quot;Московский&quot;,    &quot;metro_station&quot;: &quot;ВДНХ&quot;,    &quot;metro_foot_minute&quot;: 45,    &quot;sort_by&quot;: &quot;price_from_min_to_max&quot;,}```* __is_by_homeowner__ - объявления, созданных только собственниками* __min_price__ - цена от* __max_price__ - цена до* __have_balconies__ - наличие балкона* __have_loggia__ - наличия лоджи* __min_house_year__ - год постройки дома от* __max_house_year__ - год постройки дома до* __min_floor__ - этаж от* __max_floor__ - этаж до* __min_total_floor__ - этажей в доме от* __max_total_floor__ - этажей в доме до* __house_material_type__ - тип дома* __metro__ - название метрополитена* __metro_station__ - станция метро (при условии что задано metro)* __metro_foot_minute__ - сколько минут до метро (при условии что задано metro_station)* __sort_by__ - сортировка объявленийДля **house_material_type** возможны следующие из значений- _1_ - киричный- _2_ - монолитный- _3_ - панельный- _4_ - блочный- _5_ - деревянный- _6_ - сталинский- _7_ - щитовой- _8_ - кирпично-монолитныйВозможные значения полей **metro** и **metro_station** можно посмотреть **_cianparser.list_metro_stations().keys()_** и  **_cianparser.list_metro_stations()[metro]_** соотвественноПоле __sort_by__ может иметь следующие возможные значения:- &quot;_price_from_min_to_max_&quot; - сортировка по цене (сначала дешевле)- &quot;_price_from_max_to_min_&quot; - сортировка по цене (сначала дороже)- &quot;_total_meters_from_max_to_min_&quot; - сортировка по общей площади (сначала больше)- &quot;_creation_data_from_newer_to_older_&quot; - сортировка по дате добавления (сначала новые)- &quot;_creation_data_from_older_to_newer_&quot; - сортировка по дате добавления (сначала старые)### Признаки, получаемые в ходе сбора данных с предложений по долгосрочной аренде недвижимости* __district__ - район* __underground__ - метро* __street__ - улица* __house_number__ - номер дома* __floor__ - этаж* __floors_count__ - общее количество этажей* __total_meters__ - общая площадь* __living_meters__ - жилая площади* __kitchen_meters__ - площадь кухни* __rooms_count__ - количество комнат* __year_construction__ - год постройки здания* __price_per_month__ - стоимость в месяц* __price_per_m2__ - стоимость на квадратный метр* __commissions__ - комиссия, взымаемая при заселении* __author__ - автор объявления* __author_type__ - тип автора * __phone__ - номер телефона в объявлении* __link__ - ссылка на объявлениеВозможные значения поля __author_type__:- __real_estate_agent__ - агентство недвижимости- __homeowner__ - собственник- __realtor__ - риелтор- __official_representative__ - ук оф.представитель- __representative_developer__ - представитель застройщика- __developer__ - застройщик- __unknown__ - без указанного типа### Признаки, получаемые в ходе сбора данных с предложений по продаже недвижимостиПризнаки __аналогичны__ вышеописанным, кроме отсутствия полей __price_per_month__ и __commissions__.При этом появляются новые:* __price__ - стоимость недвижимости* __residential_complex__ - название жилого комплекса### Сохранение данныхИмеется возможность сохранения собираемых данных в режиме реального времени. Для этого необходимо подставить в аргументе __is_saving_csv__ значение ___True___.Пример получаемого файла:```bashcian_parsing_result_rent_long_1_2_moskva_04_Feb_2023_06_58_21_765479.csv```| author | author_type | link | city | deal_type | accommodation_type | floor | floors_count | rooms_count | total_meters | price_per_month | price_per_m2 | commissions | year_of_construction | living_meters | kitchen_meters | phone | district | street | underground| ------ | ----------- | ---- | ---- | --------- | ------------------ | ----- | ------------ | ----------- | ------------ | --------------- | ----------- | ----------- | -------------------- | --- | --- | --- | --- | --- | ---| Intermark Real Estate | real_estate_agent | https://www.cian.ru/rent/flat/278903117/ | Москва | rent | flat | 4 | 6 | 3 | 50.0 | 180000 | 3600 | 0 | 1911 | 32.0 | 8.0 | +79676513428 | Пресненский | Малый Предтеченский переулок | Краснопресненская| Capital Mars | real_estate_agent | https://www.cian.ru/rent/flat/282506328/ | Москва | rent | flat | 5 | 9 | 2 | 89.0 | 180000 | 2022 | 0 | 2006 | 53.0 | 15.0 | +79660619653 | Хамовники | 3-я Фрунзенская | Спортивная| MERSI | real_estate_agent | https://www.cian.ru/rent/flat/281562376/ | Москва | rent | flat | 8 | 16 | 2 | 80.0 | 200000 | 2500 | 0 | 2012 | -1 | -1 | +79652455850 | Замоскворечье | Мытная | Октябрьская### Cloudflare, CloudScraper, ProxyДля обхода блокировки в проекте задействован **CloudScraper** (библиотека **cloudscraper**), который позволяет успешно обходить защиту **Cloudflare**.Вместе с тем, это не гарантирует отсутствие возможности появления _у некоторых пользователей_ теста **CAPTCHA** при долговременном непрерывном использовании.#### ProxyПоэтому была предоставлена возможность проставлять прокси, используя аргумент **proxies** (_список прокси протокола HTTP_)Пример:```pythonproxies = ['85.26.146.169:80','178.140.177.145:8889','95.66.138.21:8880','93.123.226.23:81','46.47.197.210:3128','213.184.153.66:8080','62.33.207.201:3128',]```В процессе запуска утилита проходится по всем из них, пытаясь определить подходящий, то есть тот, который может, во первых, делать запросы, во вторых, не иметь тест **_CAPTCHA_**Пример лога, в котором представлено все три возможных кейса```The process of checking the proxies... Search an available one among them... 1 | proxy 46.47.197.210:3128: unavailable.. trying another 2 | proxy 213.184.153.66:8080: there is captcha.. trying another 3 | proxy 95.66.138.21:8880: available.. stop searching```### ОграниченияСайт выдает списки с объявлениями &lt;ins&gt;__лишь до 54 странцы включительно__&lt;/ins&gt;. Это примерно _28 * 54 = 1512_ объявлений.Поэтому, если имеется желание собрать как можно больше данных, то следует использовать более конкретные запросы (по количеству комнат). К примеру, вместо того, чтобы при использовании указывать _rooms=(1, 2)_, стоит два раза отдельно собирать данные с параметрами _rooms=1_ и _rooms=2_ соответственно.Таким образом, максимальная разница может составить 1 к 6 (студия, 1, 2, 3, 4, 5 комнатные квартиры), то есть 1512 к 9072.### Примечание1. В некоторых объявлениях отсутсвуют данные по некоторым признакам (_год постройки, жилые кв метры, кв метры кухни итп_).В этом случае проставляется значение ___-1___ либо ___пустая строка___ для числового и строкового типа поля соответственно.2. Для отсутствия блокировки по __IP__ в данном проекте задана пауза (___в размере 4-5 секунд___) после сбора информации скаждой отдельной взятой страницы.3. Не рекомендутся производить несколько процессов сбора данных параллельно (одновременно) на одной машине (см. пункт 2).4. Имеется флаг __is_express_mode__, при помощи которого можно существенно (___в 5-10 раз___) ускорить сбор данных благодаря отсутствию необходимости заходить на каждую страницу с предложением. Однако в таком случае &lt;ins&gt;__не будут__&lt;/ins&gt; собираться данные о ___площади кухни___, ___годе постройки здания___ и ___номере телефона___.5. Данный парсер не будет работать в таком инструменте как [Google Colaboratory](https://colab.research.google.com/). См. [подробности](https://github.com/lenarsaitov/cianparser/issues/1)6. Если в проекте не имеется подходящего локации (неожидаемое значение аргумента __location__) или иными словами его нет в списке **_cianparser.list_cities()_**. То прошу сообщить, буду рад добавить.</longdescription>
</pkgmetadata>