<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE pkgmetadata SYSTEM "http://www.gentoo.org/dtd/metadata.dtd">
<pkgmetadata>
	<maintainer type="person">
		<email>gentoo@houseofsuns.org</email>
		<name>Markus Walter</name>
	</maintainer>
	<longdescription># testinfra-bdd[![CI](https://github.com/cbdq-io/testinfra-bdd/actions/workflows/ci.yml/badge.svg)](https://github.com/cbdq-io/testinfra-bdd/actions/workflows/ci.yml)[![Maintainability](https://api.codeclimate.com/v1/badges/5482c55d78b369a0a55e/maintainability)](https://codeclimate.com/github/cbdq-io/testinfra-bdd/maintainability)[![Test Coverage](https://api.codeclimate.com/v1/badges/5482c55d78b369a0a55e/test_coverage)](https://codeclimate.com/github/cbdq-io/testinfra-bdd/test_coverage)[![testinfra-bdd](https://snyk.io/advisor/python/testinfra-bdd/badge.svg)](https://snyk.io/advisor/python/testinfra-bdd)An interface between[pytest-bdd](https://pytest-bdd.readthedocs.io/en/latest/)and[pytest-testinfra](https://testinfra.readthedocs.io/en/latest/index.html).## Defining ScenariosGiven a directory structure of:```shell&quot;.&quot;└── &quot;tests&quot;    ├── &quot;features&quot;    │   ├── &quot;example.feature&quot;    └── &quot;step_defs&quot;        └── &quot;test_example.py&quot;```The file `tests/features/example.feature` could look something like:```gherkinFeature: Example of Testinfra BDD  Give an example of all the possible Given, When and Then steps.  The Given steps to skip the address and port tests when running under  GitHub actions are not part of the testinfra-bdd package itself, but are  required as GitHub/Azure does not allow Ping/ICMP traffic.  Scenario: Skip Tests if Host is Windoze    Given the host with URL &quot;docker://sut&quot; is ready within 10 seconds    # The system property can be one of:    #   - type (e.g. linux).    #   - distribution (e.g. debian).    #   - release (e.g. 11).    #   - codename (e.g. bullseye).    #   - arch (e.g. x86_64).    #   - hostname (e.g. sut).    #   - connection_type (e.g. docker or ssh).    When the system property type is not Windoze skip tests  Scenario Outline: Test for Absent Resources    Given the host with URL &quot;docker://sut&quot; is ready within 10 seconds    When the &lt;resource_type&gt; is &quot;foo&quot;    Then the &lt;resource_type&gt; is absent    Examples:      | resource_type |      | user          |      | group         |      | package       |      | file          |      | pip package   |  Scenario Outline: Test for Absent Non-Quoted Resources    # Same as the example above except the resources are not quoted.    Given the host with URL &quot;docker://sut&quot; is ready within 10 seconds    When the &lt;resource_type&gt; is foo    Then the &lt;resource_type&gt; state is absent    Examples:      | resource_type |      | user          |      | group         |      | package       |      | file          |      | pip package   |  Scenario: User Checks    Given the host with URL &quot;docker://sut&quot; is ready    When the user is &quot;ntp&quot;    Then the user is present    # Alternative method of checking the state of a resource.    And the user state is present    And the user group is ntp    And the user uid is 101    And the user gid is 101    And the user home is /nonexistent    And the user shell is /usr/sbin/nologin  Scenario: File Checks    Given the host with URL &quot;docker://sut&quot; is ready    When the file is /etc/ntp.conf    # Expected state can be present or absent.    Then the file is present    # Alternative method of checking the state of a resource.    And the file state is present    # Valid types to check for are file, directory, pipe, socket or symlink.    And the file type is file    And the file owner is ntp    And the file group is ntp    And the file contents contains &quot;debian.pool.ntp&quot;    And the file contents contains the regex &quot;.*pool [0-9].debian.pool.ntp.org iburst&quot;    # The expected mode must be specified as an octal.    And the file mode is 0o544  Scenario: Group Checks    Given the host with URL &quot;docker://sut&quot; is ready    When the group is &quot;ntp&quot;    # Can check if the group is present or absent.    Then the group is present    # Alternative method of checking the state of a resource.    And the group state is present    And the group gid is 101  Scenario: Running Commands    Given the host with URL &quot;docker://sut&quot; is ready    When the command is &quot;ntpq -np&quot;    Then the command return code is 0    And the command &quot;ntpq&quot; exists in path    And the command stdout contains &quot;remote&quot;    And the command stdout does not contain &quot;foo&quot;  Scenario: System Package    Given the host with URL &quot;docker://sut&quot; is ready    When the package is ntp    # Can check if the package is absent, present or installed.    Then the package is installed  Scenario: Python Package    Given the host with URL &quot;docker://sut&quot; is ready    When the pip package is testinfra-bdd    # Can check if the package is absent or present.    Then the pip package is present    And the pip package version is 2.2.2    # Check that installed packages have compatible dependencies.    And the pip check is OK  Scenario Outline: Service Checks    Given the host with URL &quot;docker://sut&quot; is ready    When the service is &lt;service&gt;    Then the service is &lt;running_state&gt;    And the service is &lt;enabled_state&gt;    Examples:      | service | running_state | enabled_state |      | ntp     | running       | enabled       |      | named   | not running   | not enabled   |  Scenario: Test Running Processes    Given the host with URL &quot;docker://sut&quot; is ready    # Processes are selected using filter() attributes names are    # described in the ps man page.    When the process filter is &quot;user=root,comm=ntpd&quot;    Then the process count is 1  Scenario Outline: Test Pip Packages are Latest Versions    Given the host with URL &quot;docker://sut&quot; is ready    When the pip package is &lt;pip_package&gt;    Then the pip package is present    And the pip package is &lt;status&gt;    Examples:      | pip_package      | status     |      | pytest-bdd       | superseded |      | pytest-testinfra | latest     |      | testinfra-bdd    | latest     |  Scenario Outline:  Check Sockets    # This checks that NTP is listening but SSH isn't.    # The socket url is defined at https://testinfra.readthedocs.io/en/latest/modules.html#socket    Given the host with URL &quot;docker://sut&quot; is ready within 10 seconds    When the socket is &lt;url&gt;    Then the socket is &lt;expected_state&gt;    Examples:      | url       | expected_state |      | udp://123 | listening      |      | tcp://22  | not listening  |  Scenario: Skip Tests Due to Environment Variable    Given the host with URL &quot;docker://java11&quot; is ready    When the environment variable PYTHONPATH is .:.. skip tests  Scenario: Check Network Address    Given the host with URL &quot;docker://sut&quot; is ready within 10 seconds    When the environment variable GITHUB_ACTIONS is true skip tests    And the address is www.google.com    Then the address is resolvable    And the address is reachable  Scenario: Check Network Address With Port    Given the host with URL &quot;docker://sut&quot; is ready within 10 seconds    When the environment variable GITHUB_ACTIONS is true skip tests    And the address and port is www.google.com:443    Then the address is resolvable    And the address is reachable    And the port is reachable  Scenario: Check Java is Installed in the Path    Given the host with URL &quot;docker://java11&quot; is ready within 10 seconds    Then the command &quot;java&quot; exists in path  Scenario: Check Java 11 is Installed    Given the host with URL &quot;docker://java11&quot; is ready    When the command is &quot;java -version&quot;    And the package is java-11-amazon-corretto-devel    Then the command stderr contains &quot;Corretto-11&quot;    And the command stderr contains the regex &quot;openjdk version \&quot;11\\W[0-9]&quot;    And the command stdout is empty    And the command return code is 0    And the package is installed  Scenario: Check for an Expected Value   # In this example we set the expected_value to &quot;foo&quot;   Given the host with URL &quot;docker://sut&quot; is ready   And the expected value is &quot;foo&quot;   When the command is &quot;echo foo&quot;   Then the command stdout contains the expected value  Scenario Outline: Check Contents of JSON File With JMESPath    Given the host with URL &quot;docker://sut&quot; is ready    When the file is /tmp/john-smith.json    Then the JMESPath expression &lt;expression&gt; returns &lt;expected_value&gt;    Examples:      | expression    | expected_value |      | firstName     | John           |      | lastName      | Smith          |      | age           | 27             |      | address.state | NY             |      | spouse        | None           |```and `tests/step_defs/test_example.py` contains the following:```python&quot;&quot;&quot;Examples of step definitions for Testinfra BDD feature tests.&quot;&quot;&quot;import testinfra_bddfrom pytest_bdd import given, scenariosscenarios('../features/example.feature')# Ensure that the PyTest fixtures provided in testinfra-bdd are available to# your test suite.pytest_plugins = testinfra_bdd.PYTEST_MODULES@given('the expected value is &quot;foo&quot;', target_fixture='expected_value')def the_expected_value_is_foo():    &quot;&quot;&quot;    The expected value is &quot;foo&quot;.    The name and code is up to the user to develop.  However, the target    fixture must be called 'expected_value'.    &quot;&quot;&quot;    return 'foo'```## &quot;Given&quot; StepsGiven steps require that the URL of the system to be tested (SUT) is provided.This URL should comply to the connection string for the [Testinfra connectionstring](https://testinfra.readthedocs.io/en/latest/backends.html) (e.g.docker://my-host).  Please note that the URL _must_ be enclosed in doublequotes.Examples:To connect to a Docker container called sut (fail if the target host isnot ready):```gherkinGiven the host with URL &quot;docker://java11&quot; is ready```To connect to a Docker container called sut but give it 60 seconds to becomeready, use the following:```gherkinGiven the host with URL &quot;docker://sut&quot; is ready within 60 seconds```If the host does not become available after 60 seconds, fail the tests.### Writing a customized &quot;Given&quot; StepIt may be that you may want to create a customized &quot;Given&quot; step.  An examplecould be that the hosts to be tested may be parametrized.  The &quot;Given&quot; stepmust return a target fixture called &quot;testinfra_bdd_host&quot; so that the rest ofthe Testinfra BDD fixtures will function.  This fixture is a instance of the`testinfra_bdd.`The &quot;Given&quot; step should also ascertain that the target host is ready (onecan use the `is_host_ready` function for that).An example is:```pythonfrom pytest_bdd import givenfrom testinfra_bdd import TestinfraBDD@given('my host is ready', target_fixture='testinfra_bdd_host')def my_host_is_ready():    &quot;&quot;&quot;    Specify that the target host is a docker container called    &quot;my-host&quot; and wait up to 60 seconds for the host to be ready.    &quot;&quot;&quot;    host = TestinfraBDD('docker://my-host')    assert host.is_host_ready(60), 'My host is not ready.'    return host...```## &quot;When&quot; StepsWhen steps require that a &quot;Given&quot; step has been executed beforehand.  Theyallow the user to either skip tests if the host does not match an expectedprofile.  They also allow the user to specify which resource or is to betested.### Skip Tests if Host Profile Does Not MatchIt may be useful to skip tests if you find that the system under test doesn'tmatch an expected profile (e.g. the system is not debian as expected).  Thiscan be achieved by comparing against the following configurations:- The OS Type (e.g. linux).- The distribution name (e.g. debian).- The OS release (e.g. 11).- The OS codename if relevant (e.g. bullseye).- The host architecture (e.g. x86_64).- The hostname (e.g. sut)Example:```gherkin  Scenario: Skip Tests if Host is Windoze    Given the host with URL &quot;docker://sut&quot; is ready within 10 seconds    When the system property type is not Windoze skip tests```## Upgrading from 1.Y.Z to 2.0.0We split the single package into multiple source files.  This means a minorbut nonetheless breaking change in your step definitions (all feature filescan remain as they are).  The change is how one sets `pytest_plugins`.### Old Code```pythonpytest_plugins = ['testinfra_bdd']```### New Code```pythonpytest_plugins = testinfra_bdd.PYTEST_MODULES```</longdescription>
</pkgmetadata>